
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the NZI Photonic Crystal Modes Finder">
      
      
      
      
        <link rel="prev" href="../crystal_materials/">
      
      
        <link rel="next" href="../crystal_analysis/">
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.44">
    
    
      
        <title>photonic_crystal - NZI PHOTONIC CRYSTAL MODES FINDER</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.0253249f.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.photonic_crystal" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="NZI PHOTONIC CRYSTAL MODES FINDER" class="md-header__button md-logo" aria-label="NZI PHOTONIC CRYSTAL MODES FINDER" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            NZI PHOTONIC CRYSTAL MODES FINDER
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              photonic_crystal
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/enricovallar/nzi-lithium-niobate" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    nzi-lithium-niobate
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../installation/" class="md-tabs__link">
        
  
    
  
  Installation

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../for_me/" class="md-tabs__link">
        
  
    
  
  Development

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../crystal_geometries/" class="md-tabs__link">
          
  
  API Reference

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="NZI PHOTONIC CRYSTAL MODES FINDER" class="md-nav__button md-logo" aria-label="NZI PHOTONIC CRYSTAL MODES FINDER" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    NZI PHOTONIC CRYSTAL MODES FINDER
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/enricovallar/nzi-lithium-niobate" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    nzi-lithium-niobate
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Installation
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../for_me/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Development
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Python Interface
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            Python Interface
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crystal_geometries/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    crystal_geometries
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crystal_materials/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    crystal_materials
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    photonic_crystal
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    photonic_crystal
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      photonic_crystal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="photonic_crystal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal" class="md-nav__link">
    <span class="md-ellipsis">
      PhotonicCrystal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PhotonicCrystal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      pickle_photonic_crystal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      load_photonic_crystal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.set_solver" class="md-nav__link">
    <span class="md-ellipsis">
      set_solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      run_simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_simulation_with_output" class="md-nav__link">
    <span class="md-ellipsis">
      run_simulation_with_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      run_dumb_simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.convert_mode_fields" class="md-nav__link">
    <span class="md-ellipsis">
      convert_mode_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.extract_data" class="md-nav__link">
    <span class="md-ellipsis">
      extract_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_bands" class="md-nav__link">
    <span class="md-ellipsis">
      plot_bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      get_XY_k_points_near_gamma
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" class="md-nav__link">
    <span class="md-ellipsis">
      get_high_symmetry_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_field_components" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field_components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.look_for_mode" class="md-nav__link">
    <span class="md-ellipsis">
      look_for_mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" class="md-nav__link">
    <span class="md-ellipsis">
      find_modes_symmetries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" class="md-nav__link">
    <span class="md-ellipsis">
      plot_modes_vectorial_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" class="md-nav__link">
    <span class="md-ellipsis">
      plot_mode_fields_normal_to_k
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" class="md-nav__link">
    <span class="md-ellipsis">
      plot_vectorial_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.sweep_geometry_parameter" class="md-nav__link">
    <span class="md-ellipsis">
      sweep_geometry_parameter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_sweep_result" class="md-nav__link">
    <span class="md-ellipsis">
      plot_sweep_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_material" class="md-nav__link">
    <span class="md-ellipsis">
      basic_material
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D" class="md-nav__link">
    <span class="md-ellipsis">
      Crystal2D
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crystal2D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_field_components" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field_components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.square_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      square_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.triangular_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      triangular_lattice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab" class="md-nav__link">
    <span class="md-ellipsis">
      CrystalSlab
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CrystalSlab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.square_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      square_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.triangular_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      triangular_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_field_components" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field_components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.suppress_output" class="md-nav__link">
    <span class="md-ellipsis">
      suppress_output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../crystal_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    crystal_analysis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      photonic_crystal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="photonic_crystal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal-classes" class="md-nav__link">
    <span class="md-ellipsis">
      Classes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal" class="md-nav__link">
    <span class="md-ellipsis">
      PhotonicCrystal
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PhotonicCrystal">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      pickle_photonic_crystal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" class="md-nav__link">
    <span class="md-ellipsis">
      load_photonic_crystal
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.set_solver" class="md-nav__link">
    <span class="md-ellipsis">
      set_solver
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      run_simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_simulation_with_output" class="md-nav__link">
    <span class="md-ellipsis">
      run_simulation_with_output
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" class="md-nav__link">
    <span class="md-ellipsis">
      run_dumb_simulation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.convert_mode_fields" class="md-nav__link">
    <span class="md-ellipsis">
      convert_mode_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.extract_data" class="md-nav__link">
    <span class="md-ellipsis">
      extract_data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_bands" class="md-nav__link">
    <span class="md-ellipsis">
      plot_bands
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" class="md-nav__link">
    <span class="md-ellipsis">
      get_XY_k_points_near_gamma
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" class="md-nav__link">
    <span class="md-ellipsis">
      get_high_symmetry_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_field_components" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field_components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.look_for_mode" class="md-nav__link">
    <span class="md-ellipsis">
      look_for_mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" class="md-nav__link">
    <span class="md-ellipsis">
      find_modes_symmetries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" class="md-nav__link">
    <span class="md-ellipsis">
      plot_modes_vectorial_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" class="md-nav__link">
    <span class="md-ellipsis">
      plot_mode_fields_normal_to_k
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" class="md-nav__link">
    <span class="md-ellipsis">
      plot_vectorial_fields
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.sweep_geometry_parameter" class="md-nav__link">
    <span class="md-ellipsis">
      sweep_geometry_parameter
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.plot_sweep_result" class="md-nav__link">
    <span class="md-ellipsis">
      plot_sweep_result
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.PhotonicCrystal.basic_material" class="md-nav__link">
    <span class="md-ellipsis">
      basic_material
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D" class="md-nav__link">
    <span class="md-ellipsis">
      Crystal2D
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Crystal2D">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.plot_field_components" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field_components
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.square_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      square_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.Crystal2D.triangular_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      triangular_lattice
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab" class="md-nav__link">
    <span class="md-ellipsis">
      CrystalSlab
    </span>
  </a>
  
    <nav class="md-nav" aria-label="CrystalSlab">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.__init__" class="md-nav__link">
    <span class="md-ellipsis">
      __init__
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_epsilon" class="md-nav__link">
    <span class="md-ellipsis">
      plot_epsilon
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.basic_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      basic_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.square_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      square_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.triangular_lattice" class="md-nav__link">
    <span class="md-ellipsis">
      triangular_lattice
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.basic_geometry" class="md-nav__link">
    <span class="md-ellipsis">
      basic_geometry
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_field" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.CrystalSlab.plot_field_components" class="md-nav__link">
    <span class="md-ellipsis">
      plot_field_components
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.photonic_crystal.suppress_output" class="md-nav__link">
    <span class="md-ellipsis">
      suppress_output
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>photonic_crystal</h1>

<div class="doc doc-object doc-module">



<h2 id="src.photonic_crystal" class="doc doc-heading">
            <code>src.photonic_crystal</code>


<a href="#src.photonic_crystal" class="headerlink" title="Anchor link to this section">&para;</a></h2>

    <div class="doc doc-contents first">








  <div class="doc doc-children">






<h3 id="src.photonic_crystal-classes">Classes<a href="#src.photonic_crystal-classes" class="headerlink" title="Anchor link to this section">&para;</a></h3>

<div class="doc doc-object doc-class">



<h4 id="src.photonic_crystal.PhotonicCrystal" class="doc doc-heading">
            <code>PhotonicCrystal</code>


<a href="#src.photonic_crystal.PhotonicCrystal" class="headerlink" title="Anchor link to this section">&para;</a></h4>


    <div class="doc doc-contents ">


        <p>A class to represent a photonic crystal and perform simulations using MPB (MIT Photonic Bands).</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.lattice_type">lattice_type</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the lattice.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.num_bands">num_bands</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bands.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.resolution">resolution</span></code></td>
            <td>
                  <code>tuple[int, int] | int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolution of the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.interp">interp</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation factor for k-points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.periods">periods</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of periods.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.pickle_id">pickle_id</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Identifier for pickling.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.has_been_run">has_been_run</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating if the simulation has been run.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.geometry_lattice">geometry_lattice</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geometry lattice, set with basic lattice method.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.k_points">k_points</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k-points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.k_points_interpolated">k_points_interpolated</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolated k-points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.material">material</span></code></td>
            <td>
                  <code><span title="crystal_materials.Crystal_Materials">Crystal_Materials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Material of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.geometry">geometry</span></code></td>
            <td>
                  <code><span title="crystal_geometries.Crystal_Geometry">Crystal_Geometry</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geometry of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.ms">ms</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Placeholder for ms attribute.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.md">md</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Placeholder for md attribute.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.freqs">freqs</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store frequencies.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.gaps">gaps</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store gaps.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.epsilon">epsilon</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Placeholder for epsilon attribute.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.modes">modes</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List to store modes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.use_XY">use_XY</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to use XY plane.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal.__getstate__">__getstate__</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get the state for pickling.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal.__setstate__">__setstate__</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Set the state after unpickling.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" href="#src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal">pickle_photonic_crystal</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Pickle the photonic crystal object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" href="#src.photonic_crystal.PhotonicCrystal.load_photonic_crystal">load_photonic_crystal</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Load a pickled photonic crystal object.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.set_solver" href="#src.photonic_crystal.PhotonicCrystal.set_solver">set_solver</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Set the mode solver for the simulation.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.run_simulation" href="#src.photonic_crystal.PhotonicCrystal.run_simulation">run_simulation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Run the simulation to calculate the frequencies and gaps.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.run_simulation_with_output" href="#src.photonic_crystal.PhotonicCrystal.run_simulation_with_output">run_simulation_with_output</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Run the simulation and get mode data.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" href="#src.photonic_crystal.PhotonicCrystal.run_dumb_simulation">run_dumb_simulation</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Run a dumb simulation to quickly extract some values.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.convert_mode_fields" href="#src.photonic_crystal.PhotonicCrystal.convert_mode_fields">convert_mode_fields</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Convert the mode fields to arrays for visualization.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.extract_data" href="#src.photonic_crystal.PhotonicCrystal.extract_data">extract_data</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Extract the data from the simulation.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_epsilon" href="#src.photonic_crystal.PhotonicCrystal.plot_epsilon">plot_epsilon</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the epsilon of the photonic crystal interactively using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_bands" href="#src.photonic_crystal.PhotonicCrystal.plot_bands">plot_bands</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the bands of the photonic crystal using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" href="#src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma">get_XY_k_points_near_gamma</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get the relevant k-points near the gamma point for the X and Y directions.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" href="#src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points">get_high_symmetry_points</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Get the high symmetry points for the photonic crystal lattice.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_field" href="#src.photonic_crystal.PhotonicCrystal.plot_field">plot_field</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the field visualization.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_field_components" href="#src.photonic_crystal.PhotonicCrystal.plot_field_components">plot_field_components</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.look_for_mode" href="#src.photonic_crystal.PhotonicCrystal.look_for_mode">look_for_mode</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Look for modes within the specified criteria.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" href="#src.photonic_crystal.PhotonicCrystal.find_modes_symmetries">find_modes_symmetries</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Find the symmetries of the modes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" href="#src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields">plot_modes_vectorial_fields</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the vectorial fields of the modes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" href="#src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k">plot_mode_fields_normal_to_k</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the fields perpendicular to the wavevector k for the mode.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" href="#src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields">plot_vectorial_fields</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plot the vectorial fields of the modes.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._field_to_cones">_field_to_cones</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Convert a field to cones for visualization.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._fields_to_cones">_fields_to_cones</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Convert a list of fields to cones for visualization.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._calculate_field_norm_to_k">_calculate_field_norm_to_k</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate the components of the field perpendicular to the wavevector k.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._get_direction">_get_direction</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Determine the primary direction of the wavevector k.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.PhotonicCrystal._calculate_effective_parameter">_calculate_effective_parameter</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Calculate the effective parameters of the mode.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.basic_geometry" href="#src.photonic_crystal.PhotonicCrystal.basic_geometry">basic_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Define the basic geometry of the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal.basic_lattice" href="#src.photonic_crystal.PhotonicCrystal.basic_lattice">basic_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Define the basic lattice of the photonic crystal.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/photonic_crystal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19">  19</a></span>
<span class="normal"><a href="#__codelineno-0-20">  20</a></span>
<span class="normal"><a href="#__codelineno-0-21">  21</a></span>
<span class="normal"><a href="#__codelineno-0-22">  22</a></span>
<span class="normal"><a href="#__codelineno-0-23">  23</a></span>
<span class="normal"><a href="#__codelineno-0-24">  24</a></span>
<span class="normal"><a href="#__codelineno-0-25">  25</a></span>
<span class="normal"><a href="#__codelineno-0-26">  26</a></span>
<span class="normal"><a href="#__codelineno-0-27">  27</a></span>
<span class="normal"><a href="#__codelineno-0-28">  28</a></span>
<span class="normal"><a href="#__codelineno-0-29">  29</a></span>
<span class="normal"><a href="#__codelineno-0-30">  30</a></span>
<span class="normal"><a href="#__codelineno-0-31">  31</a></span>
<span class="normal"><a href="#__codelineno-0-32">  32</a></span>
<span class="normal"><a href="#__codelineno-0-33">  33</a></span>
<span class="normal"><a href="#__codelineno-0-34">  34</a></span>
<span class="normal"><a href="#__codelineno-0-35">  35</a></span>
<span class="normal"><a href="#__codelineno-0-36">  36</a></span>
<span class="normal"><a href="#__codelineno-0-37">  37</a></span>
<span class="normal"><a href="#__codelineno-0-38">  38</a></span>
<span class="normal"><a href="#__codelineno-0-39">  39</a></span>
<span class="normal"><a href="#__codelineno-0-40">  40</a></span>
<span class="normal"><a href="#__codelineno-0-41">  41</a></span>
<span class="normal"><a href="#__codelineno-0-42">  42</a></span>
<span class="normal"><a href="#__codelineno-0-43">  43</a></span>
<span class="normal"><a href="#__codelineno-0-44">  44</a></span>
<span class="normal"><a href="#__codelineno-0-45">  45</a></span>
<span class="normal"><a href="#__codelineno-0-46">  46</a></span>
<span class="normal"><a href="#__codelineno-0-47">  47</a></span>
<span class="normal"><a href="#__codelineno-0-48">  48</a></span>
<span class="normal"><a href="#__codelineno-0-49">  49</a></span>
<span class="normal"><a href="#__codelineno-0-50">  50</a></span>
<span class="normal"><a href="#__codelineno-0-51">  51</a></span>
<span class="normal"><a href="#__codelineno-0-52">  52</a></span>
<span class="normal"><a href="#__codelineno-0-53">  53</a></span>
<span class="normal"><a href="#__codelineno-0-54">  54</a></span>
<span class="normal"><a href="#__codelineno-0-55">  55</a></span>
<span class="normal"><a href="#__codelineno-0-56">  56</a></span>
<span class="normal"><a href="#__codelineno-0-57">  57</a></span>
<span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">class</span> <span class="nc">PhotonicCrystal</span><span class="p">:</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a><span class="sd">    A class to represent a photonic crystal and perform simulations using MPB (MIT Photonic Bands).</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">        lattice_type (str): Type of the lattice.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="sd">        num_bands (int): Number of bands.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">        resolution (tuple[int, int] | int): Resolution of the simulation.</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        interp (int): Interpolation factor for k-points.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        periods (int): Number of periods.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        pickle_id (str): Identifier for pickling.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        has_been_run (bool): Flag indicating if the simulation has been run.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        geometry_lattice (None): Geometry lattice, set with basic lattice method.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        k_points (list): List of k-points.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">        k_points_interpolated (list): Interpolated k-points.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">        material (Crystal_Materials): Material of the photonic crystal.</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        geometry (Crystal_Geometry): Geometry of the photonic crystal.</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">        ms (None): Placeholder for ms attribute.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">        md (None): Placeholder for md attribute.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        freqs (dict): Dictionary to store frequencies.</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        gaps (dict): Dictionary to store gaps.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        epsilon (None): Placeholder for epsilon attribute.</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        modes (list): List to store modes.</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">        use_XY (bool): Flag to use XY plane.</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Methods:</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">        __getstate__(): Get the state for pickling.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">        __setstate__(state): Set the state after unpickling.</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">        pickle_photonic_crystal(pickle_id): Pickle the photonic crystal object.</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">        load_photonic_crystal(pickle_id): Load a pickled photonic crystal object.</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">        set_solver(k_point): Set the mode solver for the simulation.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        run_simulation(runner, polarization): Run the simulation to calculate the frequencies and gaps.</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        run_simulation_with_output(runner, polarization): Run the simulation and get mode data.</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        run_dumb_simulation(): Run a dumb simulation to quickly extract some values.</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        convert_mode_fields(mode, periods): Convert the mode fields to arrays for visualization.</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        extract_data(periods): Extract the data from the simulation.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">        plot_epsilon(fig, title): Plot the epsilon of the photonic crystal interactively using Plotly.</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        plot_bands(polarization, title, fig, color): Plot the bands of the photonic crystal using Plotly.</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">        get_XY_k_points_near_gamma(distance): Get the relevant k-points near the gamma point for the X and Y directions.</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">        get_high_symmetry_points(): Get the high symmetry points for the photonic crystal lattice.</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">        plot_field(target_polarization, target_k_point, target_frequency, frequency_tolerance, k_point_max_distance, periods, component, quantity, colorscale): Plot the field visualization.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">        plot_field_components(target_polarization, target_k_point, target_frequency, frequency_tolerance, k_point_max_distance, periods, quantity, colorscale): Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a><span class="sd">        look_for_mode(polarization, k_point, freq, freq_tolerance, k_point_max_distance): Look for modes within the specified criteria.</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a><span class="sd">        find_modes_symmetries(): Find the symmetries of the modes.</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a><span class="sd">        plot_modes_vectorial_fields(modes, sizemode, names): Plot the vectorial fields of the modes.</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a><span class="sd">        plot_mode_fields_normal_to_k(mode, k): Plot the fields perpendicular to the wavevector k for the mode.</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a><span class="sd">        plot_vectorial_fields(fields, colorscales, names): Plot the vectorial fields of the modes.</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a><span class="sd">        _field_to_cones(field, colorscale, sizemode, sizeref, clim): Convert a field to cones for visualization.</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="sd">        _fields_to_cones(fields, colorscale, sizemode, sizeref, clim, colorscales): Convert a list of fields to cones for visualization.</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="sd">        _calculate_field_norm_to_k(fields, k): Calculate the components of the field perpendicular to the wavevector k.</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">        _get_direction(k_vector): Determine the primary direction of the wavevector k.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        _calculate_effective_parameter(mode): Calculate the effective parameters of the mode.</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        basic_geometry(): Define the basic geometry of the photonic crystal.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        basic_lattice(): Define the basic lattice of the photonic crystal.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>                <span class="n">lattice_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>                <span class="n">material</span><span class="p">:</span> <span class="n">Crystal_Materials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>                <span class="n">geometry</span><span class="p">:</span> <span class="n">Crystal_Geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>                <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>                <span class="n">resolution</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>                <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>                <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>                <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>                <span class="n">k_points</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>                <span class="n">use_XY</span>  <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>                <span class="p">):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        Initializes the PhotonicCrystal class with the given parameters.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            lattice_type (str, optional): Type of the lattice. Defaults to None.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">            material (Crystal_Materials, optional): The material object. Defaults to None.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            geometry (Crystal_Geometry, optional): The geometry object. Defaults to None.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            num_bands (int, optional): Number of bands. Defaults to 6.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            resolution (tuple[int, int] | int, optional): Resolution of the simulation. Defaults to 32.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            interp (int, optional): Interpolation factor for k-points. Defaults to 4.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            periods (int, optional): Number of periods. Defaults to 3.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            pickle_id (str, optional): Identifier for pickling. Defaults to None.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            k_points (list, optional): List of k-points. Defaults to None.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">            use_XY (bool, optional): Flag to use XY plane. Defaults to True.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">        Attributes:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">            lattice_type (str): Type of the lattice.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">            num_bands (int): Number of bands.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">            resolution (tuple[int, int] | int): Resolution of the simulation.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">            interp (int): Interpolation factor for k-points.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">            periods (int): Number of periods.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">            pickle_id (str): Identifier for pickling.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">            has_been_run (bool): Flag indicating if the simulation has been run.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">            geometry_lattice (None): Geometry lattice, set with basic lattice method.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            k_points (list): List of k-points.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            k_points_interpolated (list): Interpolated k-points.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">            material (Crystal_Materials): Material of the photonic crystal.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            geometry (Crystal_Geometry): Geometry of the photonic crystal.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">            ms (None): Placeholder for ms attribute.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">            md (None): Placeholder for md attribute.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">            freqs (dict): Dictionary to store frequencies.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">            gaps (dict): Dictionary to store gaps.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">            epsilon (None): Placeholder for epsilon attribute.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">            modes (list): List to store modes.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            use_XY (bool): Flag to use XY plane.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">=</span> <span class="n">lattice_type</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span> <span class="o">=</span> <span class="n">num_bands</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">interp</span> <span class="o">=</span> <span class="n">interp</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">periods</span> <span class="o">=</span> <span class="n">periods</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">pickle_id</span> <span class="o">=</span> <span class="n">pickle_id</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">has_been_run</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#update this manually</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="c1">#this values are set with basic lattice method</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="o">=</span> <span class="kc">None</span> 
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="n">k_points</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="c1">#material</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span> <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">basic_material</span><span class="p">()</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="c1">#geometry</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">(</span><span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">use_XY</span> <span class="o">=</span> <span class="n">use_XY</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">def</span> <span class="nf">__getstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="c1"># Exclude the non-picklable SWIG objects</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;ms&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">state</span><span class="p">[</span><span class="s1">&#39;md&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">return</span> <span class="n">state</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="k">def</span> <span class="nf">__setstate__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>        <span class="c1"># You may want to reinitialize &#39;ms&#39; and &#39;md&#39; if needed after loading.</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="k">def</span> <span class="nf">pickle_photonic_crystal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">):</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Pickle the photonic crystal object.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            pickle_id (str): The identifier for the pickle file.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pickle_id</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">def</span> <span class="nf">load_photonic_crystal</span><span class="p">(</span><span class="n">pickle_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PhotonicCrystal&#39;</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Load a pickled photonic crystal object.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">            pickle_id (str): The identifier for the pickle file.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">            PhotonicCrystal: The loaded photonic crystal object.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pickle_id</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>            <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_point</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">        Set the mode solver for the simulation. </span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        For how MPB works, it is better to call this method each time you want to run a simulation.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        This method initializes the mode solver (ms) with the geometry, geometry lattice, </span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        k-points, resolution, and number of bands. If a specific k-point is provided, </span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">        the solver is set up for that k-point. Otherwise, it uses the interpolated k-points.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">            k_point (mp.Vector3, optional): The k-point for the simulation. Default is None.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">if</span> <span class="n">k_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                                  <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                                  <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">k_point</span><span class="p">],</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                                  <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                                  <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                                    <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                                    <span class="n">k_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                                    <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                                    <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zeven&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">        Run the simulation to calculate the frequencies and gaps.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">            runner (str): The name of the function to run the simulation. Default is &#39;run_zeven&#39;. </span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">                runner must correspond to an MPB runner. For example:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">                - &#39;run_zeven&#39;: Run the simulation for even parity modes in z-axis.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">                - &#39;run_zodd&#39;: Run the simulation for odd parity modes in z-axis.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">                - &#39;run_tm&#39;: Run the simulation for transverse magnetic modes.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">                - &#39;run_te&#39;: Run the simulation for transverse electric modes.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">                - &#39;run&#39;: Do not consider symmetry.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">            polarization (str, optional): The polarization of the simulation. Default is None. If None, it uses the runner name.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">                This will be stored in the mode data.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before running the simulation.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="k">if</span> <span class="n">polarization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">polarization</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>            <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;run_&quot;</span><span class="p">):</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>                <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>                <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>        <span class="c1"># This is a custom mpb output function that stores the fields and frequencies</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="k">def</span> <span class="nf">get_mode_data</span><span class="p">(</span><span class="n">ms</span><span class="p">:</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>            <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>                <span class="s2">&quot;h_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>                <span class="s2">&quot;e_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>                <span class="s2">&quot;e_field_periodic&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>                <span class="s2">&quot;h_field_periodic&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>                <span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                <span class="s2">&quot;k_point&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">current_k</span><span class="p">,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="n">polarization</span><span class="p">,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>            <span class="p">}</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">runner</span><span class="p">)(</span><span class="n">get_mode_data</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">all_freqs</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">gap_list</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">def</span> <span class="nf">run_simulation_with_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zeven&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">        Run the simulation and get mode data. Mode data are not stored in the crystal object, </span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">        but are returned as a list of dictionaries.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">            runner (str): The name of the function to run the simulation. Default is &#39;run_zeven&#39;. </span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">                runner must correspond to an MPB runner. For example: </span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">                - &#39;run_zeven&#39;: Run the simulation for even parity modes in z-axis.</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">                - &#39;run_zodd&#39;: Run the simulation for odd parity modes in z-axis.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">                - &#39;run_tm&#39;: Run the simulation for transverse magnetic modes.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">                - &#39;run_te&#39;: Run the simulation for transverse electric modes.</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">                - &#39;run&#39;: Do not consider symmetry.   </span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">            polarization (str, optional): The polarization of the simulation. Default is None. If None, it uses the runner name.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before running the simulation.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="k">if</span> <span class="n">polarization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">polarization</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>            <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;run_&quot;</span><span class="p">):</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>                <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>                <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">modes</span><span class="o">=</span><span class="p">[]</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="c1"># This is a custom mpb output function that stores the fields and frequencies</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>        <span class="k">def</span> <span class="nf">get_mode_data</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="s2">&quot;h_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                <span class="s2">&quot;e_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="s2">&quot;h_field_periodic&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>                <span class="s2">&quot;e_field_periodic&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>                <span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>                <span class="s2">&quot;k_point&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">current_k</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>                <span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="n">polarization</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="p">}</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">runner</span><span class="p">)(</span><span class="n">get_mode_data</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">fix_efield_phase</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">fix_hfield_phase</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>        <span class="k">return</span> <span class="n">modes</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>    <span class="k">def</span> <span class="nf">run_dumb_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">:</span>    
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">        Run a dumb simulation.  It is the first band of the gamma point.</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">        This is used to quickly extract some values from the simulation later. </span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">        For example it can be used to extract epsilon values.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="c1">#run the simulation in the gamma point, find one mode</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                                  <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                                  <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()],</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                                  <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                                  <span class="n">num_bands</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>        <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>        <span class="k">return</span> <span class="n">ms</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>    <span class="k">def</span> <span class="nf">convert_mode_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">        Convert the mode fields to mpb.MPBArray for visualization.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">        Apparently this is necessary to visualize the fields if crystal is restored from pickle.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">            mode (dict): The mode dictionary.</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">            periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">            tuple: A tuple containing the electric field array and the magnetic field array for visualization.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>            <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>            <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>            <span class="n">e_field</span> <span class="o">=</span>  <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="n">h_field</span> <span class="o">=</span>  <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">)</span>            
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="k">return</span> <span class="n">e_field</span><span class="p">,</span> <span class="n">h_field</span> 
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>    <span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periods</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">        Extract the data from the simulation. Basically it creates a MPBData object.</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">            periods (int, optional): The number of periods to extract. Default is 5.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">            mpb.MPBData: The MPB data object.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before extracting data.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">md</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>    <span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">        Plot the epsilon of the photonic crystal interactively using Plotly.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">        Not implemented in the base class. Must be implemented in the derived class.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">            fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">            title (str, optional): The title of the plot. Default is &#39;Epsilon&#39;.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">            go.Figure: The Plotly figure object.(Not woroking yet, error is thrown)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="k">def</span> <span class="nf">plot_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;te&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bands&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">        Plot the bands of the photonic crystal using Plotly.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">        This method plots the bands for the specified polarization.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        In Dash and Jupyter Notebook, the plot is interactive and data are shown on hover.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">            polarization (str, optional): The polarization of the bands. Default is &#39;te&#39;.</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">            title (str, optional): The title of the plot. Default is &#39;Bands&#39;.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">            fig (go.Figure, optional): The Plotly figure to add the bands plot to. Default is None.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">            color (str, optional): The color of the bands. Default is &#39;blue&#39;.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">            go.Figure: The Plotly figure object.</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation not run yet. Please run the simulation first.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="k">return</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="n">gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>        <span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)))</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>        <span class="c1"># Extract the interpolated k-points as vectors and format them for hover and click</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>        <span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="p">[</span><span class="n">kp</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">]</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>        <span class="c1"># Iterate through each frequency band and add them to the plot</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>        <span class="k">for</span> <span class="n">band_index</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">freqs</span><span class="p">)):</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>            <span class="c1"># Generate hover text with the corresponding k-point and frequency</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>            <span class="n">hover_texts</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>                <span class="sa">f</span><span class="s2">&quot;k-point: (</span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">x</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">y</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">z</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&lt;br&gt;frequency: </span><span class="si">{</span><span class="n">f</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>                <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>            <span class="p">]</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>            <span class="n">modes</span> <span class="o">=</span><span class="p">[]</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">):</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>                <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">polarization</span><span class="p">,</span> <span class="n">kp</span><span class="p">,</span> <span class="n">band</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">freq_tolerance</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>                <span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>            <span class="c1"># Add the line trace with hover info</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>                <span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span> 
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>                <span class="n">y</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> 
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>                <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>                <span class="n">text</span><span class="o">=</span><span class="n">hover_texts</span><span class="p">,</span>  <span class="c1"># Custom hover text</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>                <span class="n">hoverinfo</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span>  <span class="c1"># Display only the custom hover text</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>                <span class="n">customdata</span><span class="o">=</span><span class="p">[(</span><span class="n">kp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">polarization</span><span class="p">)</span> <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">,</span> <span class="n">band</span><span class="p">)],</span>  <span class="c1"># Attach k-points and frequency as custom data</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>                <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Hide from legend (well add a separate legend entry)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>                <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group traces by polarization for toggling visibility</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Initially visible</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>                <span class="n">selectedpoints</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Placeholder for selected points</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>                <span class="n">selected</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)),</span>  <span class="c1"># Change color and size of selected points</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>                <span class="n">unselected</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>  <span class="c1"># Make unselected points more transparent</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>            <span class="p">))</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>        <span class="c1"># Add bandgap shading (optional, grouped with the polarization for toggling visibility)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">for</span> <span class="n">gap</span> <span class="ow">in</span> <span class="n">gaps</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="k">if</span> <span class="n">gap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                    <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                    <span class="n">x0</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                    <span class="n">x1</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                    <span class="n">y0</span><span class="o">=</span><span class="n">gap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                    <span class="n">y1</span><span class="o">=</span><span class="n">gap</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                    <span class="n">fillcolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> 
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                    <span class="n">line_width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                    <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;below&quot;</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                    <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group shading with the same polarization</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Initially visible</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>                <span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>        <span class="c1"># Add a single legend entry for toggling visibility</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">polarization</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># Legend entry for the polarization</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>            <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group with the same polarization traces</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Show the legend entry</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Initially visible</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>        <span class="p">))</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>        <span class="c1"># Customize the x-axis </span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Use X and Y directions for the x-axis</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>            <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_XY_k_points_near_gamma</span><span class="p">()</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>                <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                    <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                    <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                    <span class="n">ticktext</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># Only three values, no repetition</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>                <span class="p">),</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>                <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;frequency (c/a)&#39;</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>                <span class="n">dragmode</span><span class="o">=</span><span class="s1">&#39;select&#39;</span><span class="p">,</span>  <span class="c1"># Enables rectangular selection</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>                <span class="n">clickmode</span><span class="o">=</span><span class="s1">&#39;event+select&#39;</span><span class="p">,</span>  <span class="c1"># Enable click events and selection events</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>                <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>  <span class="c1"># This ensures that clicking the legend will toggle visibility</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                    <span class="n">itemclick</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span>  <span class="c1"># Toggle visibility when clicked</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                    <span class="n">itemdoubleclick</span><span class="o">=</span><span class="s2">&quot;toggleothers&quot;</span>  <span class="c1"># Double-click to hide/show other entries</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>                <span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>            <span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>            <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_high_symmetry_points</span><span class="p">()</span> <span class="c1"># Use high symmetry points for the x-axis </span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                                                                <span class="c1"># Gamma, X, M for square lattice and</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                                                                <span class="c1"># Gamma, K, M for triangular lattice                                                   </span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>                <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                    <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                    <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                    <span class="n">ticktext</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Repeat the first element at the end</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>                <span class="p">),</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>                <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;frequency (c/a)&#39;</span><span class="p">,</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>                <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>                <span class="n">dragmode</span><span class="o">=</span><span class="s1">&#39;select&#39;</span><span class="p">,</span>  <span class="c1"># Enables rectangular selection</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>                <span class="n">clickmode</span><span class="o">=</span><span class="s1">&#39;event+select&#39;</span><span class="p">,</span>  <span class="c1"># Enable click events and selection events</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>                <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>  <span class="c1"># This ensures that clicking the legend will toggle visibility</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                    <span class="n">itemclick</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span>  <span class="c1"># Toggle visibility when clicked</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                    <span class="n">itemdoubleclick</span><span class="o">=</span><span class="s2">&quot;toggleothers&quot;</span>  <span class="c1"># Double-click to hide/show other entries</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>                <span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>            <span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>        <span class="k">return</span> <span class="n">fig</span>
<a id="__codelineno-0-518" name="__codelineno-0-518"></a>
<a id="__codelineno-0-519" name="__codelineno-0-519"></a>
<a id="__codelineno-0-520" name="__codelineno-0-520"></a>    <span class="k">def</span> <span class="nf">get_XY_k_points_near_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">        Get the relevant k-points near the gamma point for the X and Y directions.</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">        This is useful for plotting the bands with the X and Y directions on the x-axis.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">            distance (float): The distance from the gamma point. Default is 0.1.</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">            dict: A dictionary with the relevant k-points for the X and Y directions.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">            with the k-point names as keys and the k-point vectors as values.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Distance must be less than 0.5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>        <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>            <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>            <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>        <span class="p">}</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>        <span class="k">return</span> <span class="n">relevant_k_points</span>
<a id="__codelineno-0-541" name="__codelineno-0-541"></a>
<a id="__codelineno-0-542" name="__codelineno-0-542"></a>    <span class="k">def</span> <span class="nf">get_high_symmetry_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">        Get the high symmetry points for the photonic crystal lattice.</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">        This is useful for plotting the bands with the high symmetry points on the x-axis.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">            dict: A dictionary with the high symmetry points for the lattice.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">            with the k-point names as keys and the k-point vectors as values.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>        <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>                <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>                <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>                <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="p">}</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>            <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>                <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>                <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>                <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>            <span class="p">}</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>        <span class="k">return</span> <span class="n">k_high_sym</span>
<a id="__codelineno-0-566" name="__codelineno-0-566"></a>
<a id="__codelineno-0-567" name="__codelineno-0-567"></a>
<a id="__codelineno-0-568" name="__codelineno-0-568"></a>    <span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>        <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>        <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>        <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>        <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>        <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>        <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="n">component</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>        <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;RdBu&quot;</span><span class="p">,</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>        <span class="o">**</span><span class="n">kwargs</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a>    <span class="p">):</span> 
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">        Plot the field visualization.</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">        Not implemented in the base class. Must be implemented in the derived class.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">            target_polarization (str): The polarization of the mode.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">            target_k_point (tuple): The k-point of the mode.</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">            target_frequency (float): The frequency of the mode.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">            frequency_tolerance (float): The tolerance for frequency similarity. Default is 0.01.</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">            k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">            periods (int): The number of periods to extract. Default is 5.</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">            component (int): The component of the field to plot. Default is 2.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">            quantity (str): The quantity of the field to plot. Default is &quot;real&quot;.</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">            bloch_phase (bool): Whether to include the Bloch phase. Default is True.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">            colorscale (str): The colorscale for the plot. Default is &quot;RdBu&quot;.</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">            kwargs: Additional keyword arguments for the plot.</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">            tuple[go.Figure, go.Figure]: A tuple containing the Plotly figures for the electric and magnetic fields.           </span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;plot_field method not implemented yet.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="k">def</span> <span class="nf">plot_field_components</span><span class="p">(</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>            <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>            <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>            <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>            <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>            <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>            <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>            <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>            <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>            <span class="p">):</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        Plot the field visualization.</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">        Not implemented in the base class. Must be implemented in the derived class.</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">            target_polarization (str): The polarization of the mode.</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">            target_k_point (tuple): The k-point of the mode.</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">            target_frequency (float): The frequency of the mode.</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">            frequency_tolerance (float): The tolerance for frequency similarity. Default is 0.01.</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">            k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">            periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">            quantity (str): The quantity of the field to plot. Default is &quot;real&quot;.</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">            colorscale (str): The colorscale for the plot. Default is &quot;RdBu&quot;.</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">            tuple[go.Figure, go.Figure]: A tuple containing the Plotly figures for the electric and magnetic fields.           </span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;plot_field_components method not implemented yet.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>    <span class="k">def</span> <span class="nf">look_for_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="p">,</span> <span class="n">k_point</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span>  <span class="n">freq_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        Look for modes within the specified criteria.</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">            polarization (str): The polarization of the mode.</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">            k_point (tuple): The k-point of the mode.</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">            freq (float): The frequency of the mode.</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">            freq_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">            k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">            list: A list of mode dictionaries that match the criteria.</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>        <span class="n">target_modes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>        <span class="k">if</span> <span class="n">k_point_max_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>                <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polarization</span> <span class="ow">and</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k_point</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">freq_tolerance</span><span class="p">:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                    <span class="n">target_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>            <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>                <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polarization</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k_point</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">k_point_max_distance</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">freq_tolerance</span><span class="p">:</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                    <span class="n">target_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>        <span class="k">return</span> <span class="n">target_modes</span>
<a id="__codelineno-0-666" name="__codelineno-0-666"></a>
<a id="__codelineno-0-667" name="__codelineno-0-667"></a>
<a id="__codelineno-0-668" name="__codelineno-0-668"></a>
<a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="k">def</span> <span class="nf">find_modes_symmetries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">        Find the symmetries of the modes.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">        Not implemented yet. TODO</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;find_modes_symmetries method not implemented yet.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-675" name="__codelineno-0-675"></a>
<a id="__codelineno-0-676" name="__codelineno-0-676"></a>
<a id="__codelineno-0-677" name="__codelineno-0-677"></a>
<a id="__codelineno-0-678" name="__codelineno-0-678"></a>    <span class="k">def</span> <span class="nf">plot_modes_vectorial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Electric Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Magnetic Field&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">        Plot the vectorial fields of the modes.</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">            modes (list): The list of modes to plot.</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">            sizemode (str): The sizemode for the cones. Default is &#39;scaled&#39;.</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">            names (list): The names of the fields. Default is [&#39;Electric Field&#39;, &#39;Magnetic Field&#39;].</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">            tuple: A tuple containing the Plotly figures for the electric and magnetic fields.</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>        <span class="n">colorscales</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blues&quot;</span><span class="p">,</span> <span class="s2">&quot;reds&quot;</span><span class="p">,</span> <span class="s2">&quot;greens&quot;</span><span class="p">,</span> <span class="s2">&quot;purples&quot;</span><span class="p">,</span> <span class="s2">&quot;oranges&quot;</span><span class="p">,</span> <span class="s2">&quot;ylorbr&quot;</span><span class="p">]</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>        <span class="n">h_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>        <span class="n">e_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="n">max_norm_h</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_calculate_fields_max_norms</span><span class="p">(</span><span class="n">h_fields</span><span class="p">)</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>        <span class="n">max_norm_e</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_calculate_fields_max_norms</span><span class="p">(</span><span class="n">e_fields</span><span class="p">)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">e_sizeref</span> <span class="o">=</span> <span class="n">max_norm_e</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>        <span class="n">h_sizeref</span> <span class="o">=</span> <span class="n">max_norm_h</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>        <span class="n">e_clim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_norm_e</span><span class="p">)</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>        <span class="n">h_clim</span><span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_norm_h</span><span class="p">)</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>        <span class="n">e_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>        <span class="n">h_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="n">e_cones</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_fields_to_cones</span><span class="p">(</span><span class="n">e_fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">e_sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">e_clim</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="n">colorscales</span><span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="n">h_cones</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_fields_to_cones</span><span class="p">(</span><span class="n">h_fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">h_sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">h_clim</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="n">colorscales</span><span class="p">)</span> 
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>        <span class="k">for</span> <span class="n">e_cone</span> <span class="ow">in</span> <span class="n">e_cones</span><span class="p">:</span>  
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>            <span class="n">e_fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">e_cone</span><span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>        <span class="k">for</span> <span class="n">h_cone</span> <span class="ow">in</span> <span class="n">h_cones</span><span class="p">:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>            <span class="n">h_fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">h_cone</span><span class="p">)</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>        <span class="n">e_fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>            <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="p">),</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>        <span class="p">)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>        <span class="n">h_fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>            <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>            <span class="p">),</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>        <span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>        <span class="k">return</span> <span class="n">e_fig</span><span class="p">,</span> <span class="n">h_fig</span>
<a id="__codelineno-0-742" name="__codelineno-0-742"></a>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>
<a id="__codelineno-0-747" name="__codelineno-0-747"></a>    <span class="k">def</span> <span class="nf">plot_mode_fields_normal_to_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">        Plot the fields perpendicular to the wavevector k for the mode.</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="sd">        To be tested, not sure if works correctly.</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">            mode (dict): The mode dictionary.</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">            k (numpy.ndarray): The wavevector [kx, ky, kz].</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">            tuple: A tuple containing the Plotly figures for the electric and magnetic fields.</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>        <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>        <span class="n">fields_norm_to_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_field_norm_to_k</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields_norm_to_k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;blues&quot;</span><span class="p">))</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields_norm_to_k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;reds&quot;</span><span class="p">))</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span> 
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>    <span class="k">def</span> <span class="nf">plot_vectorial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span><span class="s2">&quot;Viridis&quot;</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Field 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Field 2&quot;</span><span class="p">]):</span> 
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">        Plot the vectorial fields of the modes.</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">            fields (list): The list of fields to plot.</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">            colorscales (list, optional): The colorscales for the cones. Default is [&quot;Viridis&quot;, &quot;Viridis&quot;].</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">            names (list, optional): The names of the fields. Default is [&quot;Field 1&quot;, &quot;Field 2&quot;].</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">            tuple: A tuple containing the Plotly figures for the electric and magnetic fields.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>            <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>            <span class="p">),</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>        <span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>            <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>            <span class="p">),</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>            <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>        <span class="p">)</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
<a id="__codelineno-0-808" name="__codelineno-0-808"></a>
<a id="__codelineno-0-809" name="__codelineno-0-809"></a>
<a id="__codelineno-0-810" name="__codelineno-0-810"></a>
<a id="__codelineno-0-811" name="__codelineno-0-811"></a>
<a id="__codelineno-0-812" name="__codelineno-0-812"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-813" name="__codelineno-0-813"></a>    <span class="k">def</span> <span class="nf">_field_to_cones</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Cone</span><span class="p">:</span>
<a id="__codelineno-0-814" name="__codelineno-0-814"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-815" name="__codelineno-0-815"></a><span class="sd">        Convert a field to cones for visualization.</span>
<a id="__codelineno-0-816" name="__codelineno-0-816"></a><span class="sd">        Auxiliar method for plotting the fields.</span>
<a id="__codelineno-0-817" name="__codelineno-0-817"></a>
<a id="__codelineno-0-818" name="__codelineno-0-818"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-819" name="__codelineno-0-819"></a><span class="sd">            field (np.ndarray): The field to convert.</span>
<a id="__codelineno-0-820" name="__codelineno-0-820"></a><span class="sd">            colorscale (str): The colorscale for the cones. Default is &#39;Viridis&#39;.</span>
<a id="__codelineno-0-821" name="__codelineno-0-821"></a><span class="sd">            sizemode (str): The sizemode for the cones. Default is &#39;absolute&#39;.</span>
<a id="__codelineno-0-822" name="__codelineno-0-822"></a><span class="sd">            sizeref (float): The sizeref for the cones. Default is 1.</span>
<a id="__codelineno-0-823" name="__codelineno-0-823"></a><span class="sd">            clim (tuple): The color limits for the cones. Default is (0, 1). (Not used now)</span>
<a id="__codelineno-0-824" name="__codelineno-0-824"></a>
<a id="__codelineno-0-825" name="__codelineno-0-825"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-826" name="__codelineno-0-826"></a><span class="sd">            go.Cone: The Plotly cone object for visualization.</span>
<a id="__codelineno-0-827" name="__codelineno-0-827"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-828" name="__codelineno-0-828"></a>        <span class="n">field_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-829" name="__codelineno-0-829"></a>        <span class="n">field_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-830" name="__codelineno-0-830"></a>        <span class="n">field_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-831" name="__codelineno-0-831"></a>
<a id="__codelineno-0-832" name="__codelineno-0-832"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-833" name="__codelineno-0-833"></a>
<a id="__codelineno-0-834" name="__codelineno-0-834"></a>
<a id="__codelineno-0-835" name="__codelineno-0-835"></a>        <span class="n">cone</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Cone</span><span class="p">(</span>
<a id="__codelineno-0-836" name="__codelineno-0-836"></a>            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
<a id="__codelineno-0-837" name="__codelineno-0-837"></a>            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
<a id="__codelineno-0-838" name="__codelineno-0-838"></a>            <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
<a id="__codelineno-0-839" name="__codelineno-0-839"></a>            <span class="n">u</span><span class="o">=</span><span class="n">field_x</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
<a id="__codelineno-0-840" name="__codelineno-0-840"></a>            <span class="n">v</span><span class="o">=</span><span class="n">field_y</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
<a id="__codelineno-0-841" name="__codelineno-0-841"></a>            <span class="n">w</span><span class="o">=</span><span class="n">field_z</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
<a id="__codelineno-0-842" name="__codelineno-0-842"></a>            <span class="n">anchor</span><span class="o">=</span><span class="s1">&#39;tail&#39;</span><span class="p">,</span>
<a id="__codelineno-0-843" name="__codelineno-0-843"></a>            <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span>
<a id="__codelineno-0-844" name="__codelineno-0-844"></a>            <span class="n">sizeref</span><span class="o">=</span><span class="n">sizeref</span><span class="p">,</span>
<a id="__codelineno-0-845" name="__codelineno-0-845"></a>            <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-846" name="__codelineno-0-846"></a>            <span class="c1">#cmin = clim[0],</span>
<a id="__codelineno-0-847" name="__codelineno-0-847"></a>            <span class="c1">#cmax = clim[1],</span>
<a id="__codelineno-0-848" name="__codelineno-0-848"></a>        <span class="p">)</span>
<a id="__codelineno-0-849" name="__codelineno-0-849"></a>        <span class="k">return</span> <span class="n">cone</span>
<a id="__codelineno-0-850" name="__codelineno-0-850"></a>
<a id="__codelineno-0-851" name="__codelineno-0-851"></a>
<a id="__codelineno-0-852" name="__codelineno-0-852"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-853" name="__codelineno-0-853"></a>    <span class="k">def</span> <span class="nf">_fields_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s1">&#39;absolute&#39;</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">colorscales</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-855" name="__codelineno-0-855"></a><span class="sd">        Convert a list of fields to cones for visualization.</span>
<a id="__codelineno-0-856" name="__codelineno-0-856"></a><span class="sd">        Auxiliar method for plotting the fields.</span>
<a id="__codelineno-0-857" name="__codelineno-0-857"></a>
<a id="__codelineno-0-858" name="__codelineno-0-858"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-859" name="__codelineno-0-859"></a><span class="sd">            fields (list): The list of fields to convert.</span>
<a id="__codelineno-0-860" name="__codelineno-0-860"></a><span class="sd">            colorscale (str): The colorscale for the cones. Default is &#39;Viridis&#39;.</span>
<a id="__codelineno-0-861" name="__codelineno-0-861"></a><span class="sd">            sizemode (str): The sizemode for the</span>
<a id="__codelineno-0-862" name="__codelineno-0-862"></a><span class="sd">        - sizeref: The sizeref for the cones. Default is 1.</span>
<a id="__codelineno-0-863" name="__codelineno-0-863"></a><span class="sd">        - clim: The color limits for the cones. Default is (0, 1).</span>
<a id="__codelineno-0-864" name="__codelineno-0-864"></a><span class="sd">        - colorscales: The colorscales for the cones. Default is None.</span>
<a id="__codelineno-0-865" name="__codelineno-0-865"></a>
<a id="__codelineno-0-866" name="__codelineno-0-866"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-867" name="__codelineno-0-867"></a><span class="sd">        - cones: The list of cones for the fields.</span>
<a id="__codelineno-0-868" name="__codelineno-0-868"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-869" name="__codelineno-0-869"></a>
<a id="__codelineno-0-870" name="__codelineno-0-870"></a>
<a id="__codelineno-0-871" name="__codelineno-0-871"></a>        <span class="n">cones</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-872" name="__codelineno-0-872"></a>
<a id="__codelineno-0-873" name="__codelineno-0-873"></a>        <span class="k">if</span> <span class="n">colorscales</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-874" name="__codelineno-0-874"></a>            <span class="n">colorscales</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blues&quot;</span><span class="p">,</span> <span class="s2">&quot;reds&quot;</span><span class="p">,</span> <span class="s2">&quot;greens&quot;</span><span class="p">,</span> <span class="s2">&quot;purples&quot;</span><span class="p">,</span> <span class="s2">&quot;oranges&quot;</span><span class="p">,</span> <span class="s2">&quot;ylorbr&quot;</span><span class="p">]</span>
<a id="__codelineno-0-875" name="__codelineno-0-875"></a>
<a id="__codelineno-0-876" name="__codelineno-0-876"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">field</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">fields</span><span class="p">):</span>
<a id="__codelineno-0-877" name="__codelineno-0-877"></a>            <span class="n">cone</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">clim</span><span class="p">)</span>
<a id="__codelineno-0-878" name="__codelineno-0-878"></a>            <span class="n">cones</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cone</span><span class="p">)</span>
<a id="__codelineno-0-879" name="__codelineno-0-879"></a>        <span class="k">return</span> <span class="n">cones</span>
<a id="__codelineno-0-880" name="__codelineno-0-880"></a>
<a id="__codelineno-0-881" name="__codelineno-0-881"></a>
<a id="__codelineno-0-882" name="__codelineno-0-882"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-883" name="__codelineno-0-883"></a>    <span class="k">def</span> <span class="nf">_calculate_field_norm_to_k</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<a id="__codelineno-0-884" name="__codelineno-0-884"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-885" name="__codelineno-0-885"></a><span class="sd">        Calculate the components of the field perpendicular to the wavevector k for each field in the list.</span>
<a id="__codelineno-0-886" name="__codelineno-0-886"></a>
<a id="__codelineno-0-887" name="__codelineno-0-887"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-888" name="__codelineno-0-888"></a><span class="sd">            fields (list): A list of numpy arrays, each of shape (Nx, Ny, Nz, 3), where the last dimension contains the x, y, z components of the field.</span>
<a id="__codelineno-0-889" name="__codelineno-0-889"></a><span class="sd">            k (numpy.ndarray): A numpy array of shape (3,), representing the wavevector [kx, ky, kz].</span>
<a id="__codelineno-0-890" name="__codelineno-0-890"></a>
<a id="__codelineno-0-891" name="__codelineno-0-891"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-892" name="__codelineno-0-892"></a><span class="sd">            list: A list of numpy arrays, each of shape (Nx, Ny, Nz, 3), representing the field perpendicular to k for each input field.</span>
<a id="__codelineno-0-893" name="__codelineno-0-893"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-894" name="__codelineno-0-894"></a>        <span class="n">fields_norm_to_k</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-895" name="__codelineno-0-895"></a>
<a id="__codelineno-0-896" name="__codelineno-0-896"></a>        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
<a id="__codelineno-0-897" name="__codelineno-0-897"></a>            <span class="c1"># Normalize the wavevector k</span>
<a id="__codelineno-0-898" name="__codelineno-0-898"></a>            <span class="n">k_norm</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a id="__codelineno-0-899" name="__codelineno-0-899"></a>
<a id="__codelineno-0-900" name="__codelineno-0-900"></a>            <span class="c1"># Compute the dot product of each field vector with the normalized k</span>
<a id="__codelineno-0-901" name="__codelineno-0-901"></a>            <span class="n">dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;ijkl,l-&gt;ijk&#39;</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">k_norm</span><span class="p">)</span>  <span class="c1"># Efficiently computes the dot product</span>
<a id="__codelineno-0-902" name="__codelineno-0-902"></a>
<a id="__codelineno-0-903" name="__codelineno-0-903"></a>            <span class="c1"># Compute the parallel component of the field: (dot_product * k_norm)</span>
<a id="__codelineno-0-904" name="__codelineno-0-904"></a>            <span class="n">field_parallel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dot_product</span><span class="p">,</span> <span class="n">k_norm</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-905" name="__codelineno-0-905"></a>
<a id="__codelineno-0-906" name="__codelineno-0-906"></a>            <span class="c1"># Subtract the parallel component to get the perpendicular component</span>
<a id="__codelineno-0-907" name="__codelineno-0-907"></a>            <span class="n">field_norm_to_k</span> <span class="o">=</span> <span class="n">field</span> <span class="o">-</span> <span class="n">field_parallel</span>
<a id="__codelineno-0-908" name="__codelineno-0-908"></a>
<a id="__codelineno-0-909" name="__codelineno-0-909"></a>            <span class="n">fields_norm_to_k</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field_norm_to_k</span><span class="p">)</span>
<a id="__codelineno-0-910" name="__codelineno-0-910"></a>
<a id="__codelineno-0-911" name="__codelineno-0-911"></a>        <span class="k">return</span> <span class="n">fields_norm_to_k</span>
<a id="__codelineno-0-912" name="__codelineno-0-912"></a>
<a id="__codelineno-0-913" name="__codelineno-0-913"></a>
<a id="__codelineno-0-914" name="__codelineno-0-914"></a>
<a id="__codelineno-0-915" name="__codelineno-0-915"></a>
<a id="__codelineno-0-916" name="__codelineno-0-916"></a>
<a id="__codelineno-0-917" name="__codelineno-0-917"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-918" name="__codelineno-0-918"></a>    <span class="k">def</span> <span class="nf">_get_direction</span><span class="p">(</span><span class="n">k_vector</span><span class="p">):</span>
<a id="__codelineno-0-919" name="__codelineno-0-919"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="sd">        Determine the primary direction of the wavevector k.</span>
<a id="__codelineno-0-921" name="__codelineno-0-921"></a>
<a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">            k_vector: A numpy array or list of shape (3,), representing the wavevector [kx, ky, kz].</span>
<a id="__codelineno-0-924" name="__codelineno-0-924"></a>
<a id="__codelineno-0-925" name="__codelineno-0-925"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-926" name="__codelineno-0-926"></a><span class="sd">            int: 0 for x-direction, 1 for y-direction, 2 for z-direction.</span>
<a id="__codelineno-0-927" name="__codelineno-0-927"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-928" name="__codelineno-0-928"></a>        <span class="k">if</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-929" name="__codelineno-0-929"></a>            <span class="k">return</span> <span class="mi">0</span>  <span class="c1"># x-direction</span>
<a id="__codelineno-0-930" name="__codelineno-0-930"></a>        <span class="k">elif</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-931" name="__codelineno-0-931"></a>            <span class="k">return</span> <span class="mi">1</span>  <span class="c1"># y-direction</span>
<a id="__codelineno-0-932" name="__codelineno-0-932"></a>        <span class="k">elif</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">k_vector</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-933" name="__codelineno-0-933"></a>            <span class="k">return</span> <span class="mi">2</span>  <span class="c1"># z-direction</span>
<a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-935" name="__codelineno-0-935"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The wavevector k does not align with a primary axis.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-936" name="__codelineno-0-936"></a>
<a id="__codelineno-0-937" name="__codelineno-0-937"></a>
<a id="__codelineno-0-938" name="__codelineno-0-938"></a>
<a id="__codelineno-0-939" name="__codelineno-0-939"></a>
<a id="__codelineno-0-940" name="__codelineno-0-940"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="k">def</span> <span class="nf">_calculate_effective_parameter</span><span class="p">(</span><span class="n">mode</span><span class="p">):</span>
<a id="__codelineno-0-942" name="__codelineno-0-942"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-943" name="__codelineno-0-943"></a><span class="sd">        Calculate the effective parameters of the mode.</span>
<a id="__codelineno-0-944" name="__codelineno-0-944"></a>
<a id="__codelineno-0-945" name="__codelineno-0-945"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-946" name="__codelineno-0-946"></a><span class="sd">            mode (dict): The mode dictionary.</span>
<a id="__codelineno-0-947" name="__codelineno-0-947"></a>
<a id="__codelineno-0-948" name="__codelineno-0-948"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-949" name="__codelineno-0-949"></a><span class="sd">            dict: A dictionary with the effective parameters of the mode.</span>
<a id="__codelineno-0-950" name="__codelineno-0-950"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-951" name="__codelineno-0-951"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;calculate_effective_parameter method not implemented yet.&quot;</span><span class="p">)</span>  
<a id="__codelineno-0-952" name="__codelineno-0-952"></a>
<a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="k">def</span> <span class="nf">sweep_geometry_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_to_sweep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sweep_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">        Sweep a parameter of the geometry and run simulations for each value.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">            param_to_sweep (str): The parameter to sweep.</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">            sweep_values (list): The values to sweep.</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">            num_bands (int, optional): The number of bands to calculate. Defaults to 4.</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">            list: A list of dictionaries with the simulation data.</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="n">old_geom</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>        <span class="n">old_num_bands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>        <span class="n">partial_geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_partial</span><span class="p">(</span><span class="n">exclude_key</span><span class="o">=</span><span class="n">param_to_sweep</span><span class="p">)</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sweep_values</span><span class="p">:</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">param_to_sweep</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">partial_geom</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span> <span class="o">=</span> <span class="n">num_bands</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_solver</span><span class="p">(</span><span class="n">k_point</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">())</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="n">modes_zeven</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_simulation_with_output</span><span class="p">(</span><span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zeven&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;zeven&quot;</span><span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="n">modes_zodd</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_simulation_with_output</span><span class="p">(</span><span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zodd&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;zodd&quot;</span><span class="p">)</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>            <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>                <span class="s1">&#39;parameter_value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>                <span class="s1">&#39;modes_zeven&#39;</span><span class="p">:</span> <span class="n">modes_zeven</span><span class="p">,</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>                <span class="s1">&#39;modes_zodd&#39;</span><span class="p">:</span> <span class="n">modes_zodd</span><span class="p">,</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>                <span class="s1">&#39;parameter_name&#39;</span><span class="p">:</span> <span class="n">param_to_sweep</span><span class="p">,</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>            <span class="p">})</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">old_geom</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span> <span class="o">=</span> <span class="n">old_num_bands</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>        <span class="k">return</span> <span class="n">data</span>
<a id="__codelineno-0-988" name="__codelineno-0-988"></a>
<a id="__codelineno-0-989" name="__codelineno-0-989"></a>
<a id="__codelineno-0-990" name="__codelineno-0-990"></a>
<a id="__codelineno-0-991" name="__codelineno-0-991"></a>    <span class="k">def</span> <span class="nf">plot_sweep_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">        Plot the sweep result using Plotly.</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">            data (list): The data from the sweep.</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">            fig (go.Figure): The Plotly figure to add the plot to.</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">            go.Figure: The Plotly figure object.</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>        <span class="c1"># For each data parameter value in the x axis, add all the modes frequencies (mode[&quot;freq&quot;])in the y axis</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>        <span class="n">num_bands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modes_zeven&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>            <span class="n">modes_zeven</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;modes_zeven&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>            <span class="n">modes_zodd</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;modes_zodd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>            <span class="n">param_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>   
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">param_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modes_zeven</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> TE&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)))</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">param_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modes_zodd</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> TM&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)))</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>            <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>            <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>        <span class="p">)</span>   
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>            <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Parameter Value&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Frequency (c/a)&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sweep of </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>        <span class="p">)</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="k">return</span> <span class="n">fig</span>
<a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>
<a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>
<a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>
<a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>    <span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot; </span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">        Define the basic geometry of the photonic crystal.</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">        Must be implemented in the derived class.</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<a id="__codelineno-0-1038" name="__codelineno-0-1038"></a>
<a id="__codelineno-0-1039" name="__codelineno-0-1039"></a>
<a id="__codelineno-0-1040" name="__codelineno-0-1040"></a>    <span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">        Define the basic lattice of the photonic crystal.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">        Must be implemented in the derived class.</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="k">raise</span> <span class="ne">NotImplementedError</span>
<a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>
<a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>    <span class="k">def</span> <span class="nf">basic_material</span><span class="p">():</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">        Define the basic material of the photonic crystal.</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">            material (Crystal_Materials): Silicon Membrane. </span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>        <span class="n">material</span> <span class="o">=</span> <span class="n">Crystal_Materials</span><span class="p">()</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>        <span class="n">material</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>        <span class="n">material</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>        <span class="n">material</span><span class="o">.</span><span class="n">substrate</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>        <span class="n">material</span><span class="o">.</span><span class="n">bulk</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mf">11.8</span><span class="p">}</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>        <span class="k">return</span> <span class="n">material</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="src.photonic_crystal.PhotonicCrystal-functions">Functions<a href="#src.photonic_crystal.PhotonicCrystal-functions" class="headerlink" title="Anchor link to this section">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_bands</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pickle_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">k_points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.__init__" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Initializes the PhotonicCrystal class with the given parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the lattice. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>material</code>
            </td>
            <td>
                  <code><span title="crystal_materials.Crystal_Materials">Crystal_Materials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The material object. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code><span title="crystal_geometries.Crystal_Geometry">Crystal_Geometry</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geometry object. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_bands</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bands. Defaults to 6.</p>
              </div>
            </td>
            <td>
                  <code>6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution</code>
            </td>
            <td>
                  <code>tuple[int, int] | int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolution of the simulation. Defaults to 32.</p>
              </div>
            </td>
            <td>
                  <code>32</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interp</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation factor for k-points. Defaults to 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of periods. Defaults to 3.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Identifier for pickling. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_points</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k-points. Defaults to None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_XY</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to use XY plane. Defaults to True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.lattice_type">lattice_type</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Type of the lattice.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.num_bands">num_bands</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of bands.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.resolution">resolution</span></code></td>
            <td>
                  <code>tuple[int, int] | int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Resolution of the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.interp">interp</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolation factor for k-points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.periods">periods</span></code></td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Number of periods.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.pickle_id">pickle_id</span></code></td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Identifier for pickling.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.has_been_run">has_been_run</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag indicating if the simulation has been run.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.geometry_lattice">geometry_lattice</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geometry lattice, set with basic lattice method.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.k_points">k_points</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k-points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.k_points_interpolated">k_points_interpolated</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolated k-points.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.material">material</span></code></td>
            <td>
                  <code><span title="crystal_materials.Crystal_Materials">Crystal_Materials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Material of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.geometry">geometry</span></code></td>
            <td>
                  <code><span title="crystal_geometries.Crystal_Geometry">Crystal_Geometry</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geometry of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.ms">ms</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Placeholder for ms attribute.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.md">md</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Placeholder for md attribute.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.freqs">freqs</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store frequencies.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.gaps">gaps</span></code></td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dictionary to store gaps.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.epsilon">epsilon</span></code></td>
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Placeholder for epsilon attribute.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.modes">modes</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List to store modes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.PhotonicCrystal.__init__.use_XY">use_XY</span></code></td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flag to use XY plane.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>            <span class="n">lattice_type</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>            <span class="n">material</span><span class="p">:</span> <span class="n">Crystal_Materials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>            <span class="n">geometry</span><span class="p">:</span> <span class="n">Crystal_Geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>            <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>            <span class="n">resolution</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>            <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">k_points</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="n">use_XY</span>  <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="p">):</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">    Initializes the PhotonicCrystal class with the given parameters.</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        lattice_type (str, optional): Type of the lattice. Defaults to None.</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        material (Crystal_Materials, optional): The material object. Defaults to None.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        geometry (Crystal_Geometry, optional): The geometry object. Defaults to None.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        num_bands (int, optional): Number of bands. Defaults to 6.</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        resolution (tuple[int, int] | int, optional): Resolution of the simulation. Defaults to 32.</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">        interp (int, optional): Interpolation factor for k-points. Defaults to 4.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        periods (int, optional): Number of periods. Defaults to 3.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        pickle_id (str, optional): Identifier for pickling. Defaults to None.</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        k_points (list, optional): List of k-points. Defaults to None.</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        use_XY (bool, optional): Flag to use XY plane. Defaults to True.</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        lattice_type (str): Type of the lattice.</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">        num_bands (int): Number of bands.</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">        resolution (tuple[int, int] | int): Resolution of the simulation.</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">        interp (int): Interpolation factor for k-points.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">        periods (int): Number of periods.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">        pickle_id (str): Identifier for pickling.</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">        has_been_run (bool): Flag indicating if the simulation has been run.</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">        geometry_lattice (None): Geometry lattice, set with basic lattice method.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        k_points (list): List of k-points.</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        k_points_interpolated (list): Interpolated k-points.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        material (Crystal_Materials): Material of the photonic crystal.</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">        geometry (Crystal_Geometry): Geometry of the photonic crystal.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        ms (None): Placeholder for ms attribute.</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">        md (None): Placeholder for md attribute.</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        freqs (dict): Dictionary to store frequencies.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        gaps (dict): Dictionary to store gaps.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        epsilon (None): Placeholder for epsilon attribute.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        modes (list): List to store modes.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        use_XY (bool): Flag to use XY plane.</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">=</span> <span class="n">lattice_type</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span> <span class="o">=</span> <span class="n">num_bands</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span> <span class="n">resolution</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">interp</span> <span class="o">=</span> <span class="n">interp</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">periods</span> <span class="o">=</span> <span class="n">periods</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">pickle_id</span> <span class="o">=</span> <span class="n">pickle_id</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">has_been_run</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#update this manually</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="c1">#this values are set with basic lattice method</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="o">=</span> <span class="kc">None</span> 
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="n">k_points</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="c1">#material</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span> <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">basic_material</span><span class="p">()</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="c1">#geometry</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">(</span><span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">use_XY</span> <span class="o">=</span> <span class="n">use_XY</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">pickle_photonic_crystal</span><span class="p">(</span><span class="n">pickle_id</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.pickle_photonic_crystal" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Pickle the photonic crystal object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The identifier for the pickle file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="k">def</span> <span class="nf">pickle_photonic_crystal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">):</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Pickle the photonic crystal object.</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">        pickle_id (str): The identifier for the pickle file.</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pickle_id</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_photonic_crystal</span><span class="p">(</span><span class="n">pickle_id</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.photonic_crystal.PhotonicCrystal.load_photonic_crystal" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Load a pickled photonic crystal object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The identifier for the pickle file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>PhotonicCrystal</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal" href="#src.photonic_crystal.PhotonicCrystal">PhotonicCrystal</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The loaded photonic crystal object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="k">def</span> <span class="nf">load_photonic_crystal</span><span class="p">(</span><span class="n">pickle_id</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PhotonicCrystal&#39;</span><span class="p">:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Load a pickled photonic crystal object.</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        pickle_id (str): The identifier for the pickle file.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        PhotonicCrystal: The loaded photonic crystal object.</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pickle_id</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="k">return</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.set_solver" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">set_solver</span><span class="p">(</span><span class="n">k_point</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.set_solver" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Set the mode solver for the simulation. 
For how MPB works, it is better to call this method each time you want to run a simulation.
This method initializes the mode solver (ms) with the geometry, geometry lattice, 
k-points, resolution, and number of bands. If a specific k-point is provided, 
the solver is set up for that k-point. Otherwise, it uses the interpolated k-points.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>k_point</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point for the simulation. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="k">def</span> <span class="nf">set_solver</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k_point</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    Set the mode solver for the simulation. </span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">    For how MPB works, it is better to call this method each time you want to run a simulation.</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">    This method initializes the mode solver (ms) with the geometry, geometry lattice, </span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">    k-points, resolution, and number of bands. If a specific k-point is provided, </span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">    the solver is set up for that k-point. Otherwise, it uses the interpolated k-points.</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">        k_point (mp.Vector3, optional): The k-point for the simulation. Default is None.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">if</span> <span class="n">k_point</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>                              <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>                              <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">k_point</span><span class="p">],</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>                              <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>                              <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>                                <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>                                <span class="n">k_points</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">,</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>                                <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>                                <span class="n">num_bands</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.run_simulation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_simulation</span><span class="p">(</span><span class="n">runner</span><span class="o">=</span><span class="s1">&#39;run_zeven&#39;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.run_simulation" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Run the simulation to calculate the frequencies and gaps.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>runner</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the function to run the simulation. Default is 'run_zeven'. 
runner must correspond to an MPB runner. For example:</p>
<ul>
<li>'run_zeven': Run the simulation for even parity modes in z-axis.</li>
<li>'run_zodd': Run the simulation for odd parity modes in z-axis.</li>
<li>'run_tm': Run the simulation for transverse magnetic modes.</li>
<li>'run_te': Run the simulation for transverse electric modes.</li>
<li>'run': Do not consider symmetry.</li>
</ul>
              </div>
            </td>
            <td>
                  <code>&#39;run_zeven&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the simulation. Default is None. If None, it uses the runner name.
This will be stored in the mode data.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-215" name="__codelineno-0-215"></a><span class="k">def</span> <span class="nf">run_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zeven&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="sd">    Run the simulation to calculate the frequencies and gaps.</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        runner (str): The name of the function to run the simulation. Default is &#39;run_zeven&#39;. </span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">            runner must correspond to an MPB runner. For example:</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">            - &#39;run_zeven&#39;: Run the simulation for even parity modes in z-axis.</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a><span class="sd">            - &#39;run_zodd&#39;: Run the simulation for odd parity modes in z-axis.</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a><span class="sd">            - &#39;run_tm&#39;: Run the simulation for transverse magnetic modes.</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a><span class="sd">            - &#39;run_te&#39;: Run the simulation for transverse electric modes.</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a><span class="sd">            - &#39;run&#39;: Do not consider symmetry.</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a><span class="sd">        polarization (str, optional): The polarization of the simulation. Default is None. If None, it uses the runner name.</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a><span class="sd">            This will be stored in the mode data.</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before running the simulation.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="k">if</span> <span class="n">polarization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="n">polarization</span> <span class="o">=</span> <span class="n">polarization</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>        <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;run_&quot;</span><span class="p">):</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="c1"># This is a custom mpb output function that stores the fields and frequencies</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="k">def</span> <span class="nf">get_mode_data</span><span class="p">(</span><span class="n">ms</span><span class="p">:</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>            <span class="s2">&quot;h_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>            <span class="s2">&quot;e_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="s2">&quot;e_field_periodic&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>            <span class="s2">&quot;h_field_periodic&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>            <span class="s2">&quot;k_point&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">current_k</span><span class="p">,</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>            <span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="n">polarization</span><span class="p">,</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="p">}</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">)</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">runner</span><span class="p">)(</span><span class="n">get_mode_data</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">all_freqs</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">gap_list</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.run_simulation_with_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_simulation_with_output</span><span class="p">(</span><span class="n">runner</span><span class="o">=</span><span class="s1">&#39;run_zeven&#39;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.run_simulation_with_output" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Run the simulation and get mode data. Mode data are not stored in the crystal object, 
but are returned as a list of dictionaries.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>runner</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the function to run the simulation. Default is 'run_zeven'. 
runner must correspond to an MPB runner. For example: </p>
<ul>
<li>'run_zeven': Run the simulation for even parity modes in z-axis.</li>
<li>'run_zodd': Run the simulation for odd parity modes in z-axis.</li>
<li>'run_tm': Run the simulation for transverse magnetic modes.</li>
<li>'run_te': Run the simulation for transverse electric modes.</li>
<li>'run': Do not consider symmetry.   </li>
</ul>
              </div>
            </td>
            <td>
                  <code>&#39;run_zeven&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the simulation. Default is None. If None, it uses the runner name.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-262" name="__codelineno-0-262"></a><span class="k">def</span> <span class="nf">run_simulation_with_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zeven&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="sd">    Run the simulation and get mode data. Mode data are not stored in the crystal object, </span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="sd">    but are returned as a list of dictionaries.</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        runner (str): The name of the function to run the simulation. Default is &#39;run_zeven&#39;. </span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">            runner must correspond to an MPB runner. For example: </span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">            - &#39;run_zeven&#39;: Run the simulation for even parity modes in z-axis.</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a><span class="sd">            - &#39;run_zodd&#39;: Run the simulation for odd parity modes in z-axis.</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">            - &#39;run_tm&#39;: Run the simulation for transverse magnetic modes.</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">            - &#39;run_te&#39;: Run the simulation for transverse electric modes.</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">            - &#39;run&#39;: Do not consider symmetry.   </span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        polarization (str, optional): The polarization of the simulation. Default is None. If None, it uses the runner name.</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before running the simulation.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>    <span class="k">if</span> <span class="n">polarization</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>        <span class="n">polarization</span> <span class="o">=</span> <span class="n">polarization</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="k">if</span> <span class="n">runner</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;run_&quot;</span><span class="p">):</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">runner</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="n">modes</span><span class="o">=</span><span class="p">[]</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="c1"># This is a custom mpb output function that stores the fields and frequencies</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="k">def</span> <span class="nf">get_mode_data</span><span class="p">(</span><span class="n">ms</span><span class="p">,</span> <span class="n">band</span><span class="p">):</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>        <span class="n">mode</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>            <span class="s2">&quot;h_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>            <span class="s2">&quot;e_field&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>            <span class="s2">&quot;h_field_periodic&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_hfield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="s2">&quot;e_field_periodic&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">get_efield</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>            <span class="s2">&quot;freq&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">band</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>            <span class="s2">&quot;k_point&quot;</span><span class="p">:</span> <span class="n">ms</span><span class="o">.</span><span class="n">current_k</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>            <span class="s2">&quot;polarization&quot;</span><span class="p">:</span> <span class="n">polarization</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="p">}</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>        <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="p">,</span> <span class="n">runner</span><span class="p">)(</span><span class="n">get_mode_data</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">fix_efield_phase</span><span class="p">,</span> <span class="n">mpb</span><span class="o">.</span><span class="n">fix_hfield_phase</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="k">return</span> <span class="n">modes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_dumb_simulation</span><span class="p">()</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.run_dumb_simulation" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Run a dumb simulation.  It is the first band of the gamma point.
This is used to quickly extract some values from the simulation later. 
For example it can be used to extract epsilon values.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="k">def</span> <span class="nf">run_dumb_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">:</span>    
<a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a><span class="sd">    Run a dumb simulation.  It is the first band of the gamma point.</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a><span class="sd">    This is used to quickly extract some values from the simulation later. </span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a><span class="sd">    For example it can be used to extract epsilon values.</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>    <span class="c1">#run the simulation in the gamma point, find one mode</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">ModeSolver</span><span class="p">(</span><span class="n">geometry</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_list</span><span class="p">(),</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>                              <span class="n">geometry_lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>                              <span class="n">k_points</span><span class="o">=</span><span class="p">[</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">()],</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>                              <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>                              <span class="n">num_bands</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>    <span class="n">ms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>    <span class="k">return</span> <span class="n">ms</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.convert_mode_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_mode_fields</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.convert_mode_fields" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Convert the mode fields to mpb.MPBArray for visualization.
Apparently this is necessary to visualize the fields if crystal is restored from pickle.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mode</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mode dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the electric field array and the magnetic field array for visualization.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span>
<span class="normal"><a href="#__codelineno-0-342">342</a></span>
<span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-328" name="__codelineno-0-328"></a><span class="k">def</span> <span class="nf">convert_mode_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a><span class="sd">    Convert the mode fields to mpb.MPBArray for visualization.</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a><span class="sd">    Apparently this is necessary to visualize the fields if crystal is restored from pickle.</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        mode (dict): The mode dictionary.</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        tuple: A tuple containing the electric field array and the magnetic field array for visualization.</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>        <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="n">e_field</span> <span class="o">=</span>  <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">)</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>        <span class="n">h_field</span> <span class="o">=</span>  <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">)</span>            
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>        <span class="k">return</span> <span class="n">e_field</span><span class="p">,</span> <span class="n">h_field</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.extract_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_data</span><span class="p">(</span><span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.extract_data" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Extract the data from the simulation. Basically it creates a MPBData object.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>mpb.MPBData: The MPB data object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span>
<span class="normal"><a href="#__codelineno-0-358">358</a></span>
<span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="k">def</span> <span class="nf">extract_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">periods</span> <span class="o">=</span> <span class="mi">5</span><span class="p">):</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a><span class="sd">    Extract the data from the simulation. Basically it creates a MPBData object.</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-358" name="__codelineno-0-358"></a><span class="sd">        periods (int, optional): The number of periods to extract. Default is 5.</span>
<a id="__codelineno-0-359" name="__codelineno-0-359"></a>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a><span class="sd">        mpb.MPBData: The MPB data object.</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Solver is not set. Call set_solver() before extracting data.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">md</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.plot_epsilon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_epsilon</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.plot_epsilon" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the epsilon of the photonic crystal interactively using Plotly.
Not implemented in the base class. Must be implemented in the derived class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the epsilon plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title of the plot. Default is 'Epsilon'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Epsilon&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.(Not woroking yet, error is thrown)</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span>
<span class="normal"><a href="#__codelineno-0-374">374</a></span>
<span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-371" name="__codelineno-0-371"></a><span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">)</span> <span class="p">:</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a><span class="sd">    Plot the epsilon of the photonic crystal interactively using Plotly.</span>
<a id="__codelineno-0-374" name="__codelineno-0-374"></a><span class="sd">    Not implemented in the base class. Must be implemented in the derived class.</span>
<a id="__codelineno-0-375" name="__codelineno-0-375"></a>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a><span class="sd">        fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        title (str, optional): The title of the plot. Default is &#39;Epsilon&#39;.</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">        go.Figure: The Plotly figure object.(Not woroking yet, error is thrown)</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.plot_bands" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_bands</span><span class="p">(</span><span class="n">polarization</span><span class="o">=</span><span class="s1">&#39;te&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bands&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.plot_bands" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the bands of the photonic crystal using Plotly.</p>
<p>This method plots the bands for the specified polarization.
In Dash and Jupyter Notebook, the plot is interactive and data are shown on hover.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the bands. Default is 'te'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;te&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title of the plot. Default is 'Bands'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Bands&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the bands plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>color</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The color of the bands. Default is 'blue'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;blue&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span>
<span class="normal"><a href="#__codelineno-0-408">408</a></span>
<span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span>
<span class="normal"><a href="#__codelineno-0-476">476</a></span>
<span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span>
<span class="normal"><a href="#__codelineno-0-512">512</a></span>
<span class="normal"><a href="#__codelineno-0-513">513</a></span>
<span class="normal"><a href="#__codelineno-0-514">514</a></span>
<span class="normal"><a href="#__codelineno-0-515">515</a></span>
<span class="normal"><a href="#__codelineno-0-516">516</a></span>
<span class="normal"><a href="#__codelineno-0-517">517</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-385" name="__codelineno-0-385"></a><span class="k">def</span> <span class="nf">plot_bands</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;te&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Bands&#39;</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a><span class="sd">    Plot the bands of the photonic crystal using Plotly.</span>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a><span class="sd">    This method plots the bands for the specified polarization.</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">    In Dash and Jupyter Notebook, the plot is interactive and data are shown on hover.</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">        polarization (str, optional): The polarization of the bands. Default is &#39;te&#39;.</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        title (str, optional): The title of the plot. Default is &#39;Bands&#39;.</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a><span class="sd">        fig (go.Figure, optional): The Plotly figure to add the bands plot to. Default is None.</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a><span class="sd">        color (str, optional): The color of the bands. Default is &#39;blue&#39;.</span>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a><span class="sd">        go.Figure: The Plotly figure object.</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Simulation not run yet. Please run the simulation first.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>        <span class="k">return</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>    <span class="n">freqs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">freqs</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>    <span class="n">gaps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gaps</span><span class="p">[</span><span class="n">polarization</span><span class="p">]</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)))</span>
<a id="__codelineno-0-408" name="__codelineno-0-408"></a>
<a id="__codelineno-0-409" name="__codelineno-0-409"></a>    <span class="c1"># Extract the interpolated k-points as vectors and format them for hover and click</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="p">[</span><span class="n">kp</span> <span class="k">for</span> <span class="n">kp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span><span class="p">]</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="c1"># Iterate through each frequency band and add them to the plot</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a>    <span class="k">for</span> <span class="n">band_index</span><span class="p">,</span> <span class="n">band</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">freqs</span><span class="p">)):</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a>        <span class="c1"># Generate hover text with the corresponding k-point and frequency</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>        <span class="n">hover_texts</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a>            <span class="sa">f</span><span class="s2">&quot;k-point: (</span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">x</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">y</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">kp</span><span class="o">.</span><span class="n">z</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">)&lt;br&gt;frequency: </span><span class="si">{</span><span class="n">f</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a>            <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">,</span> <span class="n">band</span><span class="p">)</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>        <span class="p">]</span>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="n">modes</span> <span class="o">=</span><span class="p">[]</span>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">kp</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">):</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a>            <span class="n">mode</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">polarization</span><span class="p">,</span> <span class="n">kp</span><span class="p">,</span> <span class="n">band</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">freq_tolerance</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="n">modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>        <span class="c1"># Add the line trace with hover info</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>            <span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span> 
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="n">y</span><span class="o">=</span><span class="n">band</span><span class="p">,</span> 
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>            <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>            <span class="n">text</span><span class="o">=</span><span class="n">hover_texts</span><span class="p">,</span>  <span class="c1"># Custom hover text</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>            <span class="n">hoverinfo</span><span class="o">=</span><span class="s1">&#39;text&#39;</span><span class="p">,</span>  <span class="c1"># Display only the custom hover text</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="n">customdata</span><span class="o">=</span><span class="p">[(</span><span class="n">kp</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">kp</span><span class="o">.</span><span class="n">z</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">polarization</span><span class="p">)</span> <span class="k">for</span> <span class="n">kp</span><span class="p">,</span> <span class="n">f</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">k_points_interpolated</span><span class="p">,</span> <span class="n">band</span><span class="p">)],</span>  <span class="c1"># Attach k-points and frequency as custom data</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Hide from legend (well add a separate legend entry)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>            <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group traces by polarization for toggling visibility</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Initially visible</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="n">selectedpoints</span><span class="o">=</span><span class="p">[],</span>  <span class="c1"># Placeholder for selected points</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>            <span class="n">selected</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)),</span>  <span class="c1"># Change color and size of selected points</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>            <span class="n">unselected</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">))</span>  <span class="c1"># Make unselected points more transparent</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="p">))</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="c1"># Add bandgap shading (optional, grouped with the polarization for toggling visibility)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">for</span> <span class="n">gap</span> <span class="ow">in</span> <span class="n">gaps</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>        <span class="k">if</span> <span class="n">gap</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">add_shape</span><span class="p">(</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;rect&quot;</span><span class="p">,</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>                <span class="n">x0</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>                <span class="n">x1</span><span class="o">=</span><span class="n">xs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>                <span class="n">y0</span><span class="o">=</span><span class="n">gap</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> 
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>                <span class="n">y1</span><span class="o">=</span><span class="n">gap</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>                <span class="n">fillcolor</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> 
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> 
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>                <span class="n">line_width</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>                <span class="n">layer</span><span class="o">=</span><span class="s2">&quot;below&quot;</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>                <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group shading with the same polarization</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span>  <span class="c1"># Initially visible</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>            <span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="c1"># Add a single legend entry for toggling visibility</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>        <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="kc">None</span><span class="p">],</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>        <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">),</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">polarization</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>  <span class="c1"># Legend entry for the polarization</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>        <span class="n">legendgroup</span><span class="o">=</span><span class="n">polarization</span><span class="p">,</span>  <span class="c1"># Group with the same polarization traces</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Show the legend entry</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="c1"># Initially visible</span>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="p">))</span>
<a id="__codelineno-0-476" name="__codelineno-0-476"></a>
<a id="__codelineno-0-477" name="__codelineno-0-477"></a>    <span class="c1"># Customize the x-axis </span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Use X and Y directions for the x-axis</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a>        <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_XY_k_points_near_gamma</span><span class="p">()</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a>            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a>            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>                <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a>                <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)],</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>                <span class="n">ticktext</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>  <span class="c1"># Only three values, no repetition</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>            <span class="p">),</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;frequency (c/a)&#39;</span><span class="p">,</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>            <span class="n">dragmode</span><span class="o">=</span><span class="s1">&#39;select&#39;</span><span class="p">,</span>  <span class="c1"># Enables rectangular selection</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>            <span class="n">clickmode</span><span class="o">=</span><span class="s1">&#39;event+select&#39;</span><span class="p">,</span>  <span class="c1"># Enable click events and selection events</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>  <span class="c1"># This ensures that clicking the legend will toggle visibility</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>                <span class="n">itemclick</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span>  <span class="c1"># Toggle visibility when clicked</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>                <span class="n">itemdoubleclick</span><span class="o">=</span><span class="s2">&quot;toggleothers&quot;</span>  <span class="c1"># Double-click to hide/show other entries</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>            <span class="p">)</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>        <span class="p">)</span>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_high_symmetry_points</span><span class="p">()</span> <span class="c1"># Use high symmetry points for the x-axis </span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>                                                            <span class="c1"># Gamma, X, M for square lattice and</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>                                                            <span class="c1"># Gamma, K, M for triangular lattice                                                   </span>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>            <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="n">tickmode</span><span class="o">=</span><span class="s1">&#39;array&#39;</span><span class="p">,</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>                <span class="n">tickvals</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">)],</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>                <span class="n">ticktext</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">relevant_k_points</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Repeat the first element at the end</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>            <span class="p">),</span>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;frequency (c/a)&#39;</span><span class="p">,</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>            <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>            <span class="n">dragmode</span><span class="o">=</span><span class="s1">&#39;select&#39;</span><span class="p">,</span>  <span class="c1"># Enables rectangular selection</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>            <span class="n">clickmode</span><span class="o">=</span><span class="s1">&#39;event+select&#39;</span><span class="p">,</span>  <span class="c1"># Enable click events and selection events</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>            <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>  <span class="c1"># This ensures that clicking the legend will toggle visibility</span>
<a id="__codelineno-0-512" name="__codelineno-0-512"></a>                <span class="n">itemclick</span><span class="o">=</span><span class="s2">&quot;toggle&quot;</span><span class="p">,</span>  <span class="c1"># Toggle visibility when clicked</span>
<a id="__codelineno-0-513" name="__codelineno-0-513"></a>                <span class="n">itemdoubleclick</span><span class="o">=</span><span class="s2">&quot;toggleothers&quot;</span>  <span class="c1"># Double-click to hide/show other entries</span>
<a id="__codelineno-0-514" name="__codelineno-0-514"></a>            <span class="p">)</span>
<a id="__codelineno-0-515" name="__codelineno-0-515"></a>        <span class="p">)</span>
<a id="__codelineno-0-516" name="__codelineno-0-516"></a>
<a id="__codelineno-0-517" name="__codelineno-0-517"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_XY_k_points_near_gamma</span><span class="p">(</span><span class="n">distance</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.get_XY_k_points_near_gamma" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the relevant k-points near the gamma point for the X and Y directions.
This is useful for plotting the bands with the X and Y directions on the x-axis.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The distance from the gamma point. Default is 0.1.</p>
              </div>
            </td>
            <td>
                  <code>0.1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with the relevant k-points for the X and Y directions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>with the k-point names as keys and the k-point vectors as values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-520">520</a></span>
<span class="normal"><a href="#__codelineno-0-521">521</a></span>
<span class="normal"><a href="#__codelineno-0-522">522</a></span>
<span class="normal"><a href="#__codelineno-0-523">523</a></span>
<span class="normal"><a href="#__codelineno-0-524">524</a></span>
<span class="normal"><a href="#__codelineno-0-525">525</a></span>
<span class="normal"><a href="#__codelineno-0-526">526</a></span>
<span class="normal"><a href="#__codelineno-0-527">527</a></span>
<span class="normal"><a href="#__codelineno-0-528">528</a></span>
<span class="normal"><a href="#__codelineno-0-529">529</a></span>
<span class="normal"><a href="#__codelineno-0-530">530</a></span>
<span class="normal"><a href="#__codelineno-0-531">531</a></span>
<span class="normal"><a href="#__codelineno-0-532">532</a></span>
<span class="normal"><a href="#__codelineno-0-533">533</a></span>
<span class="normal"><a href="#__codelineno-0-534">534</a></span>
<span class="normal"><a href="#__codelineno-0-535">535</a></span>
<span class="normal"><a href="#__codelineno-0-536">536</a></span>
<span class="normal"><a href="#__codelineno-0-537">537</a></span>
<span class="normal"><a href="#__codelineno-0-538">538</a></span>
<span class="normal"><a href="#__codelineno-0-539">539</a></span>
<span class="normal"><a href="#__codelineno-0-540">540</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-520" name="__codelineno-0-520"></a><span class="k">def</span> <span class="nf">get_XY_k_points_near_gamma</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">distance</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-521" name="__codelineno-0-521"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-522" name="__codelineno-0-522"></a><span class="sd">    Get the relevant k-points near the gamma point for the X and Y directions.</span>
<a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="sd">    This is useful for plotting the bands with the X and Y directions on the x-axis.</span>
<a id="__codelineno-0-524" name="__codelineno-0-524"></a>
<a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        distance (float): The distance from the gamma point. Default is 0.1.</span>
<a id="__codelineno-0-527" name="__codelineno-0-527"></a>
<a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">        dict: A dictionary with the relevant k-points for the X and Y directions.</span>
<a id="__codelineno-0-530" name="__codelineno-0-530"></a><span class="sd">        with the k-point names as keys and the k-point vectors as values.</span>
<a id="__codelineno-0-531" name="__codelineno-0-531"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-532" name="__codelineno-0-532"></a>
<a id="__codelineno-0-533" name="__codelineno-0-533"></a>    <span class="k">if</span> <span class="n">distance</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>
<a id="__codelineno-0-534" name="__codelineno-0-534"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Distance must be less than 0.5&quot;</span><span class="p">)</span>
<a id="__codelineno-0-535" name="__codelineno-0-535"></a>    <span class="n">relevant_k_points</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-536" name="__codelineno-0-536"></a>        <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-537" name="__codelineno-0-537"></a>        <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-538" name="__codelineno-0-538"></a>        <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-539" name="__codelineno-0-539"></a>    <span class="p">}</span>
<a id="__codelineno-0-540" name="__codelineno-0-540"></a>    <span class="k">return</span> <span class="n">relevant_k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_high_symmetry_points</span><span class="p">()</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.get_high_symmetry_points" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Get the high symmetry points for the photonic crystal lattice.
This is useful for plotting the bands with the high symmetry points on the x-axis.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>dict</code></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary with the high symmetry points for the lattice.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>with the k-point names as keys and the k-point vectors as values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-542">542</a></span>
<span class="normal"><a href="#__codelineno-0-543">543</a></span>
<span class="normal"><a href="#__codelineno-0-544">544</a></span>
<span class="normal"><a href="#__codelineno-0-545">545</a></span>
<span class="normal"><a href="#__codelineno-0-546">546</a></span>
<span class="normal"><a href="#__codelineno-0-547">547</a></span>
<span class="normal"><a href="#__codelineno-0-548">548</a></span>
<span class="normal"><a href="#__codelineno-0-549">549</a></span>
<span class="normal"><a href="#__codelineno-0-550">550</a></span>
<span class="normal"><a href="#__codelineno-0-551">551</a></span>
<span class="normal"><a href="#__codelineno-0-552">552</a></span>
<span class="normal"><a href="#__codelineno-0-553">553</a></span>
<span class="normal"><a href="#__codelineno-0-554">554</a></span>
<span class="normal"><a href="#__codelineno-0-555">555</a></span>
<span class="normal"><a href="#__codelineno-0-556">556</a></span>
<span class="normal"><a href="#__codelineno-0-557">557</a></span>
<span class="normal"><a href="#__codelineno-0-558">558</a></span>
<span class="normal"><a href="#__codelineno-0-559">559</a></span>
<span class="normal"><a href="#__codelineno-0-560">560</a></span>
<span class="normal"><a href="#__codelineno-0-561">561</a></span>
<span class="normal"><a href="#__codelineno-0-562">562</a></span>
<span class="normal"><a href="#__codelineno-0-563">563</a></span>
<span class="normal"><a href="#__codelineno-0-564">564</a></span>
<span class="normal"><a href="#__codelineno-0-565">565</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-542" name="__codelineno-0-542"></a><span class="k">def</span> <span class="nf">get_high_symmetry_points</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<a id="__codelineno-0-543" name="__codelineno-0-543"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-544" name="__codelineno-0-544"></a><span class="sd">    Get the high symmetry points for the photonic crystal lattice.</span>
<a id="__codelineno-0-545" name="__codelineno-0-545"></a><span class="sd">    This is useful for plotting the bands with the high symmetry points on the x-axis.</span>
<a id="__codelineno-0-546" name="__codelineno-0-546"></a>
<a id="__codelineno-0-547" name="__codelineno-0-547"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-548" name="__codelineno-0-548"></a><span class="sd">        dict: A dictionary with the high symmetry points for the lattice.</span>
<a id="__codelineno-0-549" name="__codelineno-0-549"></a><span class="sd">        with the k-point names as keys and the k-point vectors as values.</span>
<a id="__codelineno-0-550" name="__codelineno-0-550"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-551" name="__codelineno-0-551"></a>
<a id="__codelineno-0-552" name="__codelineno-0-552"></a>    <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{}</span>
<a id="__codelineno-0-553" name="__codelineno-0-553"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
<a id="__codelineno-0-554" name="__codelineno-0-554"></a>        <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-555" name="__codelineno-0-555"></a>            <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-556" name="__codelineno-0-556"></a>            <span class="s1">&#39;X&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-557" name="__codelineno-0-557"></a>            <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-558" name="__codelineno-0-558"></a>        <span class="p">}</span>
<a id="__codelineno-0-559" name="__codelineno-0-559"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
<a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="n">k_high_sym</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-561" name="__codelineno-0-561"></a>            <span class="s1">&#39;&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="s1">&#39;K&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-563" name="__codelineno-0-563"></a>            <span class="s1">&#39;M&#39;</span><span class="p">:</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-564" name="__codelineno-0-564"></a>        <span class="p">}</span>
<a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="k">return</span> <span class="n">k_high_sym</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.plot_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.plot_field" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the field visualization.
Not implemented in the base class. Must be implemented in the derived class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_frequency</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity. Default is 0.01.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max_distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance for k-point similarity. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>component</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The component of the field to plot. Default is 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantity</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The quantity of the field to plot. Default is "real".</p>
              </div>
            </td>
            <td>
                  <code>&#39;real&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bloch_phase</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the Bloch phase. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale for the plot. Default is "RdBu".</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for the plot.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[go.Figure, go.Figure]: A tuple containing the Plotly figures for the electric and magnetic fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-568">568</a></span>
<span class="normal"><a href="#__codelineno-0-569">569</a></span>
<span class="normal"><a href="#__codelineno-0-570">570</a></span>
<span class="normal"><a href="#__codelineno-0-571">571</a></span>
<span class="normal"><a href="#__codelineno-0-572">572</a></span>
<span class="normal"><a href="#__codelineno-0-573">573</a></span>
<span class="normal"><a href="#__codelineno-0-574">574</a></span>
<span class="normal"><a href="#__codelineno-0-575">575</a></span>
<span class="normal"><a href="#__codelineno-0-576">576</a></span>
<span class="normal"><a href="#__codelineno-0-577">577</a></span>
<span class="normal"><a href="#__codelineno-0-578">578</a></span>
<span class="normal"><a href="#__codelineno-0-579">579</a></span>
<span class="normal"><a href="#__codelineno-0-580">580</a></span>
<span class="normal"><a href="#__codelineno-0-581">581</a></span>
<span class="normal"><a href="#__codelineno-0-582">582</a></span>
<span class="normal"><a href="#__codelineno-0-583">583</a></span>
<span class="normal"><a href="#__codelineno-0-584">584</a></span>
<span class="normal"><a href="#__codelineno-0-585">585</a></span>
<span class="normal"><a href="#__codelineno-0-586">586</a></span>
<span class="normal"><a href="#__codelineno-0-587">587</a></span>
<span class="normal"><a href="#__codelineno-0-588">588</a></span>
<span class="normal"><a href="#__codelineno-0-589">589</a></span>
<span class="normal"><a href="#__codelineno-0-590">590</a></span>
<span class="normal"><a href="#__codelineno-0-591">591</a></span>
<span class="normal"><a href="#__codelineno-0-592">592</a></span>
<span class="normal"><a href="#__codelineno-0-593">593</a></span>
<span class="normal"><a href="#__codelineno-0-594">594</a></span>
<span class="normal"><a href="#__codelineno-0-595">595</a></span>
<span class="normal"><a href="#__codelineno-0-596">596</a></span>
<span class="normal"><a href="#__codelineno-0-597">597</a></span>
<span class="normal"><a href="#__codelineno-0-598">598</a></span>
<span class="normal"><a href="#__codelineno-0-599">599</a></span>
<span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span>
<a id="__codelineno-0-569" name="__codelineno-0-569"></a>    <span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-570" name="__codelineno-0-570"></a>    <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-571" name="__codelineno-0-571"></a>    <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-572" name="__codelineno-0-572"></a>    <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-573" name="__codelineno-0-573"></a>    <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-574" name="__codelineno-0-574"></a>    <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-575" name="__codelineno-0-575"></a>    <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-576" name="__codelineno-0-576"></a>    <span class="n">component</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-577" name="__codelineno-0-577"></a>    <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-578" name="__codelineno-0-578"></a>    <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-579" name="__codelineno-0-579"></a>    <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;RdBu&quot;</span><span class="p">,</span>
<a id="__codelineno-0-580" name="__codelineno-0-580"></a>    <span class="o">**</span><span class="n">kwargs</span>
<a id="__codelineno-0-581" name="__codelineno-0-581"></a><span class="p">):</span> 
<a id="__codelineno-0-582" name="__codelineno-0-582"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-583" name="__codelineno-0-583"></a><span class="sd">    Plot the field visualization.</span>
<a id="__codelineno-0-584" name="__codelineno-0-584"></a><span class="sd">    Not implemented in the base class. Must be implemented in the derived class.</span>
<a id="__codelineno-0-585" name="__codelineno-0-585"></a>
<a id="__codelineno-0-586" name="__codelineno-0-586"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">        target_polarization (str): The polarization of the mode.</span>
<a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">        target_k_point (tuple): The k-point of the mode.</span>
<a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        target_frequency (float): The frequency of the mode.</span>
<a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">        frequency_tolerance (float): The tolerance for frequency similarity. Default is 0.01.</span>
<a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-592" name="__codelineno-0-592"></a><span class="sd">        periods (int): The number of periods to extract. Default is 5.</span>
<a id="__codelineno-0-593" name="__codelineno-0-593"></a><span class="sd">        component (int): The component of the field to plot. Default is 2.</span>
<a id="__codelineno-0-594" name="__codelineno-0-594"></a><span class="sd">        quantity (str): The quantity of the field to plot. Default is &quot;real&quot;.</span>
<a id="__codelineno-0-595" name="__codelineno-0-595"></a><span class="sd">        bloch_phase (bool): Whether to include the Bloch phase. Default is True.</span>
<a id="__codelineno-0-596" name="__codelineno-0-596"></a><span class="sd">        colorscale (str): The colorscale for the plot. Default is &quot;RdBu&quot;.</span>
<a id="__codelineno-0-597" name="__codelineno-0-597"></a><span class="sd">        kwargs: Additional keyword arguments for the plot.</span>
<a id="__codelineno-0-598" name="__codelineno-0-598"></a>
<a id="__codelineno-0-599" name="__codelineno-0-599"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="sd">        tuple[go.Figure, go.Figure]: A tuple containing the Plotly figures for the electric and magnetic fields.           </span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;plot_field method not implemented yet.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.plot_field_components" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field_components</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.plot_field_components" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the field visualization.
Not implemented in the base class. Must be implemented in the derived class.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_frequency</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity. Default is 0.01.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max_distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance for k-point similarity. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantity</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The quantity of the field to plot. Default is "real".</p>
              </div>
            </td>
            <td>
                  <code>&#39;real&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale for the plot. Default is "RdBu".</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[go.Figure, go.Figure]: A tuple containing the Plotly figures for the electric and magnetic fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span>
<span class="normal"><a href="#__codelineno-0-613">613</a></span>
<span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span>
<span class="normal"><a href="#__codelineno-0-618">618</a></span>
<span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span>
<span class="normal"><a href="#__codelineno-0-631">631</a></span>
<span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="k">def</span> <span class="nf">plot_field_components</span><span class="p">(</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>        <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>        <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>        <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-613" name="__codelineno-0-613"></a>        <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-614" name="__codelineno-0-614"></a>        <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>        <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>        <span class="p">):</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>
<a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">    Plot the field visualization.</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a><span class="sd">    Not implemented in the base class. Must be implemented in the derived class.</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a><span class="sd">        target_polarization (str): The polarization of the mode.</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a><span class="sd">        target_k_point (tuple): The k-point of the mode.</span>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a><span class="sd">        target_frequency (float): The frequency of the mode.</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a><span class="sd">        frequency_tolerance (float): The tolerance for frequency similarity. Default is 0.01.</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a><span class="sd">        k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a><span class="sd">        periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="sd">        quantity (str): The quantity of the field to plot. Default is &quot;real&quot;.</span>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a><span class="sd">        colorscale (str): The colorscale for the plot. Default is &quot;RdBu&quot;.</span>
<a id="__codelineno-0-631" name="__codelineno-0-631"></a>
<a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">        tuple[go.Figure, go.Figure]: A tuple containing the Plotly figures for the electric and magnetic fields.           </span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;plot_field_components method not implemented yet.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.look_for_mode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">look_for_mode</span><span class="p">(</span><span class="n">polarization</span><span class="p">,</span> <span class="n">k_point</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">freq_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.look_for_mode" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Look for modes within the specified criteria.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>freq</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>freq_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max_distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance for k-point similarity. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of mode dictionaries that match the criteria.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span>
<span class="normal"><a href="#__codelineno-0-652">652</a></span>
<span class="normal"><a href="#__codelineno-0-653">653</a></span>
<span class="normal"><a href="#__codelineno-0-654">654</a></span>
<span class="normal"><a href="#__codelineno-0-655">655</a></span>
<span class="normal"><a href="#__codelineno-0-656">656</a></span>
<span class="normal"><a href="#__codelineno-0-657">657</a></span>
<span class="normal"><a href="#__codelineno-0-658">658</a></span>
<span class="normal"><a href="#__codelineno-0-659">659</a></span>
<span class="normal"><a href="#__codelineno-0-660">660</a></span>
<span class="normal"><a href="#__codelineno-0-661">661</a></span>
<span class="normal"><a href="#__codelineno-0-662">662</a></span>
<span class="normal"><a href="#__codelineno-0-663">663</a></span>
<span class="normal"><a href="#__codelineno-0-664">664</a></span>
<span class="normal"><a href="#__codelineno-0-665">665</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="k">def</span> <span class="nf">look_for_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">polarization</span><span class="p">,</span> <span class="n">k_point</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span>  <span class="n">freq_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">    Look for modes within the specified criteria.</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">        polarization (str): The polarization of the mode.</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        k_point (tuple): The k-point of the mode.</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a><span class="sd">        freq (float): The frequency of the mode.</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a><span class="sd">        freq_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a><span class="sd">        k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>
<a id="__codelineno-0-652" name="__codelineno-0-652"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-653" name="__codelineno-0-653"></a><span class="sd">        list: A list of mode dictionaries that match the criteria.</span>
<a id="__codelineno-0-654" name="__codelineno-0-654"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-655" name="__codelineno-0-655"></a>
<a id="__codelineno-0-656" name="__codelineno-0-656"></a>    <span class="n">target_modes</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="k">if</span> <span class="n">k_point_max_distance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-658" name="__codelineno-0-658"></a>        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
<a id="__codelineno-0-659" name="__codelineno-0-659"></a>            <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polarization</span> <span class="ow">and</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">k_point</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">freq_tolerance</span><span class="p">:</span>
<a id="__codelineno-0-660" name="__codelineno-0-660"></a>                <span class="n">target_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-0-661" name="__codelineno-0-661"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-662" name="__codelineno-0-662"></a>        <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">modes</span><span class="p">:</span>
<a id="__codelineno-0-663" name="__codelineno-0-663"></a>            <span class="k">if</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">polarization</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">k_point</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">k_point_max_distance</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">freq</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">freq_tolerance</span><span class="p">:</span>
<a id="__codelineno-0-664" name="__codelineno-0-664"></a>                <span class="n">target_modes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mode</span><span class="p">)</span>
<a id="__codelineno-0-665" name="__codelineno-0-665"></a>    <span class="k">return</span> <span class="n">target_modes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_modes_symmetries</span><span class="p">()</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.find_modes_symmetries" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Find the symmetries of the modes.
Not implemented yet. TODO</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-669">669</a></span>
<span class="normal"><a href="#__codelineno-0-670">670</a></span>
<span class="normal"><a href="#__codelineno-0-671">671</a></span>
<span class="normal"><a href="#__codelineno-0-672">672</a></span>
<span class="normal"><a href="#__codelineno-0-673">673</a></span>
<span class="normal"><a href="#__codelineno-0-674">674</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-669" name="__codelineno-0-669"></a><span class="k">def</span> <span class="nf">find_modes_symmetries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-671" name="__codelineno-0-671"></a><span class="sd">    Find the symmetries of the modes.</span>
<a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">    Not implemented yet. TODO</span>
<a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-674" name="__codelineno-0-674"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;find_modes_symmetries method not implemented yet.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_modes_vectorial_fields</span><span class="p">(</span><span class="n">modes</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s1">&#39;scaled&#39;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Electric Field&#39;</span><span class="p">,</span> <span class="s1">&#39;Magnetic Field&#39;</span><span class="p">])</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.plot_modes_vectorial_fields" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the vectorial fields of the modes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>modes</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of modes to plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sizemode</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sizemode for the cones. Default is 'scaled'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;scaled&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>names</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The names of the fields. Default is ['Electric Field', 'Magnetic Field'].</p>
              </div>
            </td>
            <td>
                  <code>[&#39;Electric Field&#39;, &#39;Magnetic Field&#39;]</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the Plotly figures for the electric and magnetic fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-678">678</a></span>
<span class="normal"><a href="#__codelineno-0-679">679</a></span>
<span class="normal"><a href="#__codelineno-0-680">680</a></span>
<span class="normal"><a href="#__codelineno-0-681">681</a></span>
<span class="normal"><a href="#__codelineno-0-682">682</a></span>
<span class="normal"><a href="#__codelineno-0-683">683</a></span>
<span class="normal"><a href="#__codelineno-0-684">684</a></span>
<span class="normal"><a href="#__codelineno-0-685">685</a></span>
<span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span>
<span class="normal"><a href="#__codelineno-0-691">691</a></span>
<span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span>
<span class="normal"><a href="#__codelineno-0-696">696</a></span>
<span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span>
<span class="normal"><a href="#__codelineno-0-703">703</a></span>
<span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span>
<span class="normal"><a href="#__codelineno-0-737">737</a></span>
<span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span>
<span class="normal"><a href="#__codelineno-0-741">741</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-678" name="__codelineno-0-678"></a><span class="k">def</span> <span class="nf">plot_modes_vectorial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modes</span><span class="p">,</span> <span class="n">sizemode</span><span class="o">=</span><span class="s2">&quot;scaled&quot;</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Electric Field&quot;</span><span class="p">,</span> <span class="s2">&quot;Magnetic Field&quot;</span><span class="p">]):</span>
<a id="__codelineno-0-679" name="__codelineno-0-679"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-680" name="__codelineno-0-680"></a><span class="sd">    Plot the vectorial fields of the modes.</span>
<a id="__codelineno-0-681" name="__codelineno-0-681"></a>
<a id="__codelineno-0-682" name="__codelineno-0-682"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-683" name="__codelineno-0-683"></a><span class="sd">        modes (list): The list of modes to plot.</span>
<a id="__codelineno-0-684" name="__codelineno-0-684"></a><span class="sd">        sizemode (str): The sizemode for the cones. Default is &#39;scaled&#39;.</span>
<a id="__codelineno-0-685" name="__codelineno-0-685"></a><span class="sd">        names (list): The names of the fields. Default is [&#39;Electric Field&#39;, &#39;Magnetic Field&#39;].</span>
<a id="__codelineno-0-686" name="__codelineno-0-686"></a>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="sd">        tuple: A tuple containing the Plotly figures for the electric and magnetic fields.</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>
<a id="__codelineno-0-691" name="__codelineno-0-691"></a>    <span class="n">colorscales</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blues&quot;</span><span class="p">,</span> <span class="s2">&quot;reds&quot;</span><span class="p">,</span> <span class="s2">&quot;greens&quot;</span><span class="p">,</span> <span class="s2">&quot;purples&quot;</span><span class="p">,</span> <span class="s2">&quot;oranges&quot;</span><span class="p">,</span> <span class="s2">&quot;ylorbr&quot;</span><span class="p">]</span>
<a id="__codelineno-0-692" name="__codelineno-0-692"></a>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>    <span class="n">h_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>    <span class="n">e_fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">mode</span> <span class="ow">in</span> <span class="n">modes</span><span class="p">]</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>
<a id="__codelineno-0-696" name="__codelineno-0-696"></a>    <span class="n">max_norm_h</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_calculate_fields_max_norms</span><span class="p">(</span><span class="n">h_fields</span><span class="p">)</span>
<a id="__codelineno-0-697" name="__codelineno-0-697"></a>    <span class="n">max_norm_e</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_calculate_fields_max_norms</span><span class="p">(</span><span class="n">e_fields</span><span class="p">)</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>    <span class="n">e_sizeref</span> <span class="o">=</span> <span class="n">max_norm_e</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>    <span class="n">h_sizeref</span> <span class="o">=</span> <span class="n">max_norm_h</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="n">e_clim</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_norm_e</span><span class="p">)</span>
<a id="__codelineno-0-703" name="__codelineno-0-703"></a>    <span class="n">h_clim</span><span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_norm_h</span><span class="p">)</span>
<a id="__codelineno-0-704" name="__codelineno-0-704"></a>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="n">e_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>    <span class="n">h_fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>    <span class="n">e_cones</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_fields_to_cones</span><span class="p">(</span><span class="n">e_fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">e_sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">e_clim</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="n">colorscales</span><span class="p">)</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>    <span class="n">h_cones</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">_fields_to_cones</span><span class="p">(</span><span class="n">h_fields</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">sizemode</span><span class="o">=</span><span class="n">sizemode</span><span class="p">,</span> <span class="n">sizeref</span><span class="o">=</span><span class="n">h_sizeref</span><span class="p">,</span> <span class="n">clim</span><span class="o">=</span><span class="n">h_clim</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="n">colorscales</span><span class="p">)</span> 
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>    <span class="k">for</span> <span class="n">e_cone</span> <span class="ow">in</span> <span class="n">e_cones</span><span class="p">:</span>  
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>        <span class="n">e_fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">e_cone</span><span class="p">)</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>    <span class="k">for</span> <span class="n">h_cone</span> <span class="ow">in</span> <span class="n">h_cones</span><span class="p">:</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>        <span class="n">h_fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">h_cone</span><span class="p">)</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>    <span class="n">e_fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>        <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>        <span class="p">),</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>    <span class="p">)</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>    <span class="n">h_fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>        <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="p">),</span>
<a id="__codelineno-0-737" name="__codelineno-0-737"></a>        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
<a id="__codelineno-0-738" name="__codelineno-0-738"></a>        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>
<a id="__codelineno-0-741" name="__codelineno-0-741"></a>    <span class="k">return</span> <span class="n">e_fig</span><span class="p">,</span> <span class="n">h_fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_mode_fields_normal_to_k</span><span class="p">(</span><span class="n">mode</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.plot_mode_fields_normal_to_k" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the fields perpendicular to the wavevector k for the mode.
To be tested, not sure if works correctly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>mode</code>
            </td>
            <td>
                  <code>dict</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The mode dictionary.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The wavevector [kx, ky, kz].</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the Plotly figures for the electric and magnetic fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-747">747</a></span>
<span class="normal"><a href="#__codelineno-0-748">748</a></span>
<span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-747" name="__codelineno-0-747"></a><span class="k">def</span> <span class="nf">plot_mode_fields_normal_to_k</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
<a id="__codelineno-0-748" name="__codelineno-0-748"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="sd">    Plot the fields perpendicular to the wavevector k for the mode.</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="sd">    To be tested, not sure if works correctly.</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">        mode (dict): The mode dictionary.</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a><span class="sd">        k (numpy.ndarray): The wavevector [kx, ky, kz].</span>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">        tuple: A tuple containing the Plotly figures for the electric and magnetic fields.</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>    <span class="n">fields</span> <span class="o">=</span> <span class="p">[</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">]]</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="n">fields_norm_to_k</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_field_norm_to_k</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields_norm_to_k</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;blues&quot;</span><span class="p">))</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields_norm_to_k</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="s2">&quot;reds&quot;</span><span class="p">))</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span> 
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_vectorial_fields</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Viridis&#39;</span><span class="p">,</span> <span class="s1">&#39;Viridis&#39;</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Field 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Field 2&#39;</span><span class="p">])</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.plot_vectorial_fields" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the vectorial fields of the modes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fields</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of fields to plot.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscales</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscales for the cones. Default is ["Viridis", "Viridis"].</p>
              </div>
            </td>
            <td>
                  <code>[&#39;Viridis&#39;, &#39;Viridis&#39;]</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>names</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The names of the fields. Default is ["Field 1", "Field 2"].</p>
              </div>
            </td>
            <td>
                  <code>[&#39;Field 1&#39;, &#39;Field 2&#39;]</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the Plotly figures for the electric and magnetic fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span>
<span class="normal"><a href="#__codelineno-0-777">777</a></span>
<span class="normal"><a href="#__codelineno-0-778">778</a></span>
<span class="normal"><a href="#__codelineno-0-779">779</a></span>
<span class="normal"><a href="#__codelineno-0-780">780</a></span>
<span class="normal"><a href="#__codelineno-0-781">781</a></span>
<span class="normal"><a href="#__codelineno-0-782">782</a></span>
<span class="normal"><a href="#__codelineno-0-783">783</a></span>
<span class="normal"><a href="#__codelineno-0-784">784</a></span>
<span class="normal"><a href="#__codelineno-0-785">785</a></span>
<span class="normal"><a href="#__codelineno-0-786">786</a></span>
<span class="normal"><a href="#__codelineno-0-787">787</a></span>
<span class="normal"><a href="#__codelineno-0-788">788</a></span>
<span class="normal"><a href="#__codelineno-0-789">789</a></span>
<span class="normal"><a href="#__codelineno-0-790">790</a></span>
<span class="normal"><a href="#__codelineno-0-791">791</a></span>
<span class="normal"><a href="#__codelineno-0-792">792</a></span>
<span class="normal"><a href="#__codelineno-0-793">793</a></span>
<span class="normal"><a href="#__codelineno-0-794">794</a></span>
<span class="normal"><a href="#__codelineno-0-795">795</a></span>
<span class="normal"><a href="#__codelineno-0-796">796</a></span>
<span class="normal"><a href="#__codelineno-0-797">797</a></span>
<span class="normal"><a href="#__codelineno-0-798">798</a></span>
<span class="normal"><a href="#__codelineno-0-799">799</a></span>
<span class="normal"><a href="#__codelineno-0-800">800</a></span>
<span class="normal"><a href="#__codelineno-0-801">801</a></span>
<span class="normal"><a href="#__codelineno-0-802">802</a></span>
<span class="normal"><a href="#__codelineno-0-803">803</a></span>
<span class="normal"><a href="#__codelineno-0-804">804</a></span>
<span class="normal"><a href="#__codelineno-0-805">805</a></span>
<span class="normal"><a href="#__codelineno-0-806">806</a></span>
<span class="normal"><a href="#__codelineno-0-807">807</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-769" name="__codelineno-0-769"></a><span class="k">def</span> <span class="nf">plot_vectorial_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">colorscales</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Viridis&quot;</span><span class="p">,</span><span class="s2">&quot;Viridis&quot;</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Field 1&quot;</span><span class="p">,</span> <span class="s2">&quot;Field 2&quot;</span><span class="p">]):</span> 
<a id="__codelineno-0-770" name="__codelineno-0-770"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a><span class="sd">    Plot the vectorial fields of the modes.</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a><span class="sd">        fields (list): The list of fields to plot.</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a><span class="sd">        colorscales (list, optional): The colorscales for the cones. Default is [&quot;Viridis&quot;, &quot;Viridis&quot;].</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a><span class="sd">        names (list, optional): The names of the fields. Default is [&quot;Field 1&quot;, &quot;Field 2&quot;].</span>
<a id="__codelineno-0-777" name="__codelineno-0-777"></a>
<a id="__codelineno-0-778" name="__codelineno-0-778"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-779" name="__codelineno-0-779"></a><span class="sd">        tuple: A tuple containing the Plotly figures for the electric and magnetic fields.</span>
<a id="__codelineno-0-780" name="__codelineno-0-780"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-781" name="__codelineno-0-781"></a>
<a id="__codelineno-0-782" name="__codelineno-0-782"></a>    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-783" name="__codelineno-0-783"></a>    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-784" name="__codelineno-0-784"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<a id="__codelineno-0-785" name="__codelineno-0-785"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_field_to_cones</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscales</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<a id="__codelineno-0-786" name="__codelineno-0-786"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-787" name="__codelineno-0-787"></a>        <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
<a id="__codelineno-0-788" name="__codelineno-0-788"></a>        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-789" name="__codelineno-0-789"></a>        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<a id="__codelineno-0-790" name="__codelineno-0-790"></a>        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="p">),</span>
<a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
<a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-795" name="__codelineno-0-795"></a>    <span class="p">)</span>
<a id="__codelineno-0-796" name="__codelineno-0-796"></a>
<a id="__codelineno-0-797" name="__codelineno-0-797"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-798" name="__codelineno-0-798"></a>        <span class="n">title</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
<a id="__codelineno-0-799" name="__codelineno-0-799"></a>        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-800" name="__codelineno-0-800"></a>        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">),</span>
<a id="__codelineno-0-801" name="__codelineno-0-801"></a>        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">),</span>
<a id="__codelineno-0-802" name="__codelineno-0-802"></a>        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">)</span>
<a id="__codelineno-0-803" name="__codelineno-0-803"></a>        <span class="p">),</span>
<a id="__codelineno-0-804" name="__codelineno-0-804"></a>        <span class="n">margin</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">40</span><span class="p">),</span>
<a id="__codelineno-0-805" name="__codelineno-0-805"></a>        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-806" name="__codelineno-0-806"></a>    <span class="p">)</span>
<a id="__codelineno-0-807" name="__codelineno-0-807"></a>    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.sweep_geometry_parameter" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">sweep_geometry_parameter</span><span class="p">(</span><span class="n">param_to_sweep</span><span class="p">,</span> <span class="n">sweep_values</span><span class="p">,</span> <span class="n">num_bands</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.sweep_geometry_parameter" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Sweep a parameter of the geometry and run simulations for each value.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>param_to_sweep</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The parameter to sweep.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sweep_values</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The values to sweep.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_bands</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of bands to calculate. Defaults to 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>list</code></td>            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of dictionaries with the simulation data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span>
<span class="normal"><a href="#__codelineno-0-978">978</a></span>
<span class="normal"><a href="#__codelineno-0-979">979</a></span>
<span class="normal"><a href="#__codelineno-0-980">980</a></span>
<span class="normal"><a href="#__codelineno-0-981">981</a></span>
<span class="normal"><a href="#__codelineno-0-982">982</a></span>
<span class="normal"><a href="#__codelineno-0-983">983</a></span>
<span class="normal"><a href="#__codelineno-0-984">984</a></span>
<span class="normal"><a href="#__codelineno-0-985">985</a></span>
<span class="normal"><a href="#__codelineno-0-986">986</a></span>
<span class="normal"><a href="#__codelineno-0-987">987</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-953" name="__codelineno-0-953"></a><span class="k">def</span> <span class="nf">sweep_geometry_parameter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param_to_sweep</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sweep_values</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
<a id="__codelineno-0-954" name="__codelineno-0-954"></a>
<a id="__codelineno-0-955" name="__codelineno-0-955"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-956" name="__codelineno-0-956"></a><span class="sd">    Sweep a parameter of the geometry and run simulations for each value.</span>
<a id="__codelineno-0-957" name="__codelineno-0-957"></a>
<a id="__codelineno-0-958" name="__codelineno-0-958"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-959" name="__codelineno-0-959"></a><span class="sd">        param_to_sweep (str): The parameter to sweep.</span>
<a id="__codelineno-0-960" name="__codelineno-0-960"></a><span class="sd">        sweep_values (list): The values to sweep.</span>
<a id="__codelineno-0-961" name="__codelineno-0-961"></a><span class="sd">        num_bands (int, optional): The number of bands to calculate. Defaults to 4.</span>
<a id="__codelineno-0-962" name="__codelineno-0-962"></a>
<a id="__codelineno-0-963" name="__codelineno-0-963"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-964" name="__codelineno-0-964"></a><span class="sd">        list: A list of dictionaries with the simulation data.</span>
<a id="__codelineno-0-965" name="__codelineno-0-965"></a>
<a id="__codelineno-0-966" name="__codelineno-0-966"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-967" name="__codelineno-0-967"></a>    <span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-968" name="__codelineno-0-968"></a>    <span class="n">old_geom</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span>
<a id="__codelineno-0-969" name="__codelineno-0-969"></a>    <span class="n">old_num_bands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span>
<a id="__codelineno-0-970" name="__codelineno-0-970"></a>
<a id="__codelineno-0-971" name="__codelineno-0-971"></a>    <span class="n">partial_geom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">to_partial</span><span class="p">(</span><span class="n">exclude_key</span><span class="o">=</span><span class="n">param_to_sweep</span><span class="p">)</span>
<a id="__codelineno-0-972" name="__codelineno-0-972"></a>    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sweep_values</span><span class="p">:</span>
<a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="n">param_to_sweep</span><span class="p">:</span> <span class="n">value</span><span class="p">}</span>
<a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">partial_geom</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span> <span class="o">=</span> <span class="n">num_bands</span>
<a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">set_solver</span><span class="p">(</span><span class="n">k_point</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">())</span>
<a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="n">modes_zeven</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_simulation_with_output</span><span class="p">(</span><span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zeven&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;zeven&quot;</span><span class="p">)</span>
<a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="n">modes_zodd</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_simulation_with_output</span><span class="p">(</span><span class="n">runner</span><span class="o">=</span><span class="s2">&quot;run_zodd&quot;</span><span class="p">,</span> <span class="n">polarization</span><span class="o">=</span><span class="s2">&quot;zodd&quot;</span><span class="p">)</span>
<a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
<a id="__codelineno-0-980" name="__codelineno-0-980"></a>            <span class="s1">&#39;parameter_value&#39;</span><span class="p">:</span> <span class="n">value</span><span class="p">,</span>
<a id="__codelineno-0-981" name="__codelineno-0-981"></a>            <span class="s1">&#39;modes_zeven&#39;</span><span class="p">:</span> <span class="n">modes_zeven</span><span class="p">,</span>
<a id="__codelineno-0-982" name="__codelineno-0-982"></a>            <span class="s1">&#39;modes_zodd&#39;</span><span class="p">:</span> <span class="n">modes_zodd</span><span class="p">,</span>
<a id="__codelineno-0-983" name="__codelineno-0-983"></a>            <span class="s1">&#39;parameter_name&#39;</span><span class="p">:</span> <span class="n">param_to_sweep</span><span class="p">,</span>
<a id="__codelineno-0-984" name="__codelineno-0-984"></a>        <span class="p">})</span>
<a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">old_geom</span>
<a id="__codelineno-0-986" name="__codelineno-0-986"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">num_bands</span> <span class="o">=</span> <span class="n">old_num_bands</span>
<a id="__codelineno-0-987" name="__codelineno-0-987"></a>    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.plot_sweep_result" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_sweep_result</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.plot_sweep_result" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the sweep result using Plotly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The data from the sweep.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the plot to.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="k">def</span> <span class="nf">plot_sweep_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<a id="__codelineno-0-992" name="__codelineno-0-992"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">    Plot the sweep result using Plotly.</span>
<a id="__codelineno-0-994" name="__codelineno-0-994"></a>
<a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">        data (list): The data from the sweep.</span>
<a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">        fig (go.Figure): The Plotly figure to add the plot to.</span>
<a id="__codelineno-0-998" name="__codelineno-0-998"></a>
<a id="__codelineno-0-999" name="__codelineno-0-999"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1000" name="__codelineno-0-1000"></a><span class="sd">        go.Figure: The Plotly figure object.</span>
<a id="__codelineno-0-1001" name="__codelineno-0-1001"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>
<a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>
<a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>    <span class="c1"># For each data parameter value in the x axis, add all the modes frequencies (mode[&quot;freq&quot;])in the y axis</span>
<a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>    <span class="n">num_bands</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;modes_zeven&#39;</span><span class="p">])</span>
<a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_bands</span><span class="p">):</span>
<a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="n">modes_zeven</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;modes_zeven&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>        <span class="n">modes_zodd</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;modes_zodd&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>
<a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>        <span class="n">param_values</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span><span class="p">[</span><span class="s1">&#39;parameter_value&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">]</span>   
<a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">param_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modes_zeven</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> TE&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)))</span>
<a id="__codelineno-0-1013" name="__codelineno-0-1013"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">param_values</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">m</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">modes_zodd</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines+markers&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Band </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1"> TM&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">symbol</span><span class="o">=</span><span class="n">i</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">10</span><span class="p">)))</span>
<a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1015" name="__codelineno-0-1015"></a>        <span class="n">autosize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1016" name="__codelineno-0-1016"></a>        <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
<a id="__codelineno-0-1017" name="__codelineno-0-1017"></a>        <span class="n">height</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span>
<a id="__codelineno-0-1018" name="__codelineno-0-1018"></a>    <span class="p">)</span>   
<a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>
<a id="__codelineno-0-1020" name="__codelineno-0-1020"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1021" name="__codelineno-0-1021"></a>        <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Parameter Value&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1022" name="__codelineno-0-1022"></a>        <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Frequency (c/a)&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1023" name="__codelineno-0-1023"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Sweep of </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;parameter_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1024" name="__codelineno-0-1024"></a>        <span class="n">showlegend</span><span class="o">=</span><span class="kc">True</span>
<a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>    <span class="p">)</span>
<a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>
<a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.basic_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_geometry</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.photonic_crystal.PhotonicCrystal.basic_geometry" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the basic geometry of the photonic crystal.
Must be implemented in the derived class.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1031" name="__codelineno-0-1031"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-1032" name="__codelineno-0-1032"></a><span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot; </span>
<a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="sd">    Define the basic geometry of the photonic crystal.</span>
<a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="sd">    Must be implemented in the derived class.</span>
<a id="__codelineno-0-1036" name="__codelineno-0-1036"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1037" name="__codelineno-0-1037"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.basic_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_lattice</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.PhotonicCrystal.basic_lattice" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the basic lattice of the photonic crystal.
Must be implemented in the derived class.</p>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">    Define the basic lattice of the photonic crystal.</span>
<a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">    Must be implemented in the derived class.</span>
<a id="__codelineno-0-1044" name="__codelineno-0-1044"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>
<a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.PhotonicCrystal.basic_material" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_material</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.photonic_crystal.PhotonicCrystal.basic_material" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the basic material of the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>material</code></td>            <td>
                  <code><span title="crystal_materials.Crystal_Materials">Crystal_Materials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Silicon Membrane.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="k">def</span> <span class="nf">basic_material</span><span class="p">():</span>
<a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1051" name="__codelineno-0-1051"></a><span class="sd">    Define the basic material of the photonic crystal.</span>
<a id="__codelineno-0-1052" name="__codelineno-0-1052"></a>
<a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">        material (Crystal_Materials): Silicon Membrane. </span>
<a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
<a id="__codelineno-0-1057" name="__codelineno-0-1057"></a>    <span class="n">material</span> <span class="o">=</span> <span class="n">Crystal_Materials</span><span class="p">()</span>
<a id="__codelineno-0-1058" name="__codelineno-0-1058"></a>    <span class="n">material</span><span class="o">.</span><span class="n">atom</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-1059" name="__codelineno-0-1059"></a>    <span class="n">material</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-1060" name="__codelineno-0-1060"></a>    <span class="n">material</span><span class="o">.</span><span class="n">substrate</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<a id="__codelineno-0-1061" name="__codelineno-0-1061"></a>    <span class="n">material</span><span class="o">.</span><span class="n">bulk</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;epsilon&quot;</span><span class="p">:</span> <span class="mf">11.8</span><span class="p">}</span>
<a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>    <span class="k">return</span> <span class="n">material</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.photonic_crystal.Crystal2D" class="doc doc-heading">
            <code>Crystal2D</code>


<a href="#src.photonic_crystal.Crystal2D" class="headerlink" title="Anchor link to this section">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal" href="#src.photonic_crystal.PhotonicCrystal">PhotonicCrystal</a></code></p>


        <p>This class provides methods to define and simulate 2D photonic crystals with various lattice types and geometries. 
It allows for the calculation and visualization of dielectric distributions and electromagnetic fields within the crystal.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.geometry_lattice">geometry_lattice</span></code></td>
            <td>
                  <code><span title="meep.Lattice">Lattice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lattice structure of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.k_points">k_points</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.geometry">geometry</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.k_points_interpolated">k_points_interpolated</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolated k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.Crystal2D.epsilon">epsilon</span></code></td>
            <td>
                  <code>ndarray</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dielectric distribution of the photonic crystal.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.__init__" href="#src.photonic_crystal.Crystal2D.__init__">__init__</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Initializes the Crystal2D object with the specified parameters.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.plot_epsilon" href="#src.photonic_crystal.Crystal2D.plot_epsilon">plot_epsilon</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the dielectric distribution interactively using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.plot_field" href="#src.photonic_crystal.Crystal2D.plot_field">plot_field</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the electromagnetic field distribution interactively using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.plot_field_components" href="#src.photonic_crystal.Crystal2D.plot_field_components">plot_field_components</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.Crystal2D.basic_geometry">basic_geometry</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines a basic geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.Crystal2D.ellipsoid_geometry">ellipsoid_geometry</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines an ellipsoid geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><span title="src.photonic_crystal.Crystal2D.advanced_material_geometry">advanced_material_geometry</span></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines an advanced material geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.basic_lattice" href="#src.photonic_crystal.Crystal2D.basic_lattice">basic_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the basic lattice structure for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.square_lattice" href="#src.photonic_crystal.Crystal2D.square_lattice">square_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines a square lattice for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.Crystal2D.triangular_lattice" href="#src.photonic_crystal.Crystal2D.triangular_lattice">triangular_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines a triangular lattice for the photonic crystal.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/photonic_crystal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="k">class</span> <span class="nc">Crystal2D</span><span class="p">(</span><span class="n">PhotonicCrystal</span><span class="p">):</span>
<a id="__codelineno-0-1103" name="__codelineno-0-1103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><span class="sd">    This class provides methods to define and simulate 2D photonic crystals with various lattice types and geometries. </span>
<a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">    It allows for the calculation and visualization of dielectric distributions and electromagnetic fields within the crystal.</span>
<a id="__codelineno-0-1106" name="__codelineno-0-1106"></a>
<a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="sd">        geometry_lattice (mp.Lattice): The lattice structure of the photonic crystal.</span>
<a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="sd">        k_points (list): List of k-points for the simulation.</span>
<a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">        geometry (list): List of geometric objects defining the photonic crystal.</span>
<a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">        k_points_interpolated (list): Interpolated k-points for the simulation.</span>
<a id="__codelineno-0-1112" name="__codelineno-0-1112"></a><span class="sd">        epsilon (ndarray): Dielectric distribution of the photonic crystal.</span>
<a id="__codelineno-0-1113" name="__codelineno-0-1113"></a>
<a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">    Methods:</span>
<a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><span class="sd">        __init__(self, lattice_type=None, num_bands=6, resolution=(32, 32), interp=4, periods=3, pickle_id=None, geometry=None, use_XY=True, k_point_max=0.2):</span>
<a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">            Initializes the Crystal2D object with the specified parameters.</span>
<a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">        plot_epsilon(self, fig=None, title=&#39;Epsilon&#39;, **kwargs):</span>
<a id="__codelineno-0-1118" name="__codelineno-0-1118"></a><span class="sd">            Plots the dielectric distribution interactively using Plotly.</span>
<a id="__codelineno-0-1119" name="__codelineno-0-1119"></a><span class="sd">        plot_field(self, target_polarization, target_k_point, target_frequency, frequency_tolerance=0.01, k_point_max_distance=None, periods=5, component=2, quantity=&quot;real&quot;, colorscale=&#39;RdBu&#39;):</span>
<a id="__codelineno-0-1120" name="__codelineno-0-1120"></a><span class="sd">            Plots the electromagnetic field distribution interactively using Plotly.</span>
<a id="__codelineno-0-1121" name="__codelineno-0-1121"></a><span class="sd">        plot_field_components(self, target_polarization, target_k_point, target_frequency, frequency_tolerance=0.01, k_point_max_distance=None, periods=1, quantity=&quot;real&quot;, colorscale=&#39;RdBu&#39;):</span>
<a id="__codelineno-0-1122" name="__codelineno-0-1122"></a><span class="sd">            Plots the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>
<a id="__codelineno-0-1123" name="__codelineno-0-1123"></a><span class="sd">        basic_geometry(radius_1=0.2, eps_atom_1=1, radius_2=None, eps_atom_2=None, eps_bulk=12):</span>
<a id="__codelineno-0-1124" name="__codelineno-0-1124"></a><span class="sd">            Defines a basic geometry for the photonic crystal.</span>
<a id="__codelineno-0-1125" name="__codelineno-0-1125"></a><span class="sd">        ellipsoid_geometry(e1=0.2, e2=0.3, eps_atom=1, eps_bulk=12):</span>
<a id="__codelineno-0-1126" name="__codelineno-0-1126"></a><span class="sd">            Defines an ellipsoid geometry for the photonic crystal.</span>
<a id="__codelineno-0-1127" name="__codelineno-0-1127"></a><span class="sd">        advanced_material_geometry(radius_1=0.2, epsilon_diag=mp.Vector3(12, 12, 12), epsilon_offdiag=mp.Vector3(0, 0, 0), chi2_diag=mp.Vector3(0, 0, 0), chi3_diag=mp.Vector3(0, 0, 0), eps_atom_1=1):</span>
<a id="__codelineno-0-1128" name="__codelineno-0-1128"></a><span class="sd">            Defines an advanced material geometry for the photonic crystal.</span>
<a id="__codelineno-0-1129" name="__codelineno-0-1129"></a><span class="sd">        basic_lattice(lattice_type=&#39;square&#39;):</span>
<a id="__codelineno-0-1130" name="__codelineno-0-1130"></a><span class="sd">            Defines the basic lattice structure for the photonic crystal.</span>
<a id="__codelineno-0-1131" name="__codelineno-0-1131"></a><span class="sd">        square_lattice():</span>
<a id="__codelineno-0-1132" name="__codelineno-0-1132"></a><span class="sd">            Defines a square lattice for the photonic crystal.</span>
<a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="sd">        triangular_lattice():</span>
<a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="sd">            Defines a triangular lattice for the photonic crystal.</span>
<a id="__codelineno-0-1135" name="__codelineno-0-1135"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>
<a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>
<a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>
<a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>                <span class="n">lattice_type</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>                <span class="n">material</span><span class="p">:</span> <span class="n">Crystal_Materials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>                <span class="n">geometry</span><span class="p">:</span> <span class="n">Crystal2D_Geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>                <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>                <span class="n">resolution</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>                <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>                <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>                <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>                <span class="n">use_XY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>                <span class="n">k_point_max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">        Initializes the Crystal2D object with the specified parameters.</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">            lattice_type (str): The type of lattice. Default is &#39;square&#39; other option is &#39;triangular&#39;. It determines the k-points if use_XY is False.</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a><span class="sd">            material (Crystal_Materials): The material of the photonic crystal. Default is None.</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a><span class="sd">            geometry (Crystal2D_Geometry): The geometry of the photonic crystal. Default is None.</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="sd">            num_bands (int): The number of bands to calculate. Default is 6.</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="sd">            resolution (tuple[int, int] | int): The resolution of the simulation. Default is (32, 32).</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="sd">            interp (int): The interpolation factor for k-points. Default is 4.</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">            periods (int): The number of periods to simulate. Default is 3.</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="sd">            pickle_id (str): The ID for pickling the simulation. Default is None.</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="sd">            use_XY (bool): Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">            k_point_max (float): The maximum k-point value. Default is 0.2.</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="n">use_XY</span><span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">)</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="k">if</span> <span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># X</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">),</span>       <span class="c1"># Gamma</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_point_max</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>        <span class="c1"># Y</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>            <span class="p">]</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Crystal2D</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">(</span><span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>
<a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>
<a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>
<a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>
<a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>    <span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a><span class="sd">        Plot the dielectric distribution interactively using Plotly.</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a><span class="sd">            fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a><span class="sd">            title (str, optional): The title of the plot. Default is &#39;Epsilon&#39;.</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a><span class="sd">            **kwargs: Additional keyword arguments for Plotly.</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a><span class="sd">            go.Figure: The Plotly figure object.</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>                <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">)</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>                <span class="n">converted_eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>                <span class="n">converted_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>            <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>                <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">converted_eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Viridis&#39;</span><span class="p">))</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>                <span class="n">title</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                    <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;br&gt;Dielectric Distribution&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                    <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>                    <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>                    <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                    <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>                <span class="p">),</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>                <span class="n">coloraxis_colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">epsilon $&#39;</span><span class="p">),</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>                <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>                <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>                <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>                <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>                <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>                <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>            <span class="p">)</span>       
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>    
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>        <span class="k">return</span> <span class="n">fig</span>
<a id="__codelineno-0-1224" name="__codelineno-0-1224"></a>
<a id="__codelineno-0-1225" name="__codelineno-0-1225"></a>    <span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>    
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>                <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>                <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>                <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>                <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>                <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>                <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>                <span class="n">component</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>                <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>                <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>                <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;RdBu&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>                <span class="n">rectify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>                <span class="n">unwrap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>                <span class="n">phase_in_degrees</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>    <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><span class="sd">        Plot the electromagnetic field distribution using Plotly.</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a><span class="sd">            target_polarization (str): The polarization of the mode.</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a><span class="sd">            target_k_point (tuple): The k-point of the mode.</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a><span class="sd">            target_frequency (float): The frequency of the mode.</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a><span class="sd">            frequency_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a><span class="sd">            k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a><span class="sd">            periods (int): The number of periods to extract. Default is 5.</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a><span class="sd">            component (int): The component of the field to plot. x=0, y=1, z=2. Default is 2.</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a><span class="sd">            bloch_phase (bool): Whether to include the Bloch phase. Default is True.</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a><span class="sd">            quantity (str): The quantity to plot. Default is &#39;real&#39;.</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a><span class="sd">            colorscale (str): The colorscale for the heatmap. Default is &#39;RdBu&#39;.</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a><span class="sd">            rectify (bool): Whether to rectify the field. Default is True.</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="sd">            unwrap (bool): Whether to unwrap the phase. Default is False.</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a><span class="sd">            phase_in_degrees (bool): Whether to show the phase in degrees. Default is False.</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a><span class="sd">            tuple[go.Figure, go.Figure]: The Plotly figure objects for the electric and magnetic fields.</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>        <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="p">)</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">target_modes</span><span class="p">:</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No modes found with the specified criteria.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>            <span class="k">return</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="n">rectify</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>            <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span> 
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>        <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>        <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_eps</span> <span class="o">+</span> <span class="n">min_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>        <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>        <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>        <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>            <span class="c1"># Initialize visibility status: False for all traces</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>            <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>  <span class="c1"># Each mode adds two traces</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>            <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>            <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the contour plot visible</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>            <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>            <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>            <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>            <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>            <span class="n">freq</span>    <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>            <span class="c1"># Take the specified component of the fields in the center of the slab</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>            <span class="k">if</span> <span class="n">bloch_phase</span><span class="p">:</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">())</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">())</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>                <span class="c1">#  here the k-point is set to zero so that the phase term is basically 1.</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>   
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>            <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span> 
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>            <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span> 
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>                <span class="k">if</span> <span class="n">unwrap</span><span class="p">:</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">e_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">h_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">e_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">h_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                <span class="k">if</span> <span class="n">phase_in_degrees</span><span class="p">:</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>            <span class="c1"># Add the contour plot for permittivity (eps) at the midpoint</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>            <span class="n">contour_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>                                <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>                                    <span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>  <span class="c1"># Start and end at the midpoint to ensure a single level</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>                                    <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>                                    <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># A small size to keep it as a single contour</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>                                    <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>  <span class="c1"># No filling</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>                                <span class="p">),</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>                                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>                                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>                                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>                                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span>  <span class="mi">0</span>  <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># Only the first mode is visible</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>            <span class="n">contour_h</span> <span class="o">=</span> <span class="n">contour_e</span>  <span class="c1"># Same contour for H-field figure</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>            <span class="c1"># Add the contour trace</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_e</span><span class="p">)</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_h</span><span class="p">)</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>            <span class="c1"># Add the heatmap for the electric field</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>            <span class="n">heatmap_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">e_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>                                    <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>            <span class="c1"># Add the heatmap for the magnetic field</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>            <span class="n">heatmap_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">h_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>                                    <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>            <span class="c1"># Add the heatmap trace</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_e</span><span class="p">)</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_h</span><span class="p">)</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>            <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>            <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;x-component&quot;</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;y-component&quot;</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;z-component&quot;</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>            <span class="n">subtitle_e</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>            <span class="n">subtitle_h</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;H-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>            <span class="c1"># Create a button for each field dataset for the dropdown</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>            <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>                                        <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>                                        <span class="p">]))</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>            <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                                        <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>                                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>                                        <span class="p">]))</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>        <span class="n">k_point</span> <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>        <span class="n">freq</span>    <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>        <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2"> &lt;br&gt; k:[</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq:</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization:</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">, bloch_phase:</span><span class="si">{</span><span class="n">bloch_phase</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">,</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                            <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                            <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>        <span class="p">)</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>                            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">,</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>                            <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>                            <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>        <span class="p">)</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>            <span class="k">if</span> <span class="n">phase_in_degrees</span><span class="p">:</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>                <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Phase (degrees)&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>                <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Phase (degrees)&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>                <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Phase&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>                <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Phase&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
<a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>
<a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>
<a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>    <span class="k">def</span> <span class="nf">plot_field_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                                <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>                                <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                                <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>                                <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                                <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>                                <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                                <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                                <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>                                <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                                <span class="n">rectify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>                                <span class="n">unwrap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>                                <span class="n">phase_in_degrees</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>                                <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><span class="w">            </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><span class="sd">            Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a><span class="sd">            For each component, the real, imaginary, absolute value, or phase can be plotted.</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a><span class="sd">            Args:</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a><span class="sd">                target_polarization (str): The polarization of the target mode.</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a><span class="sd">                target_k_point (tuple): The k-point of the target mode.</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a><span class="sd">                target_frequency (float): The frequency of the target mode.</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><span class="sd">                frequency_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a><span class="sd">                k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a><span class="sd">                periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">                quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, &#39;phase&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="sd">                bloch_phase (bool): Whether to include the Bloch phase. Default is True.</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">                colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a><span class="sd">                rectify (bool): Whether to rectify the field. Default is True.</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="sd">                unwrap (bool): Whether to unwrap the phase. Default is False.</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="sd">                phase_in_degrees (bool): Whether to show the phase in degrees. Default is False.</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="sd">            Returns:</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">                tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">            &quot;&quot;&quot;</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>            <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>                                            <span class="n">freq_tolerance</span><span class="o">=</span><span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="n">k_point_max_distance</span><span class="p">)</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of target modes found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>            <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>                <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="n">rectify</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>                <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>            <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>            <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>            <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>            <span class="n">fig_e</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>            <span class="n">fig_h</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Hx&quot;</span><span class="p">,</span> <span class="s2">&quot;Hy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hz&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>            <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>            <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>            <span class="c1"># Initialize lists to collect all field components across modes</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>            <span class="n">all_e_fields</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>            <span class="n">all_h_fields</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>            <span class="c1"># For each mode, collect field components</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>                <span class="c1"># Get field arrays for this mode</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>                <span class="k">if</span> <span class="n">bloch_phase</span><span class="p">:</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>                    <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>                    <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>                    <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>                    <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>                    <span class="c1"># Here the k-point is set to zero so that the phase term is basically 1.</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>                <span class="c1"># Extract field components</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>                <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>                <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>                <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>                <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>                <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>                <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>                <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>                    <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_x</span><span class="p">)</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>                    <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_y</span><span class="p">)</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>                    <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_z</span><span class="p">)</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>                    <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_x</span><span class="p">)</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>                    <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_y</span><span class="p">)</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>                    <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_z</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">e_field_x</span><span class="p">,</span> <span class="n">e_field_y</span><span class="p">,</span> <span class="n">e_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">h_field_x</span><span class="p">,</span> <span class="n">h_field_y</span><span class="p">,</span> <span class="n">h_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>                <span class="c1"># Select quantity to display</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>                <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>                <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>                <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>                <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>                    <span class="k">if</span> <span class="n">unwrap</span><span class="p">:</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>                        <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">e_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>                        <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">h_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>                        <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">e_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>                        <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">h_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>                    <span class="k">if</span> <span class="n">phase_in_degrees</span><span class="p">:</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                        <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>                        <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, &#39;abs&#39;, or &#39;phase&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>                <span class="c1"># Collect all field components</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>                <span class="n">all_e_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                <span class="n">all_h_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>            <span class="c1"># After collecting all fields, compute global min and max values</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>            <span class="n">all_e_fields_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_e_fields</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>            <span class="n">all_h_fields_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_h_fields</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>            <span class="n">global_e_min</span><span class="p">,</span> <span class="n">global_e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">all_e_fields_array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_e_fields_array</span><span class="p">)</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>            <span class="n">global_h_min</span><span class="p">,</span> <span class="n">global_h_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">all_h_fields_array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_h_fields_array</span><span class="p">)</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="c1"># Now, add the traces to the figures</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">all_e_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">all_h_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>                <span class="c1"># Components of the E and H fields</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                <span class="n">Hx</span><span class="p">,</span> <span class="n">Hy</span><span class="p">,</span> <span class="n">Hz</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>                <span class="c1"># Visibility settings</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>                <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>                <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                    <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>                    <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                <span class="c1"># Add contour traces for permittivity</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>                <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                    <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                        <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>                            <span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>                            <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>                            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>                            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>                            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>                            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                        <span class="p">),</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>                        <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                    <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                        <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                            <span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>                            <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>                            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                            <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                        <span class="p">),</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                        <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>                <span class="c1"># Add E-field components with shared coloraxis</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>                <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                    <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                        <span class="n">z</span><span class="o">=</span><span class="n">Ex</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                        <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                        <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                        <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis1&quot;</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>                <span class="p">)</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>                <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                    <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                        <span class="n">z</span><span class="o">=</span><span class="n">Ey</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>                        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>                        <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>                        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>                        <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                        <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis1&quot;</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                <span class="p">)</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>                <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>                    <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                        <span class="n">z</span><span class="o">=</span><span class="n">Ez</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                        <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>                        <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                        <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis1&quot;</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>                    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>                <span class="p">)</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>                <span class="c1"># Add H-field components with shared coloraxis</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>                <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>                    <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>                        <span class="n">z</span><span class="o">=</span><span class="n">Hx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>                        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                        <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                        <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                        <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis2&quot;</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>                    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>                <span class="p">)</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>                <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>                    <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>                        <span class="n">z</span><span class="o">=</span><span class="n">Hy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>                        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>                        <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>                        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>                        <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                        <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis2&quot;</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                <span class="p">)</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>                <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>                    <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>                        <span class="n">z</span><span class="o">=</span><span class="n">Hz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>                        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>                        <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>                        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>                        <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>                        <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis2&quot;</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>                    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>                <span class="p">)</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>                <span class="c1"># Dropdown data</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>                <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>                <span class="n">freq</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>                <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>                <span class="n">mode_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>                <span class="n">mode_description</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>                    <span class="sa">f</span><span class="s2">&quot;k:[</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq:</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>                    <span class="sa">f</span><span class="s2">&quot;polarization:</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">, bloch_phase:</span><span class="si">{</span><span class="n">bloch_phase</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>                <span class="p">)</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>                <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>                    <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>                            <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components &lt;br&gt;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>                        <span class="p">]</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>                <span class="p">)</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>                <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>                    <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>                        <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>                        <span class="n">args</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>                            <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components &lt;br&gt;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>                        <span class="p">]</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>                    <span class="p">)</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>                <span class="p">)</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>            <span class="c1"># Define colorbar title based on quantity</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>            <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;Phase (degrees)&#39;</span> <span class="k">if</span> <span class="n">phase_in_degrees</span> <span class="k">else</span> <span class="s1">&#39;Phase&#39;</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;Amplitude&#39;</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;Real&#39;</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>                <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;Imaginary&#39;</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>            <span class="c1"># Layout and color settings for fig_e</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components &lt;br&gt;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>                <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">)],</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>                <span class="n">coloraxis1</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>                    <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>                    <span class="n">cmin</span><span class="o">=</span><span class="n">global_e_min</span><span class="p">,</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>                    <span class="n">cmax</span><span class="o">=</span><span class="n">global_e_max</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>                <span class="p">),</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>                <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>                <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>                <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>                <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>                <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>                <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>                <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>            <span class="p">)</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>            <span class="c1"># Layout and color settings for fig_h</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>                <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components &lt;br&gt;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>                <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">)],</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>                <span class="n">coloraxis2</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>                    <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>                    <span class="n">cmin</span><span class="o">=</span><span class="n">global_h_min</span><span class="p">,</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>                    <span class="n">cmax</span><span class="o">=</span><span class="n">global_h_max</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>                <span class="p">),</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>                <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>                <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>                <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>                <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>                <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>                <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>                <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>            <span class="p">)</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>            <span class="c1"># Final adjustments for axes</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>            <span class="c1"># Ensuring aspect ratio is equal</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>            <span class="c1"># Adding axis titles</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>            <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span><span class="p">]:</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>                <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>            <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
<a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>
<a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>
<a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>
<a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>
<a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>
<a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>
<a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>
<a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>
<a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>
<a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>
<a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>    <span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a><span class="sd">        Define the basic lattice of the photonic crystal.</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a><span class="sd">            lattice_type (str): The type of lattice. Default is &#39;square&#39;. Other option is &#39;triangular&#39;.</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a><span class="sd">            tuple: A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>        <span class="k">if</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">square_lattice</span><span class="p">()</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>        <span class="k">elif</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangular_lattice</span><span class="p">()</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid lattice type. Choose &#39;square&#39; or &#39;triangular&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1822" name="__codelineno-0-1822"></a>
<a id="__codelineno-0-1823" name="__codelineno-0-1823"></a>
<a id="__codelineno-0-1824" name="__codelineno-0-1824"></a>
<a id="__codelineno-0-1825" name="__codelineno-0-1825"></a>
<a id="__codelineno-0-1826" name="__codelineno-0-1826"></a>    <span class="k">def</span> <span class="nf">square_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a><span class="sd">        Define the square lattice for the photonic crystal.</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a><span class="sd">            tuple: A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>        <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>                          <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>                          <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>        <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># M</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>       <span class="c1"># X</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>        <span class="p">]</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>        <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
<a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>
<a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>
<a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>
<a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>    <span class="k">def</span> <span class="nf">triangular_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flat_top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a><span class="sd">        Define the triangular lattice for the photonic crystal.</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a><span class="sd">            tuple: A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>        <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>                            <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>                            <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>        <span class="c1"># lattice = mp.Lattice(size=mp.Vector3(1, 1),</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>        <span class="c1">#                         basis1=mp.Vector3(math.sqrt(3)/2, 0.5),</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>        <span class="c1">#                         basis2=mp.Vector3(math.sqrt(3)/2, -0.5))    </span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>        <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># K</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>    <span class="c1"># M</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>        <span class="p">]</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>        <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
<a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>
<a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>
<a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>    <span class="nd">@staticmethod</span>
<a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>    <span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">material</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>        <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>            <span class="n">material</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">basic_material</span><span class="p">()</span>
<a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">Crystal2D_Geometry</span><span class="p">(</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span><span class="p">,</span> <span class="n">geometry_type</span><span class="o">=</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">r</span><span class="p">)</span>
<a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>        <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="src.photonic_crystal.Crystal2D-functions">Functions<a href="#src.photonic_crystal.Crystal2D-functions" class="headerlink" title="Anchor link to this section">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.Crystal2D.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_bands</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">interp</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pickle_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">k_point_max</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.Crystal2D.__init__" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Initializes the Crystal2D object with the specified parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice. Default is 'square' other option is 'triangular'. It determines the k-points if use_XY is False.</p>
              </div>
            </td>
            <td>
                  <code>&#39;square&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>material</code>
            </td>
            <td>
                  <code><span title="crystal_materials.Crystal_Materials">Crystal_Materials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The material of the photonic crystal. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code><span title="crystal_geometries.Crystal2D_Geometry">Crystal2D_Geometry</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geometry of the photonic crystal. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_bands</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of bands to calculate. Default is 6.</p>
              </div>
            </td>
            <td>
                  <code>6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution</code>
            </td>
            <td>
                  <code>tuple[int, int] | int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution of the simulation. Default is (32, 32).</p>
              </div>
            </td>
            <td>
                  <code>32</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interp</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interpolation factor for k-points. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to simulate. Default is 3.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID for pickling the simulation. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_XY</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum k-point value. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1140" name="__codelineno-0-1140"></a>            <span class="n">lattice_type</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>            <span class="n">material</span><span class="p">:</span> <span class="n">Crystal_Materials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1142" name="__codelineno-0-1142"></a>            <span class="n">geometry</span><span class="p">:</span> <span class="n">Crystal2D_Geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>            <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-1144" name="__codelineno-0-1144"></a>            <span class="n">resolution</span> <span class="o">=</span> <span class="mi">32</span><span class="p">,</span>
<a id="__codelineno-0-1145" name="__codelineno-0-1145"></a>            <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-1146" name="__codelineno-0-1146"></a>            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> 
<a id="__codelineno-0-1147" name="__codelineno-0-1147"></a>            <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1148" name="__codelineno-0-1148"></a>            <span class="n">use_XY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1149" name="__codelineno-0-1149"></a>            <span class="n">k_point_max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
<a id="__codelineno-0-1150" name="__codelineno-0-1150"></a>
<a id="__codelineno-0-1151" name="__codelineno-0-1151"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">    Initializes the Crystal2D object with the specified parameters.</span>
<a id="__codelineno-0-1153" name="__codelineno-0-1153"></a>
<a id="__codelineno-0-1154" name="__codelineno-0-1154"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">        lattice_type (str): The type of lattice. Default is &#39;square&#39; other option is &#39;triangular&#39;. It determines the k-points if use_XY is False.</span>
<a id="__codelineno-0-1156" name="__codelineno-0-1156"></a><span class="sd">        material (Crystal_Materials): The material of the photonic crystal. Default is None.</span>
<a id="__codelineno-0-1157" name="__codelineno-0-1157"></a><span class="sd">        geometry (Crystal2D_Geometry): The geometry of the photonic crystal. Default is None.</span>
<a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="sd">        num_bands (int): The number of bands to calculate. Default is 6.</span>
<a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="sd">        resolution (tuple[int, int] | int): The resolution of the simulation. Default is (32, 32).</span>
<a id="__codelineno-0-1160" name="__codelineno-0-1160"></a><span class="sd">        interp (int): The interpolation factor for k-points. Default is 4.</span>
<a id="__codelineno-0-1161" name="__codelineno-0-1161"></a><span class="sd">        periods (int): The number of periods to simulate. Default is 3.</span>
<a id="__codelineno-0-1162" name="__codelineno-0-1162"></a><span class="sd">        pickle_id (str): The ID for pickling the simulation. Default is None.</span>
<a id="__codelineno-0-1163" name="__codelineno-0-1163"></a><span class="sd">        use_XY (bool): Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</span>
<a id="__codelineno-0-1164" name="__codelineno-0-1164"></a><span class="sd">        k_point_max (float): The maximum k-point value. Default is 0.2.</span>
<a id="__codelineno-0-1165" name="__codelineno-0-1165"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>
<a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span> <span class="n">geometry</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="n">use_XY</span><span class="p">)</span>
<a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>
<a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">)</span>
<a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>    <span class="k">if</span> <span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
<a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># X</span>
<a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">),</span>       <span class="c1"># Gamma</span>
<a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_point_max</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>        <span class="c1"># Y</span>
<a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>        <span class="p">]</span>
<a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>
<a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">Crystal2D</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">(</span><span class="n">material</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">material</span><span class="p">)</span>
<a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.Crystal2D.plot_epsilon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_epsilon</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.Crystal2D.plot_epsilon" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the dielectric distribution interactively using Plotly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the epsilon plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>title</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The title of the plot. Default is 'Epsilon'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;Epsilon&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>**kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Additional keyword arguments for Plotly.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1182" name="__codelineno-0-1182"></a><span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Epsilon&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<a id="__codelineno-0-1183" name="__codelineno-0-1183"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1184" name="__codelineno-0-1184"></a><span class="sd">    Plot the dielectric distribution interactively using Plotly.</span>
<a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>
<a id="__codelineno-0-1186" name="__codelineno-0-1186"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1187" name="__codelineno-0-1187"></a><span class="sd">        fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<a id="__codelineno-0-1188" name="__codelineno-0-1188"></a><span class="sd">        title (str, optional): The title of the plot. Default is &#39;Epsilon&#39;.</span>
<a id="__codelineno-0-1189" name="__codelineno-0-1189"></a><span class="sd">        **kwargs: Additional keyword arguments for Plotly.</span>
<a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>
<a id="__codelineno-0-1191" name="__codelineno-0-1191"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1192" name="__codelineno-0-1192"></a><span class="sd">        go.Figure: The Plotly figure object.</span>
<a id="__codelineno-0-1193" name="__codelineno-0-1193"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>
<a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">resolution</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">)</span>
<a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span class="n">converted_eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
<a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>            <span class="n">converted_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
<a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>
<a id="__codelineno-0-1204" name="__codelineno-0-1204"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">converted_eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;Viridis&#39;</span><span class="p">))</span>
<a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1206" name="__codelineno-0-1206"></a>            <span class="n">title</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1207" name="__codelineno-0-1207"></a>                <span class="n">text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">&lt;br&gt;Dielectric Distribution&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1208" name="__codelineno-0-1208"></a>                <span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<a id="__codelineno-0-1209" name="__codelineno-0-1209"></a>                <span class="n">y</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
<a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>                <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1211" name="__codelineno-0-1211"></a>                <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span>
<a id="__codelineno-0-1212" name="__codelineno-0-1212"></a>            <span class="p">),</span>
<a id="__codelineno-0-1213" name="__codelineno-0-1213"></a>            <span class="n">coloraxis_colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;$</span><span class="se">\\</span><span class="s1">epsilon $&#39;</span><span class="p">),</span>
<a id="__codelineno-0-1214" name="__codelineno-0-1214"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-0-1215" name="__codelineno-0-1215"></a>            <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>            <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
<a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>            <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span>
<a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>        <span class="p">)</span>       
<a id="__codelineno-0-1221" name="__codelineno-0-1221"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span>
<a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>    <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">)</span>    
<a id="__codelineno-0-1223" name="__codelineno-0-1223"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.Crystal2D.plot_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unwrap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">phase_in_degrees</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.Crystal2D.plot_field" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the electromagnetic field distribution using Plotly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_frequency</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max_distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance for k-point similarity. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 5.</p>
              </div>
            </td>
            <td>
                  <code>5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>component</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The component of the field to plot. x=0, y=1, z=2. Default is 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bloch_phase</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the Bloch phase. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantity</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The quantity to plot. Default is 'real'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;real&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale for the heatmap. Default is 'RdBu'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rectify</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to rectify the field. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unwrap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to unwrap the phase. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase_in_degrees</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show the phase in degrees. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>tuple[go.Figure, go.Figure]: The Plotly figure objects for the electric and magnetic fields.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>    
<a id="__codelineno-0-1226" name="__codelineno-0-1226"></a>            <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-1227" name="__codelineno-0-1227"></a>            <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-1228" name="__codelineno-0-1228"></a>            <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-1229" name="__codelineno-0-1229"></a>            <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>            <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>            <span class="n">periods</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>            <span class="n">component</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>            <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>            <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>            <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;RdBu&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>            <span class="n">rectify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> 
<a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>            <span class="n">unwrap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>            <span class="n">phase_in_degrees</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1239" name="__codelineno-0-1239"></a><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1240" name="__codelineno-0-1240"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1241" name="__codelineno-0-1241"></a><span class="sd">    Plot the electromagnetic field distribution using Plotly.</span>
<a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>
<a id="__codelineno-0-1243" name="__codelineno-0-1243"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1244" name="__codelineno-0-1244"></a><span class="sd">        target_polarization (str): The polarization of the mode.</span>
<a id="__codelineno-0-1245" name="__codelineno-0-1245"></a><span class="sd">        target_k_point (tuple): The k-point of the mode.</span>
<a id="__codelineno-0-1246" name="__codelineno-0-1246"></a><span class="sd">        target_frequency (float): The frequency of the mode.</span>
<a id="__codelineno-0-1247" name="__codelineno-0-1247"></a><span class="sd">        frequency_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-1248" name="__codelineno-0-1248"></a><span class="sd">        k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-1249" name="__codelineno-0-1249"></a><span class="sd">        periods (int): The number of periods to extract. Default is 5.</span>
<a id="__codelineno-0-1250" name="__codelineno-0-1250"></a><span class="sd">        component (int): The component of the field to plot. x=0, y=1, z=2. Default is 2.</span>
<a id="__codelineno-0-1251" name="__codelineno-0-1251"></a><span class="sd">        bloch_phase (bool): Whether to include the Bloch phase. Default is True.</span>
<a id="__codelineno-0-1252" name="__codelineno-0-1252"></a><span class="sd">        quantity (str): The quantity to plot. Default is &#39;real&#39;.</span>
<a id="__codelineno-0-1253" name="__codelineno-0-1253"></a><span class="sd">        colorscale (str): The colorscale for the heatmap. Default is &#39;RdBu&#39;.</span>
<a id="__codelineno-0-1254" name="__codelineno-0-1254"></a><span class="sd">        rectify (bool): Whether to rectify the field. Default is True.</span>
<a id="__codelineno-0-1255" name="__codelineno-0-1255"></a><span class="sd">        unwrap (bool): Whether to unwrap the phase. Default is False.</span>
<a id="__codelineno-0-1256" name="__codelineno-0-1256"></a><span class="sd">        phase_in_degrees (bool): Whether to show the phase in degrees. Default is False.</span>
<a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>
<a id="__codelineno-0-1258" name="__codelineno-0-1258"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1259" name="__codelineno-0-1259"></a><span class="sd">        tuple[go.Figure, go.Figure]: The Plotly figure objects for the electric and magnetic fields.</span>
<a id="__codelineno-0-1260" name="__codelineno-0-1260"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>
<a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>    <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="p">)</span>
<a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">target_modes</span><span class="p">:</span>
<a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No modes found with the specified criteria.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>        <span class="k">return</span>
<a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>
<a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="n">rectify</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span> 
<a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>
<a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>    <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>    <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">max_eps</span> <span class="o">+</span> <span class="n">min_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>    <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span>
<a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>    <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>    <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>
<a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>        <span class="c1"># Initialize visibility status: False for all traces</span>
<a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>        <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>  <span class="c1"># Each mode adds two traces</span>
<a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>        <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>
<a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>
<a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>        <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the contour plot visible</span>
<a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>        <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>        <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
<a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>        <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
<a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>
<a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>        <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>        <span class="n">freq</span>    <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>        <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>
<a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>        <span class="c1"># Take the specified component of the fields in the center of the slab</span>
<a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>        <span class="k">if</span> <span class="n">bloch_phase</span><span class="p">:</span>
<a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>
<a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>
<a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>
<a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">())</span>
<a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">())</span>
<a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>            <span class="c1">#  here the k-point is set to zero so that the phase term is basically 1.</span>
<a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>
<a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>        <span class="n">e_field</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
<a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>        <span class="n">h_field</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
<a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>        <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>        <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>   
<a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>
<a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span> 
<a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>
<a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span> 
<a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>
<a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>            <span class="k">if</span> <span class="n">unwrap</span><span class="p">:</span>
<a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">e_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">h_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">e_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">h_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>
<a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>            <span class="k">if</span> <span class="n">phase_in_degrees</span><span class="p">:</span>
<a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>
<a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>
<a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>        <span class="c1"># Add the contour plot for permittivity (eps) at the midpoint</span>
<a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>        <span class="n">contour_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>                            <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>                                <span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>  <span class="c1"># Start and end at the midpoint to ensure a single level</span>
<a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>                                <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>
<a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>                                <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># A small size to keep it as a single contour</span>
<a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>                                <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>  <span class="c1"># No filling</span>
<a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>                            <span class="p">),</span>
<a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>                            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>                            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>                            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span>  <span class="mi">0</span>  <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># Only the first mode is visible</span>
<a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>        <span class="n">contour_h</span> <span class="o">=</span> <span class="n">contour_e</span>  <span class="c1"># Same contour for H-field figure</span>
<a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>
<a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span class="c1"># Add the contour trace</span>
<a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_e</span><span class="p">)</span>
<a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_h</span><span class="p">)</span>
<a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>
<a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>        <span class="c1"># Add the heatmap for the electric field</span>
<a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>        <span class="n">heatmap_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">e_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>                                <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>        <span class="c1"># Add the heatmap for the magnetic field</span>
<a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>        <span class="n">heatmap_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">h_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>                                <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>
<a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>        <span class="c1"># Add the heatmap trace</span>
<a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_e</span><span class="p">)</span>
<a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_h</span><span class="p">)</span>
<a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>
<a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>        <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>        <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
<a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;x-component&quot;</span>
<a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>        <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;y-component&quot;</span>
<a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;z-component&quot;</span>
<a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>        <span class="n">subtitle_e</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>        <span class="n">subtitle_h</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;H-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>        <span class="c1"># Create a button for each field dataset for the dropdown</span>
<a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>        <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>                                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>                                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
<a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>                                    <span class="p">]))</span>
<a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>        <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>                                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
<a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>                                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>                                    <span class="p">]))</span>
<a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>    <span class="n">k_point</span> <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>    <span class="n">freq</span>    <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>    <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2"> &lt;br&gt; k:[</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq:</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization:</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">, bloch_phase:</span><span class="si">{</span><span class="n">bloch_phase</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>
<a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                        <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">,</span>
<a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                        <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
<a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                        <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
<a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>
<a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>    <span class="p">)</span>
<a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>
<a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>                        <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">,</span>
<a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>                        <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
<a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>                        <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
<a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>    <span class="p">)</span>
<a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>
<a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>    <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>        <span class="k">if</span> <span class="n">phase_in_degrees</span><span class="p">:</span>
<a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Phase (degrees)&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Phase (degrees)&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Phase&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Phase&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>
<a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>    <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Amplitude&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>
<a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>    <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Real&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>
<a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>    <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Imaginary&#39;</span><span class="p">)))</span>
<a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>
<a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.Crystal2D.plot_field_components" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field_components</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">,</span> <span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">unwrap</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">phase_in_degrees</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.Crystal2D.plot_field_components" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.
For each component, the real, imaginary, absolute value, or phase can be plotted.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_frequency</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max_distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance for k-point similarity. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantity</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The quantity to plot ('real', 'imag', 'phase', or 'abs'). Default is 'real'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;real&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bloch_phase</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the Bloch phase. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale to use for the plot. Default is 'RdBu'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rectify</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to rectify the field. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unwrap</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to unwrap the phase. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase_in_degrees</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to show the phase in degrees. Default is False.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the electric field figure and the magnetic field figure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1448" name="__codelineno-0-1448"></a><span class="k">def</span> <span class="nf">plot_field_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                            <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>                            <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                            <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>                            <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                            <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>                            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                            <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                            <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>                            <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                            <span class="n">rectify</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>                            <span class="n">unwrap</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>                            <span class="n">phase_in_degrees</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>                            <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1462" name="__codelineno-0-1462"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1463" name="__codelineno-0-1463"></a><span class="sd">        Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>
<a id="__codelineno-0-1464" name="__codelineno-0-1464"></a><span class="sd">        For each component, the real, imaginary, absolute value, or phase can be plotted.</span>
<a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>
<a id="__codelineno-0-1466" name="__codelineno-0-1466"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1467" name="__codelineno-0-1467"></a><span class="sd">            target_polarization (str): The polarization of the target mode.</span>
<a id="__codelineno-0-1468" name="__codelineno-0-1468"></a><span class="sd">            target_k_point (tuple): The k-point of the target mode.</span>
<a id="__codelineno-0-1469" name="__codelineno-0-1469"></a><span class="sd">            target_frequency (float): The frequency of the target mode.</span>
<a id="__codelineno-0-1470" name="__codelineno-0-1470"></a><span class="sd">            frequency_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-1471" name="__codelineno-0-1471"></a><span class="sd">            k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-1472" name="__codelineno-0-1472"></a><span class="sd">            periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-1473" name="__codelineno-0-1473"></a><span class="sd">            quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, &#39;phase&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<a id="__codelineno-0-1474" name="__codelineno-0-1474"></a><span class="sd">            bloch_phase (bool): Whether to include the Bloch phase. Default is True.</span>
<a id="__codelineno-0-1475" name="__codelineno-0-1475"></a><span class="sd">            colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>
<a id="__codelineno-0-1476" name="__codelineno-0-1476"></a><span class="sd">            rectify (bool): Whether to rectify the field. Default is True.</span>
<a id="__codelineno-0-1477" name="__codelineno-0-1477"></a><span class="sd">            unwrap (bool): Whether to unwrap the phase. Default is False.</span>
<a id="__codelineno-0-1478" name="__codelineno-0-1478"></a><span class="sd">            phase_in_degrees (bool): Whether to show the phase in degrees. Default is False.</span>
<a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>
<a id="__codelineno-0-1480" name="__codelineno-0-1480"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1481" name="__codelineno-0-1481"></a><span class="sd">            tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<a id="__codelineno-0-1482" name="__codelineno-0-1482"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>
<a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>        <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>                                        <span class="n">freq_tolerance</span><span class="o">=</span><span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="n">k_point_max_distance</span><span class="p">)</span>
<a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of target modes found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>
<a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="n">rectify</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>            <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
<a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>
<a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>        <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
<a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>        <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>        <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>
<a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>
<a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Hx&quot;</span><span class="p">,</span> <span class="s2">&quot;Hy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hz&quot;</span><span class="p">))</span>
<a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>        <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>        <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>
<a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>        <span class="c1"># Initialize lists to collect all field components across modes</span>
<a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>        <span class="n">all_e_fields</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>        <span class="n">all_h_fields</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>
<a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>        <span class="c1"># For each mode, collect field components</span>
<a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>            <span class="c1"># Get field arrays for this mode</span>
<a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>            <span class="k">if</span> <span class="n">bloch_phase</span><span class="p">:</span>
<a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>                <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>                <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>                <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>                <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>                <span class="c1"># Here the k-point is set to zero so that the phase term is basically 1.</span>
<a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>
<a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>            <span class="c1"># Extract field components</span>
<a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>            <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>            <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>            <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>            <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>            <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>            <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>
<a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>            <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>                <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_x</span><span class="p">)</span>
<a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>                <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_y</span><span class="p">)</span>
<a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>                <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_z</span><span class="p">)</span>
<a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>                <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_x</span><span class="p">)</span>
<a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>                <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_y</span><span class="p">)</span>
<a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>                <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_z</span><span class="p">)</span>
<a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>
<a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">e_field_x</span><span class="p">,</span> <span class="n">e_field_y</span><span class="p">,</span> <span class="n">e_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">h_field_x</span><span class="p">,</span> <span class="n">h_field_y</span><span class="p">,</span> <span class="n">h_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>
<a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>            <span class="c1"># Select quantity to display</span>
<a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>            <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>
<a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>                <span class="k">if</span> <span class="n">unwrap</span><span class="p">:</span>
<a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">e_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">h_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">e_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unwrap</span><span class="p">(</span><span class="n">h_field</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>
<a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>                <span class="k">if</span> <span class="n">phase_in_degrees</span><span class="p">:</span>
<a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                    <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>                    <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, &#39;abs&#39;, or &#39;phase&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>
<a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>            <span class="c1"># Collect all field components</span>
<a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>            <span class="n">all_e_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>            <span class="n">all_h_fields</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>
<a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>        <span class="c1"># After collecting all fields, compute global min and max values</span>
<a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>        <span class="n">all_e_fields_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_e_fields</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>        <span class="n">all_h_fields_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">all_h_fields</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>
<a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>        <span class="n">global_e_min</span><span class="p">,</span> <span class="n">global_e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">all_e_fields_array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_e_fields_array</span><span class="p">)</span>
<a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>        <span class="n">global_h_min</span><span class="p">,</span> <span class="n">global_h_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">all_h_fields_array</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">all_h_fields_array</span><span class="p">)</span>
<a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>
<a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>        <span class="c1"># Now, add the traces to the figures</span>
<a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">all_e_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">all_h_fields</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
<a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
<a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>            <span class="c1"># Components of the E and H fields</span>
<a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>            <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>            <span class="n">Hx</span><span class="p">,</span> <span class="n">Hy</span><span class="p">,</span> <span class="n">Hz</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>
<a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>            <span class="c1"># Visibility settings</span>
<a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>            <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>            <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
<a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>                <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">6</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>
<a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>            <span class="c1"># Add contour traces for permittivity</span>
<a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
<a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                    <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span>
<a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>                        <span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>                        <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span>
<a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>                        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>                        <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>                        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>                        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
<a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>                    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span>
<a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>                <span class="p">)</span>
<a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                    <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span>
<a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                        <span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>                        <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span>
<a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>                        <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>                        <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>                        <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                        <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                        <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span>
<a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                    <span class="p">),</span>
<a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>                    <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">col</span>
<a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                <span class="p">)</span>
<a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>
<a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>            <span class="c1"># Add E-field components with shared coloraxis</span>
<a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>                <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                    <span class="n">z</span><span class="o">=</span><span class="n">Ex</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                    <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>                    <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>                    <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis1&quot;</span>
<a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                <span class="p">),</span>
<a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>            <span class="p">)</span>
<a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>                <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                    <span class="n">z</span><span class="o">=</span><span class="n">Ey</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>                    <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>                    <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                    <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis1&quot;</span>
<a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>                <span class="p">),</span>
<a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>                <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>            <span class="p">)</span>
<a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>                <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>                    <span class="n">z</span><span class="o">=</span><span class="n">Ez</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                    <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>                    <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                    <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis1&quot;</span>
<a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                <span class="p">),</span>
<a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>                <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>            <span class="p">)</span>
<a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>
<a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>            <span class="c1"># Add H-field components with shared coloraxis</span>
<a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>                <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>                    <span class="n">z</span><span class="o">=</span><span class="n">Hx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                    <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>                    <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                    <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis2&quot;</span>
<a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>                <span class="p">),</span>
<a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>                <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span>
<a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>            <span class="p">)</span>
<a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>                <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>                    <span class="n">z</span><span class="o">=</span><span class="n">Hy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>                    <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>                    <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>                    <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis2&quot;</span>
<a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>                <span class="p">),</span>
<a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>                <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span>
<a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>            <span class="p">)</span>
<a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
<a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>                <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span>
<a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>                    <span class="n">z</span><span class="o">=</span><span class="n">Hz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>                    <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>                    <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>                    <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
<a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>                    <span class="n">coloraxis</span><span class="o">=</span><span class="s2">&quot;coloraxis2&quot;</span>
<a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>                <span class="p">),</span>
<a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>                <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span>
<a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>            <span class="p">)</span>
<a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>
<a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>            <span class="c1"># Dropdown data</span>
<a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>            <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-1696" name="__codelineno-0-1696"></a>            <span class="n">mode_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>            <span class="n">mode_description</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-1698" name="__codelineno-0-1698"></a>                <span class="sa">f</span><span class="s2">&quot;k:[</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq:</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-1699" name="__codelineno-0-1699"></a>                <span class="sa">f</span><span class="s2">&quot;polarization:</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">, bloch_phase:</span><span class="si">{</span><span class="n">bloch_phase</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-1700" name="__codelineno-0-1700"></a>            <span class="p">)</span>
<a id="__codelineno-0-1701" name="__codelineno-0-1701"></a>
<a id="__codelineno-0-1702" name="__codelineno-0-1702"></a>            <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1703" name="__codelineno-0-1703"></a>                <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1704" name="__codelineno-0-1704"></a>                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>                    <span class="n">args</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>                        <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>
<a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components &lt;br&gt;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>                    <span class="p">]</span>
<a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>                <span class="p">)</span>
<a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>            <span class="p">)</span>
<a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>
<a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>            <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>                <span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>                    <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>                    <span class="n">args</span><span class="o">=</span><span class="p">[</span>
<a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>                        <span class="p">{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>
<a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components &lt;br&gt;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>                    <span class="p">]</span>
<a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>                <span class="p">)</span>
<a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>            <span class="p">)</span>
<a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>
<a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>        <span class="c1"># Define colorbar title based on quantity</span>
<a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;phase&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;Phase (degrees)&#39;</span> <span class="k">if</span> <span class="n">phase_in_degrees</span> <span class="k">else</span> <span class="s1">&#39;Phase&#39;</span>
<a id="__codelineno-0-1727" name="__codelineno-0-1727"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;Amplitude&#39;</span>
<a id="__codelineno-0-1729" name="__codelineno-0-1729"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1730" name="__codelineno-0-1730"></a>            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;Real&#39;</span>
<a id="__codelineno-0-1731" name="__codelineno-0-1731"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-1732" name="__codelineno-0-1732"></a>            <span class="n">colorbar_title</span> <span class="o">=</span> <span class="s1">&#39;Imaginary&#39;</span>
<a id="__codelineno-0-1733" name="__codelineno-0-1733"></a>
<a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>        <span class="c1"># Layout and color settings for fig_e</span>
<a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components &lt;br&gt;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">)],</span>
<a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>            <span class="n">coloraxis1</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>                <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span>
<a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>                <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>                <span class="n">cmin</span><span class="o">=</span><span class="n">global_e_min</span><span class="p">,</span>
<a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>                <span class="n">cmax</span><span class="o">=</span><span class="n">global_e_max</span>
<a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>            <span class="p">),</span>
<a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
<a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>            <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>            <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>            <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
<a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>        <span class="p">)</span>
<a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>
<a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>        <span class="c1"># Layout and color settings for fig_h</span>
<a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components &lt;br&gt;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">)],</span>
<a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>            <span class="n">coloraxis2</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>                <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span>
<a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>                <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>
<a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>                <span class="n">cmin</span><span class="o">=</span><span class="n">global_h_min</span><span class="p">,</span>
<a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>                <span class="n">cmax</span><span class="o">=</span><span class="n">global_h_max</span>
<a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>            <span class="p">),</span>
<a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span>
<a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>            <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>            <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>            <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
<a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>        <span class="p">)</span>
<a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>
<a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>        <span class="c1"># Final adjustments for axes</span>
<a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>
<a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>        <span class="c1"># Ensuring aspect ratio is equal</span>
<a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>
<a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>        <span class="c1"># Adding axis titles</span>
<a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>        <span class="k">for</span> <span class="n">fig</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span><span class="p">]:</span>
<a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>            <span class="n">fig</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>
<a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.Crystal2D.basic_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.Crystal2D.basic_lattice" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the basic lattice of the photonic crystal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice. Default is 'square'. Other option is 'triangular'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;square&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1806" name="__codelineno-0-1806"></a><span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1807" name="__codelineno-0-1807"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1808" name="__codelineno-0-1808"></a><span class="sd">    Define the basic lattice of the photonic crystal.</span>
<a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>
<a id="__codelineno-0-1810" name="__codelineno-0-1810"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1811" name="__codelineno-0-1811"></a><span class="sd">        lattice_type (str): The type of lattice. Default is &#39;square&#39;. Other option is &#39;triangular&#39;.</span>
<a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>
<a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1814" name="__codelineno-0-1814"></a><span class="sd">        tuple: A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-1815" name="__codelineno-0-1815"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1816" name="__codelineno-0-1816"></a>    <span class="k">if</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1817" name="__codelineno-0-1817"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">square_lattice</span><span class="p">()</span>
<a id="__codelineno-0-1818" name="__codelineno-0-1818"></a>    <span class="k">elif</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
<a id="__codelineno-0-1819" name="__codelineno-0-1819"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangular_lattice</span><span class="p">()</span>
<a id="__codelineno-0-1820" name="__codelineno-0-1820"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid lattice type. Choose &#39;square&#39; or &#39;triangular&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.Crystal2D.square_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">square_lattice</span><span class="p">()</span></code>

<a href="#src.photonic_crystal.Crystal2D.square_lattice" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the square lattice for the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1826" name="__codelineno-0-1826"></a><span class="k">def</span> <span class="nf">square_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1827" name="__codelineno-0-1827"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1828" name="__codelineno-0-1828"></a><span class="sd">    Define the square lattice for the photonic crystal.</span>
<a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>
<a id="__codelineno-0-1830" name="__codelineno-0-1830"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1831" name="__codelineno-0-1831"></a><span class="sd">        tuple: A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-1832" name="__codelineno-0-1832"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>    <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>                      <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>                      <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>    <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># M</span>
<a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>       <span class="c1"># X</span>
<a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>    <span class="p">]</span>
<a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.Crystal2D.triangular_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">triangular_lattice</span><span class="p">(</span><span class="n">flat_top</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.Crystal2D.triangular_lattice" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the triangular lattice for the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1846" name="__codelineno-0-1846"></a><span class="k">def</span> <span class="nf">triangular_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">flat_top</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-1847" name="__codelineno-0-1847"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1848" name="__codelineno-0-1848"></a><span class="sd">    Define the triangular lattice for the photonic crystal.</span>
<a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>
<a id="__codelineno-0-1850" name="__codelineno-0-1850"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1851" name="__codelineno-0-1851"></a><span class="sd">        tuple: A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-1852" name="__codelineno-0-1852"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>
<a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>    <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>                        <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>                        <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>
<a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>    <span class="c1"># lattice = mp.Lattice(size=mp.Vector3(1, 1),</span>
<a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>    <span class="c1">#                         basis1=mp.Vector3(math.sqrt(3)/2, 0.5),</span>
<a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>    <span class="c1">#                         basis2=mp.Vector3(math.sqrt(3)/2, -0.5))    </span>
<a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>    <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># K</span>
<a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>    <span class="c1"># M</span>
<a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>    <span class="p">]</span>
<a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>
<a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="src.photonic_crystal.CrystalSlab" class="doc doc-heading">
            <code>CrystalSlab</code>


<a href="#src.photonic_crystal.CrystalSlab" class="headerlink" title="Anchor link to this section">&para;</a></h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="src.photonic_crystal.PhotonicCrystal" href="#src.photonic_crystal.PhotonicCrystal">PhotonicCrystal</a></code></p>


        <p>CrystalSlab class represents a photonic crystal slab structure, inheriting from the PhotonicCrystal class.
This class provides methods to define the lattice, geometry, and to plot various properties of the photonic crystal slab.
Geometries can be added using mpb functions such as Cylinder, Ellipsoid, etc.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.geometry_lattice">geometry_lattice</span></code></td>
            <td>
                  <code><span title="meep.Lattice">Lattice</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lattice structure of the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.k_points">k_points</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.geometry">geometry</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of geometric objects defining the photonic crystal.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.k_points_interpolated">k_points_interpolated</span></code></td>
            <td>
                  <code>list</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Interpolated k-points for the simulation.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="src.photonic_crystal.CrystalSlab.epsilon">epsilon</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Dielectric function values obtained from the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Methods:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.__init__" href="#src.photonic_crystal.CrystalSlab.__init__">__init__</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Initializes the CrystalSlab object with the given parameters.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.plot_epsilon" href="#src.photonic_crystal.CrystalSlab.plot_epsilon">plot_epsilon</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the epsilon values obtained from the simulation using Plotly.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.basic_lattice" href="#src.photonic_crystal.CrystalSlab.basic_lattice">basic_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the basic lattice structure for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.square_lattice" href="#src.photonic_crystal.CrystalSlab.square_lattice">square_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the square lattice for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.triangular_lattice" href="#src.photonic_crystal.CrystalSlab.triangular_lattice">triangular_lattice</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the triangular lattice for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.basic_geometry" href="#src.photonic_crystal.CrystalSlab.basic_geometry">basic_geometry</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Defines the basic geometry for the photonic crystal.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.plot_field" href="#src.photonic_crystal.CrystalSlab.plot_field">plot_field</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the field for a specific mode based on the given parameters.</p>
                </div>
              </td>
            </tr>
            <tr class="doc-section-item">
              <td><code><a class="autorefs autorefs-internal" title="src.photonic_crystal.CrystalSlab.plot_field_components" href="#src.photonic_crystal.CrystalSlab.plot_field_components">plot_field_components</a></code></td>
              <td>
                <div class="doc-md-description">
                  <p>Plots the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</p>
                </div>
              </td>
            </tr>
      </tbody>
    </table>






              <details class="quote">
                <summary>Source code in <code>src/photonic_crystal.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span>
<span class="normal"><a href="#__codelineno-0-2304">2304</a></span>
<span class="normal"><a href="#__codelineno-0-2305">2305</a></span>
<span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span>
<span class="normal"><a href="#__codelineno-0-2337">2337</a></span>
<span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span>
<span class="normal"><a href="#__codelineno-0-2369">2369</a></span>
<span class="normal"><a href="#__codelineno-0-2370">2370</a></span>
<span class="normal"><a href="#__codelineno-0-2371">2371</a></span>
<span class="normal"><a href="#__codelineno-0-2372">2372</a></span>
<span class="normal"><a href="#__codelineno-0-2373">2373</a></span>
<span class="normal"><a href="#__codelineno-0-2374">2374</a></span>
<span class="normal"><a href="#__codelineno-0-2375">2375</a></span>
<span class="normal"><a href="#__codelineno-0-2376">2376</a></span>
<span class="normal"><a href="#__codelineno-0-2377">2377</a></span>
<span class="normal"><a href="#__codelineno-0-2378">2378</a></span>
<span class="normal"><a href="#__codelineno-0-2379">2379</a></span>
<span class="normal"><a href="#__codelineno-0-2380">2380</a></span>
<span class="normal"><a href="#__codelineno-0-2381">2381</a></span>
<span class="normal"><a href="#__codelineno-0-2382">2382</a></span>
<span class="normal"><a href="#__codelineno-0-2383">2383</a></span>
<span class="normal"><a href="#__codelineno-0-2384">2384</a></span>
<span class="normal"><a href="#__codelineno-0-2385">2385</a></span>
<span class="normal"><a href="#__codelineno-0-2386">2386</a></span>
<span class="normal"><a href="#__codelineno-0-2387">2387</a></span>
<span class="normal"><a href="#__codelineno-0-2388">2388</a></span>
<span class="normal"><a href="#__codelineno-0-2389">2389</a></span>
<span class="normal"><a href="#__codelineno-0-2390">2390</a></span>
<span class="normal"><a href="#__codelineno-0-2391">2391</a></span>
<span class="normal"><a href="#__codelineno-0-2392">2392</a></span>
<span class="normal"><a href="#__codelineno-0-2393">2393</a></span>
<span class="normal"><a href="#__codelineno-0-2394">2394</a></span>
<span class="normal"><a href="#__codelineno-0-2395">2395</a></span>
<span class="normal"><a href="#__codelineno-0-2396">2396</a></span>
<span class="normal"><a href="#__codelineno-0-2397">2397</a></span>
<span class="normal"><a href="#__codelineno-0-2398">2398</a></span>
<span class="normal"><a href="#__codelineno-0-2399">2399</a></span>
<span class="normal"><a href="#__codelineno-0-2400">2400</a></span>
<span class="normal"><a href="#__codelineno-0-2401">2401</a></span>
<span class="normal"><a href="#__codelineno-0-2402">2402</a></span>
<span class="normal"><a href="#__codelineno-0-2403">2403</a></span>
<span class="normal"><a href="#__codelineno-0-2404">2404</a></span>
<span class="normal"><a href="#__codelineno-0-2405">2405</a></span>
<span class="normal"><a href="#__codelineno-0-2406">2406</a></span>
<span class="normal"><a href="#__codelineno-0-2407">2407</a></span>
<span class="normal"><a href="#__codelineno-0-2408">2408</a></span>
<span class="normal"><a href="#__codelineno-0-2409">2409</a></span>
<span class="normal"><a href="#__codelineno-0-2410">2410</a></span>
<span class="normal"><a href="#__codelineno-0-2411">2411</a></span>
<span class="normal"><a href="#__codelineno-0-2412">2412</a></span>
<span class="normal"><a href="#__codelineno-0-2413">2413</a></span>
<span class="normal"><a href="#__codelineno-0-2414">2414</a></span>
<span class="normal"><a href="#__codelineno-0-2415">2415</a></span>
<span class="normal"><a href="#__codelineno-0-2416">2416</a></span>
<span class="normal"><a href="#__codelineno-0-2417">2417</a></span>
<span class="normal"><a href="#__codelineno-0-2418">2418</a></span>
<span class="normal"><a href="#__codelineno-0-2419">2419</a></span>
<span class="normal"><a href="#__codelineno-0-2420">2420</a></span>
<span class="normal"><a href="#__codelineno-0-2421">2421</a></span>
<span class="normal"><a href="#__codelineno-0-2422">2422</a></span>
<span class="normal"><a href="#__codelineno-0-2423">2423</a></span>
<span class="normal"><a href="#__codelineno-0-2424">2424</a></span>
<span class="normal"><a href="#__codelineno-0-2425">2425</a></span>
<span class="normal"><a href="#__codelineno-0-2426">2426</a></span>
<span class="normal"><a href="#__codelineno-0-2427">2427</a></span>
<span class="normal"><a href="#__codelineno-0-2428">2428</a></span>
<span class="normal"><a href="#__codelineno-0-2429">2429</a></span>
<span class="normal"><a href="#__codelineno-0-2430">2430</a></span>
<span class="normal"><a href="#__codelineno-0-2431">2431</a></span>
<span class="normal"><a href="#__codelineno-0-2432">2432</a></span>
<span class="normal"><a href="#__codelineno-0-2433">2433</a></span>
<span class="normal"><a href="#__codelineno-0-2434">2434</a></span>
<span class="normal"><a href="#__codelineno-0-2435">2435</a></span>
<span class="normal"><a href="#__codelineno-0-2436">2436</a></span>
<span class="normal"><a href="#__codelineno-0-2437">2437</a></span>
<span class="normal"><a href="#__codelineno-0-2438">2438</a></span>
<span class="normal"><a href="#__codelineno-0-2439">2439</a></span>
<span class="normal"><a href="#__codelineno-0-2440">2440</a></span>
<span class="normal"><a href="#__codelineno-0-2441">2441</a></span>
<span class="normal"><a href="#__codelineno-0-2442">2442</a></span>
<span class="normal"><a href="#__codelineno-0-2443">2443</a></span>
<span class="normal"><a href="#__codelineno-0-2444">2444</a></span>
<span class="normal"><a href="#__codelineno-0-2445">2445</a></span>
<span class="normal"><a href="#__codelineno-0-2446">2446</a></span>
<span class="normal"><a href="#__codelineno-0-2447">2447</a></span>
<span class="normal"><a href="#__codelineno-0-2448">2448</a></span>
<span class="normal"><a href="#__codelineno-0-2449">2449</a></span>
<span class="normal"><a href="#__codelineno-0-2450">2450</a></span>
<span class="normal"><a href="#__codelineno-0-2451">2451</a></span>
<span class="normal"><a href="#__codelineno-0-2452">2452</a></span>
<span class="normal"><a href="#__codelineno-0-2453">2453</a></span>
<span class="normal"><a href="#__codelineno-0-2454">2454</a></span>
<span class="normal"><a href="#__codelineno-0-2455">2455</a></span>
<span class="normal"><a href="#__codelineno-0-2456">2456</a></span>
<span class="normal"><a href="#__codelineno-0-2457">2457</a></span>
<span class="normal"><a href="#__codelineno-0-2458">2458</a></span>
<span class="normal"><a href="#__codelineno-0-2459">2459</a></span>
<span class="normal"><a href="#__codelineno-0-2460">2460</a></span>
<span class="normal"><a href="#__codelineno-0-2461">2461</a></span>
<span class="normal"><a href="#__codelineno-0-2462">2462</a></span>
<span class="normal"><a href="#__codelineno-0-2463">2463</a></span>
<span class="normal"><a href="#__codelineno-0-2464">2464</a></span>
<span class="normal"><a href="#__codelineno-0-2465">2465</a></span>
<span class="normal"><a href="#__codelineno-0-2466">2466</a></span>
<span class="normal"><a href="#__codelineno-0-2467">2467</a></span>
<span class="normal"><a href="#__codelineno-0-2468">2468</a></span>
<span class="normal"><a href="#__codelineno-0-2469">2469</a></span>
<span class="normal"><a href="#__codelineno-0-2470">2470</a></span>
<span class="normal"><a href="#__codelineno-0-2471">2471</a></span>
<span class="normal"><a href="#__codelineno-0-2472">2472</a></span>
<span class="normal"><a href="#__codelineno-0-2473">2473</a></span>
<span class="normal"><a href="#__codelineno-0-2474">2474</a></span>
<span class="normal"><a href="#__codelineno-0-2475">2475</a></span>
<span class="normal"><a href="#__codelineno-0-2476">2476</a></span>
<span class="normal"><a href="#__codelineno-0-2477">2477</a></span>
<span class="normal"><a href="#__codelineno-0-2478">2478</a></span>
<span class="normal"><a href="#__codelineno-0-2479">2479</a></span>
<span class="normal"><a href="#__codelineno-0-2480">2480</a></span>
<span class="normal"><a href="#__codelineno-0-2481">2481</a></span>
<span class="normal"><a href="#__codelineno-0-2482">2482</a></span>
<span class="normal"><a href="#__codelineno-0-2483">2483</a></span>
<span class="normal"><a href="#__codelineno-0-2484">2484</a></span>
<span class="normal"><a href="#__codelineno-0-2485">2485</a></span>
<span class="normal"><a href="#__codelineno-0-2486">2486</a></span>
<span class="normal"><a href="#__codelineno-0-2487">2487</a></span>
<span class="normal"><a href="#__codelineno-0-2488">2488</a></span>
<span class="normal"><a href="#__codelineno-0-2489">2489</a></span>
<span class="normal"><a href="#__codelineno-0-2490">2490</a></span>
<span class="normal"><a href="#__codelineno-0-2491">2491</a></span>
<span class="normal"><a href="#__codelineno-0-2492">2492</a></span>
<span class="normal"><a href="#__codelineno-0-2493">2493</a></span>
<span class="normal"><a href="#__codelineno-0-2494">2494</a></span>
<span class="normal"><a href="#__codelineno-0-2495">2495</a></span>
<span class="normal"><a href="#__codelineno-0-2496">2496</a></span>
<span class="normal"><a href="#__codelineno-0-2497">2497</a></span>
<span class="normal"><a href="#__codelineno-0-2498">2498</a></span>
<span class="normal"><a href="#__codelineno-0-2499">2499</a></span>
<span class="normal"><a href="#__codelineno-0-2500">2500</a></span>
<span class="normal"><a href="#__codelineno-0-2501">2501</a></span>
<span class="normal"><a href="#__codelineno-0-2502">2502</a></span>
<span class="normal"><a href="#__codelineno-0-2503">2503</a></span>
<span class="normal"><a href="#__codelineno-0-2504">2504</a></span>
<span class="normal"><a href="#__codelineno-0-2505">2505</a></span>
<span class="normal"><a href="#__codelineno-0-2506">2506</a></span>
<span class="normal"><a href="#__codelineno-0-2507">2507</a></span>
<span class="normal"><a href="#__codelineno-0-2508">2508</a></span>
<span class="normal"><a href="#__codelineno-0-2509">2509</a></span>
<span class="normal"><a href="#__codelineno-0-2510">2510</a></span>
<span class="normal"><a href="#__codelineno-0-2511">2511</a></span>
<span class="normal"><a href="#__codelineno-0-2512">2512</a></span>
<span class="normal"><a href="#__codelineno-0-2513">2513</a></span>
<span class="normal"><a href="#__codelineno-0-2514">2514</a></span>
<span class="normal"><a href="#__codelineno-0-2515">2515</a></span>
<span class="normal"><a href="#__codelineno-0-2516">2516</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1882" name="__codelineno-0-1882"></a><span class="k">class</span> <span class="nc">CrystalSlab</span><span class="p">(</span><span class="n">PhotonicCrystal</span><span class="p">):</span>
<a id="__codelineno-0-1883" name="__codelineno-0-1883"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1884" name="__codelineno-0-1884"></a><span class="sd">    CrystalSlab class represents a photonic crystal slab structure, inheriting from the PhotonicCrystal class.</span>
<a id="__codelineno-0-1885" name="__codelineno-0-1885"></a><span class="sd">    This class provides methods to define the lattice, geometry, and to plot various properties of the photonic crystal slab.</span>
<a id="__codelineno-0-1886" name="__codelineno-0-1886"></a><span class="sd">    Geometries can be added using mpb functions such as Cylinder, Ellipsoid, etc.</span>
<a id="__codelineno-0-1887" name="__codelineno-0-1887"></a>
<a id="__codelineno-0-1888" name="__codelineno-0-1888"></a>
<a id="__codelineno-0-1889" name="__codelineno-0-1889"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-1890" name="__codelineno-0-1890"></a><span class="sd">        geometry_lattice (mp.Lattice): The lattice structure of the photonic crystal.</span>
<a id="__codelineno-0-1891" name="__codelineno-0-1891"></a><span class="sd">        k_points (list): List of k-points for the simulation.</span>
<a id="__codelineno-0-1892" name="__codelineno-0-1892"></a><span class="sd">        geometry (list): List of geometric objects defining the photonic crystal.</span>
<a id="__codelineno-0-1893" name="__codelineno-0-1893"></a><span class="sd">        k_points_interpolated (list): Interpolated k-points for the simulation.</span>
<a id="__codelineno-0-1894" name="__codelineno-0-1894"></a><span class="sd">        epsilon (np.ndarray): Dielectric function values obtained from the simulation.</span>
<a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>
<a id="__codelineno-0-1896" name="__codelineno-0-1896"></a><span class="sd">    Methods:</span>
<a id="__codelineno-0-1897" name="__codelineno-0-1897"></a><span class="sd">        __init__(self, lattice_type=None, num_bands=4, resolution=mp.Vector3(32,32,16), interp=2, periods=3, pickle_id=None, geometry=None, use_XY=True, k_point_max=0.2):</span>
<a id="__codelineno-0-1898" name="__codelineno-0-1898"></a><span class="sd">            Initializes the CrystalSlab object with the given parameters.</span>
<a id="__codelineno-0-1899" name="__codelineno-0-1899"></a><span class="sd">        plot_epsilon(self, fig=None, opacity=0.3, colorscale=&#39;PuBuGn&#39;, override_resolution_with=None, periods=1):</span>
<a id="__codelineno-0-1900" name="__codelineno-0-1900"></a><span class="sd">            Plots the epsilon values obtained from the simulation using Plotly.</span>
<a id="__codelineno-0-1901" name="__codelineno-0-1901"></a><span class="sd">        basic_lattice(lattice_type=&#39;square&#39;, height_supercell=4):</span>
<a id="__codelineno-0-1902" name="__codelineno-0-1902"></a><span class="sd">            Defines the basic lattice structure for the photonic crystal.</span>
<a id="__codelineno-0-1903" name="__codelineno-0-1903"></a><span class="sd">        square_lattice(height_supercell=4):</span>
<a id="__codelineno-0-1904" name="__codelineno-0-1904"></a><span class="sd">            Defines the square lattice for the photonic crystal.</span>
<a id="__codelineno-0-1905" name="__codelineno-0-1905"></a><span class="sd">        triangular_lattice(height_supercell=4):</span>
<a id="__codelineno-0-1906" name="__codelineno-0-1906"></a><span class="sd">            Defines the triangular lattice for the photonic crystal.</span>
<a id="__codelineno-0-1907" name="__codelineno-0-1907"></a><span class="sd">        basic_geometry(radius=0.2, material=None):</span>
<a id="__codelineno-0-1908" name="__codelineno-0-1908"></a><span class="sd">            Defines the basic geometry for the photonic crystal.</span>
<a id="__codelineno-0-1909" name="__codelineno-0-1909"></a><span class="sd">        plot_field(self, target_polarization, target_k_point, target_frequency, frequency_tolerance=0.01, k_point_max_distance=None, periods=1, component=2, quantity=&#39;real&#39;, colorscale=&#39;RdBu&#39;):</span>
<a id="__codelineno-0-1910" name="__codelineno-0-1910"></a><span class="sd">            Plots the field for a specific mode based on the given parameters.</span>
<a id="__codelineno-0-1911" name="__codelineno-0-1911"></a><span class="sd">        plot_field_components(self, target_polarization, target_k_point, target_frequency, frequency_tolerance=0.01, k_point_max_distance=None, periods=1, quantity=&#39;real&#39;, colorscale=&#39;RdBu&#39;):</span>
<a id="__codelineno-0-1912" name="__codelineno-0-1912"></a><span class="sd">            Plots the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>
<a id="__codelineno-0-1913" name="__codelineno-0-1913"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>
<a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>                <span class="n">lattice_type</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>                <span class="n">material</span><span class="p">:</span> <span class="n">Crystal_Materials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>                <span class="n">geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>                <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>                <span class="n">resolution</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>                <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>                <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>                <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>                <span class="n">use_XY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>                <span class="n">k_point_max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a><span class="sd">        Initializes the CrystalSlab object with the given parameters.</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a><span class="sd">            lattice_type (str): The type of lattice. It can be &#39;square&#39; or &#39;triangular&#39;. Default is &#39;square&#39;.</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a><span class="sd">            material (Crystal_Materials): The material object for the photonic crystal. Default is None.</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a><span class="sd">            geometry (CrystalSlab_Geometry): The geometry of the photonic crystal. Default is None. If it is none, the basic geometry is used.</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a><span class="sd">            num_bands (int): The number of bands to calculate. Default is 4.</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a><span class="sd">            resolution (mp.Vector3): The resolution of the simulation. Default is mp.Vector3(32, 32, 16).</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a><span class="sd">            interp (int): The interpolation factor for k-points. Default is 2.</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a><span class="sd">            periods (int): The number of periods to use in some plotting functions. Default is 3.</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a><span class="sd">            pickle_id (str): The ID for pickling the simulation. Default is None.</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a><span class="sd">            use_XY (bool): Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a><span class="sd">            k_point_max (float): The maximum k-point value. Default is 0.2.</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">,</span> <span class="n">use_XY</span><span class="p">)</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">)</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>        <span class="k">if</span> <span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> 
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># X</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>                <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># Y</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>            <span class="p">]</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">()</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>
<a id="__codelineno-0-1955" name="__codelineno-0-1955"></a>
<a id="__codelineno-0-1956" name="__codelineno-0-1956"></a>    <span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>                    <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>                    <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> 
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>                    <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;PuBuGn&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>                    <span class="n">override_resolution_with</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>                    <span class="n">periods</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>                    <span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a><span class="sd">        Plot the epsilon values obtained from the simulation using Plotly.</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a><span class="sd">            fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a><span class="sd">            opacity (float, optional): The opacity of the plot. Default is 0.3.</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a><span class="sd">            colorscale (str, optional): The colorscale for the plot. Default is &#39;PuBuGn&#39;.</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a><span class="sd">            override_resolution_with (int, optional): The resolution to use for plotting. You can change the resolution just for the plot, but the simulation will still use the value set in the __init__ method. Default is None.</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a><span class="sd">            periods (int, optional): The number of periods to plot. Default is 1.</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a><span class="sd">            go.Figure: The Plotly figure object.</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>            <span class="k">if</span> <span class="n">override_resolution_with</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>                <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>                <span class="n">resolution</span> <span class="o">=</span> <span class="n">override_resolution_with</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>            <span class="n">converted_eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>            <span class="n">converted_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>            <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>        <span class="n">z_points</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="n">periods</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>        <span class="n">z_mid</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="o">-</span><span class="n">z_points</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="n">z_mid</span><span class="o">+</span><span class="n">z_points</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>        <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> 
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>        <span class="c1"># Create indices for x, y, z axes (meshgrid)</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>                            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>        <span class="c1"># Flatten the arrays for Plotly</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>        <span class="n">x_flat</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>        <span class="n">y_flat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>        <span class="n">z_flat</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>        <span class="n">epsilon_flat</span> <span class="o">=</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>        <span class="c1"># Get the minimum and maximum values from the epsilon array (ensure they are floats)</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>        <span class="n">isomin_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">epsilon_flat</span><span class="p">))</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>        <span class="n">isomax_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">epsilon_flat</span><span class="p">))</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>        <span class="c1"># Create the 3D volume plot using Plotly</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>            <span class="n">x</span><span class="o">=</span><span class="n">x_flat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_flat</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z_flat</span><span class="p">,</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>            <span class="n">value</span><span class="o">=</span><span class="n">epsilon_flat</span><span class="p">,</span>  <span class="c1"># Use the dielectric function values</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>            <span class="n">isomin</span><span class="o">=</span><span class="n">isomin_value</span><span class="p">,</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>            <span class="n">isomax</span><span class="o">=</span><span class="n">isomax_value</span><span class="p">,</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>            <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>  <span class="c1"># Adjust opacity to visualize internal structure</span>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>            <span class="n">surface_count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># Number of surfaces to display</span>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>            <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>  <span class="c1"># Color scale for the dielectric function</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>            <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Dielectric Constant&#39;</span><span class="p">)</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>        <span class="p">))</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>        <span class="c1"># Add layout details</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Volume Plot of Dielectric Function&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>            <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>            <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>            <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>            <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>            <span class="p">)</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>        <span class="p">)</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>        <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>        <span class="k">return</span> <span class="n">fig</span>
<a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>
<a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>
<a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>    <span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a><span class="sd">        Define the basic lattice structure for the photonic crystal.</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a><span class="sd">            lattice_type (str): The type of lattice. Default is &#39;square&#39;.</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a><span class="sd">            height_supercell (int): The height of the supercell. Default is 4.</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a><span class="sd">            tuple: A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>        <span class="k">if</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">square_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="n">height_supercell</span><span class="p">)</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>        <span class="k">elif</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangular_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="n">height_supercell</span><span class="p">)</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid lattice type. Choose &#39;square&#39; or &#39;triangular&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>
<a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>
<a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>    <span class="k">def</span> <span class="nf">square_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a><span class="sd">        Define the square lattice for the photonic crystal.</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a><span class="sd">            tuple: A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>        <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>                          <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>                          <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>        <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># M</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>       <span class="c1"># X</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>        <span class="p">]</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>        <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
<a id="__codelineno-0-2078" name="__codelineno-0-2078"></a>
<a id="__codelineno-0-2079" name="__codelineno-0-2079"></a>
<a id="__codelineno-0-2080" name="__codelineno-0-2080"></a>    <span class="k">def</span> <span class="nf">triangular_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a><span class="sd">        Define the triangular lattice for the photonic crystal.</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a><span class="sd">            tuple: A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>        <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>                          <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>                          <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>        <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># K</span>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>    <span class="c1"># M</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>        <span class="p">]</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>        <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
<a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>
<a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>    <span class="nd">@staticmethod</span> 
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>    <span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>        <span class="n">radius</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>        <span class="n">material</span><span class="p">:</span> <span class="n">Crystal_Materials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>    <span class="p">):</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a><span class="sd">        Define the basic geometry for the photonic crystal slab.</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a><span class="sd">            radius (float): The radius of the cylinder. Default is 0.2.</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a><span class="sd">            material (Crystal_Materials): The material object for the photonic crystal. Default is None.</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a><span class="sd">            CrystalSlab_Geometry: The geometry object representing the photonic crystal slab.</span>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>        <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>            <span class="n">material</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">basic_material</span><span class="p">()</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>        <span class="n">geometry</span> <span class="o">=</span> <span class="n">CrystalSlab_Geometry</span><span class="p">(</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span><span class="p">,</span> <span class="n">geometry_type</span><span class="o">=</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">)</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>        <span class="k">return</span> <span class="n">geometry</span>
<a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>
<a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>
<a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>
<a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>
<a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>    <span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>            <span class="n">target_polarization</span><span class="p">,</span> 
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>            <span class="n">target_k_point</span><span class="p">,</span> 
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>            <span class="n">target_frequency</span><span class="p">,</span> 
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>            <span class="n">frequency_tolerance</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> 
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>            <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>            <span class="n">component</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> 
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>            <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>            <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>            <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>                  
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>            <span class="p">):</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a><span class="sd">        Plot the field for a specific mode based on the given parameters.</span>
<a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>
<a id="__codelineno-0-2137" name="__codelineno-0-2137"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-2138" name="__codelineno-0-2138"></a><span class="sd">            target_polarization (str): The polarization of the target mode.</span>
<a id="__codelineno-0-2139" name="__codelineno-0-2139"></a><span class="sd">            target_k_point (tuple): The k-point of the target mode.</span>
<a id="__codelineno-0-2140" name="__codelineno-0-2140"></a><span class="sd">            target_frequency (float): The frequency of the target mode.</span>
<a id="__codelineno-0-2141" name="__codelineno-0-2141"></a><span class="sd">            frequency_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-2142" name="__codelineno-0-2142"></a><span class="sd">            periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-2143" name="__codelineno-0-2143"></a><span class="sd">            component (int): The component of the field to plot (0 for x, 1 for y, 2 for z). Default is 2.</span>
<a id="__codelineno-0-2144" name="__codelineno-0-2144"></a><span class="sd">            quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<a id="__codelineno-0-2145" name="__codelineno-0-2145"></a><span class="sd">            bloch_phase (bool): Whether to include the Bloch phase. Default is True.</span>
<a id="__codelineno-0-2146" name="__codelineno-0-2146"></a><span class="sd">            colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>
<a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>
<a id="__codelineno-0-2148" name="__codelineno-0-2148"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-2149" name="__codelineno-0-2149"></a><span class="sd">            tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<a id="__codelineno-0-2150" name="__codelineno-0-2150"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>        <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">freq_tolerance</span> <span class="o">=</span> <span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="n">k_point_max_distance</span><span class="p">)</span>
<a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>        <span class="c1">#print(len(target_modes))</span>
<a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>
<a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>            <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span> 
<a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>
<a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>        <span class="n">z_points</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">periods</span>
<a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>        <span class="n">z_mid</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>
<a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>        <span class="c1"># Now take only epsilon in the center of the slab</span>
<a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="p">]</span>
<a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>        <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
<a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>        <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>        <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>
<a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>
<a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>        <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>        <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2172" name="__codelineno-0-2172"></a>
<a id="__codelineno-0-2173" name="__codelineno-0-2173"></a>        <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span>
<a id="__codelineno-0-2174" name="__codelineno-0-2174"></a>
<a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-2176" name="__codelineno-0-2176"></a>            <span class="c1"># Initialize visibility status: False for all traces</span>
<a id="__codelineno-0-2177" name="__codelineno-0-2177"></a>            <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>  <span class="c1"># Each mode adds two traces</span>
<a id="__codelineno-0-2178" name="__codelineno-0-2178"></a>            <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>
<a id="__codelineno-0-2179" name="__codelineno-0-2179"></a>
<a id="__codelineno-0-2180" name="__codelineno-0-2180"></a>            <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the contour plot visible</span>
<a id="__codelineno-0-2181" name="__codelineno-0-2181"></a>            <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>            <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
<a id="__codelineno-0-2183" name="__codelineno-0-2183"></a>            <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
<a id="__codelineno-0-2184" name="__codelineno-0-2184"></a>
<a id="__codelineno-0-2185" name="__codelineno-0-2185"></a>            <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2186" name="__codelineno-0-2186"></a>            <span class="n">freq</span>    <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2187" name="__codelineno-0-2187"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2188" name="__codelineno-0-2188"></a>
<a id="__codelineno-0-2189" name="__codelineno-0-2189"></a>            <span class="c1"># Take the specified component of the fields in the center of the slab</span>
<a id="__codelineno-0-2190" name="__codelineno-0-2190"></a>            <span class="k">if</span> <span class="n">bloch_phase</span><span class="p">:</span>
<a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
<a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
<a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>            <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span> 
<a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>
<a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>            <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>
<a id="__codelineno-0-2214" name="__codelineno-0-2214"></a>            <span class="c1"># Add the contour plot for permittivity (eps) at the midpoint</span>
<a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>            <span class="n">contour_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-2216" name="__codelineno-0-2216"></a>                                <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2217" name="__codelineno-0-2217"></a>                                    <span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>  <span class="c1"># Start and end at the midpoint to ensure a single level</span>
<a id="__codelineno-0-2218" name="__codelineno-0-2218"></a>                                    <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>
<a id="__codelineno-0-2219" name="__codelineno-0-2219"></a>                                    <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># A small size to keep it as a single contour</span>
<a id="__codelineno-0-2220" name="__codelineno-0-2220"></a>                                    <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>  <span class="c1"># No filling</span>
<a id="__codelineno-0-2221" name="__codelineno-0-2221"></a>                                <span class="p">),</span>
<a id="__codelineno-0-2222" name="__codelineno-0-2222"></a>                                <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-2223" name="__codelineno-0-2223"></a>                                <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2224" name="__codelineno-0-2224"></a>                                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-2225" name="__codelineno-0-2225"></a>                                <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span>  <span class="mi">0</span>  <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># Only the first mode is visible</span>
<a id="__codelineno-0-2226" name="__codelineno-0-2226"></a>            <span class="n">contour_h</span> <span class="o">=</span> <span class="n">contour_e</span>  <span class="c1"># Same contour for H-field figure</span>
<a id="__codelineno-0-2227" name="__codelineno-0-2227"></a>
<a id="__codelineno-0-2228" name="__codelineno-0-2228"></a>            <span class="c1"># Add the contour trace</span>
<a id="__codelineno-0-2229" name="__codelineno-0-2229"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_e</span><span class="p">)</span>
<a id="__codelineno-0-2230" name="__codelineno-0-2230"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_h</span><span class="p">)</span>
<a id="__codelineno-0-2231" name="__codelineno-0-2231"></a>
<a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>            <span class="c1"># Add the heatmap for the electric field</span>
<a id="__codelineno-0-2233" name="__codelineno-0-2233"></a>            <span class="n">heatmap_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">e_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-2234" name="__codelineno-0-2234"></a>                                    <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2235" name="__codelineno-0-2235"></a>            <span class="c1"># Add the heatmap for the magnetic field</span>
<a id="__codelineno-0-2236" name="__codelineno-0-2236"></a>            <span class="n">heatmap_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">h_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-2237" name="__codelineno-0-2237"></a>                                    <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2238" name="__codelineno-0-2238"></a>
<a id="__codelineno-0-2239" name="__codelineno-0-2239"></a>            <span class="c1"># Add the heatmap trace</span>
<a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_e</span><span class="p">)</span>
<a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_h</span><span class="p">)</span>
<a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>
<a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>
<a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>
<a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>            <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>            <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
<a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;x-component&quot;</span>
<a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>            <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;y-component&quot;</span>
<a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>                <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;z-component&quot;</span>
<a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>            <span class="n">subtitle_e</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>            <span class="n">subtitle_h</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;H-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>            <span class="c1"># Create a button for each field dataset for the dropdown</span>
<a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>            <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>                                        <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
<a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>                                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>                                        <span class="p">]))</span>
<a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>            <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>                                        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>                                        <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
<a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>                                            <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>                                        <span class="p">]))</span>
<a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>
<a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>        <span class="c1"># print(len(target_modes))</span>
<a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>        <span class="n">k_point</span> <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>        <span class="n">freq</span>    <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>        <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>
<a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>                            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">,</span>
<a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>                            <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
<a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>                            <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
<a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>
<a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>        <span class="p">)</span>
<a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>
<a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>                            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">,</span>
<a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>                            <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
<a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>                            <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>            <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
<a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>            <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>            <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>        <span class="p">)</span>
<a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>
<a id="__codelineno-0-2302" name="__codelineno-0-2302"></a>        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
<a id="__codelineno-0-2303" name="__codelineno-0-2303"></a>
<a id="__codelineno-0-2304" name="__codelineno-0-2304"></a>
<a id="__codelineno-0-2305" name="__codelineno-0-2305"></a>
<a id="__codelineno-0-2306" name="__codelineno-0-2306"></a>    <span class="k">def</span> <span class="nf">plot_field_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2307" name="__codelineno-0-2307"></a>                            <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>                            <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-2309" name="__codelineno-0-2309"></a>                            <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>                            <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-2311" name="__codelineno-0-2311"></a>                            <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2312" name="__codelineno-0-2312"></a>                            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-2313" name="__codelineno-0-2313"></a>                            <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2314" name="__codelineno-0-2314"></a>                            <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2315" name="__codelineno-0-2315"></a>                            <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2316" name="__codelineno-0-2316"></a>                            <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-2317" name="__codelineno-0-2317"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2318" name="__codelineno-0-2318"></a><span class="sd">        Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>
<a id="__codelineno-0-2319" name="__codelineno-0-2319"></a>
<a id="__codelineno-0-2320" name="__codelineno-0-2320"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-2321" name="__codelineno-0-2321"></a><span class="sd">            target_polarization (str): The polarization of the target mode.</span>
<a id="__codelineno-0-2322" name="__codelineno-0-2322"></a><span class="sd">            target_k_point (tuple): The k-point of the target mode.</span>
<a id="__codelineno-0-2323" name="__codelineno-0-2323"></a><span class="sd">            target_frequency (float): The frequency of the target mode.</span>
<a id="__codelineno-0-2324" name="__codelineno-0-2324"></a><span class="sd">            frequency_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-2325" name="__codelineno-0-2325"></a><span class="sd">            k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-2326" name="__codelineno-0-2326"></a><span class="sd">            periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-2327" name="__codelineno-0-2327"></a><span class="sd">            quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<a id="__codelineno-0-2328" name="__codelineno-0-2328"></a><span class="sd">            bloch_phase (bool): Whether to include the Bloch</span>
<a id="__codelineno-0-2329" name="__codelineno-0-2329"></a><span class="sd">            colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>
<a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>
<a id="__codelineno-0-2331" name="__codelineno-0-2331"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-2332" name="__codelineno-0-2332"></a><span class="sd">            tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<a id="__codelineno-0-2333" name="__codelineno-0-2333"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>
<a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>        <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>                                        <span class="n">freq_tolerance</span><span class="o">=</span><span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="n">k_point_max_distance</span><span class="p">)</span>
<a id="__codelineno-0-2337" name="__codelineno-0-2337"></a>        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of target modes found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2338" name="__codelineno-0-2338"></a>
<a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2340" name="__codelineno-0-2340"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-2341" name="__codelineno-0-2341"></a>            <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-2342" name="__codelineno-0-2342"></a>            <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
<a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>
<a id="__codelineno-0-2344" name="__codelineno-0-2344"></a>        <span class="n">z_points</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">periods</span>
<a id="__codelineno-0-2345" name="__codelineno-0-2345"></a>        <span class="n">z_mid</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>
<a id="__codelineno-0-2347" name="__codelineno-0-2347"></a>        <span class="c1"># Now take only epsilon in the center of the slab</span>
<a id="__codelineno-0-2348" name="__codelineno-0-2348"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="p">]</span>
<a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>        <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
<a id="__codelineno-0-2350" name="__codelineno-0-2350"></a>        <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-0-2351" name="__codelineno-0-2351"></a>        <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>
<a id="__codelineno-0-2352" name="__codelineno-0-2352"></a>
<a id="__codelineno-0-2353" name="__codelineno-0-2353"></a>        <span class="n">fig_e</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2354" name="__codelineno-0-2354"></a>        <span class="n">fig_h</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Hx&quot;</span><span class="p">,</span> <span class="s2">&quot;Hy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hz&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2355" name="__codelineno-0-2355"></a>        <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>        <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>
<a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>        <span class="c1"># For each mode, calculate separate min and max values for Ex, Ey, Ez (and similarly Hx, Hy, Hz)</span>
<a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>            <span class="c1"># Get field arrays for this mode</span>
<a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>            <span class="k">if</span> <span class="n">bloch_phase</span><span class="p">:</span>
<a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>                <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>                <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>                <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>                <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>
<a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>            <span class="c1"># Extract field components in the center of the slab</span>
<a id="__codelineno-0-2369" name="__codelineno-0-2369"></a>            <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2370" name="__codelineno-0-2370"></a>            <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2371" name="__codelineno-0-2371"></a>            <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2372" name="__codelineno-0-2372"></a>            <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2373" name="__codelineno-0-2373"></a>            <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2374" name="__codelineno-0-2374"></a>            <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2375" name="__codelineno-0-2375"></a>
<a id="__codelineno-0-2376" name="__codelineno-0-2376"></a>            <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2377" name="__codelineno-0-2377"></a>                <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_x</span><span class="p">)</span>
<a id="__codelineno-0-2378" name="__codelineno-0-2378"></a>                <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_y</span><span class="p">)</span>
<a id="__codelineno-0-2379" name="__codelineno-0-2379"></a>                <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_z</span><span class="p">)</span>
<a id="__codelineno-0-2380" name="__codelineno-0-2380"></a>                <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_x</span><span class="p">)</span>
<a id="__codelineno-0-2381" name="__codelineno-0-2381"></a>                <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_y</span><span class="p">)</span>
<a id="__codelineno-0-2382" name="__codelineno-0-2382"></a>                <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_z</span><span class="p">)</span>
<a id="__codelineno-0-2383" name="__codelineno-0-2383"></a>
<a id="__codelineno-0-2384" name="__codelineno-0-2384"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">e_field_x</span><span class="p">,</span> <span class="n">e_field_y</span><span class="p">,</span> <span class="n">e_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2385" name="__codelineno-0-2385"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">h_field_x</span><span class="p">,</span> <span class="n">h_field_y</span><span class="p">,</span> <span class="n">h_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>                                    
<a id="__codelineno-0-2386" name="__codelineno-0-2386"></a>
<a id="__codelineno-0-2387" name="__codelineno-0-2387"></a>            <span class="c1"># Select quantity to display (real, imag, abs)</span>
<a id="__codelineno-0-2388" name="__codelineno-0-2388"></a>            <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2389" name="__codelineno-0-2389"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2390" name="__codelineno-0-2390"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2391" name="__codelineno-0-2391"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2392" name="__codelineno-0-2392"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2393" name="__codelineno-0-2393"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2394" name="__codelineno-0-2394"></a>            <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2395" name="__codelineno-0-2395"></a>                <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2396" name="__codelineno-0-2396"></a>                <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2397" name="__codelineno-0-2397"></a>            <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2398" name="__codelineno-0-2398"></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2399" name="__codelineno-0-2399"></a>
<a id="__codelineno-0-2400" name="__codelineno-0-2400"></a>            <span class="c1"># Calculate the component-specific min/max for E and H fields of this mode</span>
<a id="__codelineno-0-2401" name="__codelineno-0-2401"></a>            <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2402" name="__codelineno-0-2402"></a>            <span class="n">e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2403" name="__codelineno-0-2403"></a>            <span class="n">h_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2404" name="__codelineno-0-2404"></a>            <span class="n">h_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2405" name="__codelineno-0-2405"></a>
<a id="__codelineno-0-2406" name="__codelineno-0-2406"></a>            <span class="c1"># Components of the E and H fields</span>
<a id="__codelineno-0-2407" name="__codelineno-0-2407"></a>            <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2408" name="__codelineno-0-2408"></a>            <span class="n">Hx</span><span class="p">,</span> <span class="n">Hy</span><span class="p">,</span> <span class="n">Hz</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2409" name="__codelineno-0-2409"></a>
<a id="__codelineno-0-2410" name="__codelineno-0-2410"></a>            <span class="c1"># Define visibility settings per mode, including contours as always visible</span>
<a id="__codelineno-0-2411" name="__codelineno-0-2411"></a>            <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1"># 3 components per mode, with contour for each</span>
<a id="__codelineno-0-2412" name="__codelineno-0-2412"></a>            <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-0-2413" name="__codelineno-0-2413"></a>            <span class="c1"># Make the contour visible by default</span>
<a id="__codelineno-0-2414" name="__codelineno-0-2414"></a>
<a id="__codelineno-0-2415" name="__codelineno-0-2415"></a>
<a id="__codelineno-0-2416" name="__codelineno-0-2416"></a>
<a id="__codelineno-0-2417" name="__codelineno-0-2417"></a>
<a id="__codelineno-0-2418" name="__codelineno-0-2418"></a>            <span class="c1"># Make this mode&#39;s components and the corresponding contour visible in the initial layout </span>
<a id="__codelineno-0-2419" name="__codelineno-0-2419"></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
<a id="__codelineno-0-2420" name="__codelineno-0-2420"></a>                <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2421" name="__codelineno-0-2421"></a>                <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2422" name="__codelineno-0-2422"></a>
<a id="__codelineno-0-2423" name="__codelineno-0-2423"></a>
<a id="__codelineno-0-2424" name="__codelineno-0-2424"></a>            <span class="c1"># Add contour traces for permittivity to each subplot of fig_e and fig_h for this mode</span>
<a id="__codelineno-0-2425" name="__codelineno-0-2425"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2426" name="__codelineno-0-2426"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2427" name="__codelineno-0-2427"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2428" name="__codelineno-0-2428"></a>
<a id="__codelineno-0-2429" name="__codelineno-0-2429"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2430" name="__codelineno-0-2430"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2431" name="__codelineno-0-2431"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2432" name="__codelineno-0-2432"></a>
<a id="__codelineno-0-2433" name="__codelineno-0-2433"></a>            <span class="c1"># Add Ex, Ey, Ez with shared colorbar limits for the E field of this mode</span>
<a id="__codelineno-0-2434" name="__codelineno-0-2434"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ex</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2435" name="__codelineno-0-2435"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ey</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2436" name="__codelineno-0-2436"></a>            <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ez</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;E-field&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2437" name="__codelineno-0-2437"></a>
<a id="__codelineno-0-2438" name="__codelineno-0-2438"></a>            <span class="c1"># Add Hx, Hy, Hz with shared colorbar limits for the H field of this mode</span>
<a id="__codelineno-0-2439" name="__codelineno-0-2439"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2440" name="__codelineno-0-2440"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2441" name="__codelineno-0-2441"></a>            <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;H-field&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2442" name="__codelineno-0-2442"></a>
<a id="__codelineno-0-2443" name="__codelineno-0-2443"></a>
<a id="__codelineno-0-2444" name="__codelineno-0-2444"></a>
<a id="__codelineno-0-2445" name="__codelineno-0-2445"></a>            <span class="c1"># Dropdown data for E-field</span>
<a id="__codelineno-0-2446" name="__codelineno-0-2446"></a>            <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2447" name="__codelineno-0-2447"></a>            <span class="n">freq</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2448" name="__codelineno-0-2448"></a>            <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2449" name="__codelineno-0-2449"></a>            <span class="n">mode_description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&lt;br&gt;k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2450" name="__codelineno-0-2450"></a>
<a id="__codelineno-0-2451" name="__codelineno-0-2451"></a>            <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-2452" name="__codelineno-0-2452"></a>                <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2453" name="__codelineno-0-2453"></a>                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2454" name="__codelineno-0-2454"></a>                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>
<a id="__codelineno-0-2455" name="__codelineno-0-2455"></a>                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components&quot;</span><span class="p">}]))</span>
<a id="__codelineno-0-2456" name="__codelineno-0-2456"></a>
<a id="__codelineno-0-2457" name="__codelineno-0-2457"></a>            <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-2458" name="__codelineno-0-2458"></a>                <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2459" name="__codelineno-0-2459"></a>                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2460" name="__codelineno-0-2460"></a>                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>
<a id="__codelineno-0-2461" name="__codelineno-0-2461"></a>                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components&quot;</span><span class="p">}]))</span>
<a id="__codelineno-0-2462" name="__codelineno-0-2462"></a>
<a id="__codelineno-0-2463" name="__codelineno-0-2463"></a>        <span class="c1"># Layout and color settings</span>
<a id="__codelineno-0-2464" name="__codelineno-0-2464"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2465" name="__codelineno-0-2465"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2466" name="__codelineno-0-2466"></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2467" name="__codelineno-0-2467"></a>                <span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-2468" name="__codelineno-0-2468"></a>                <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">)],</span>
<a id="__codelineno-0-2469" name="__codelineno-0-2469"></a>            <span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)),</span>
<a id="__codelineno-0-2470" name="__codelineno-0-2470"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-2471" name="__codelineno-0-2471"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2472" name="__codelineno-0-2472"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2473" name="__codelineno-0-2473"></a>            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
<a id="__codelineno-0-2474" name="__codelineno-0-2474"></a>        <span class="p">)</span>
<a id="__codelineno-0-2475" name="__codelineno-0-2475"></a>
<a id="__codelineno-0-2476" name="__codelineno-0-2476"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2477" name="__codelineno-0-2477"></a>            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2478" name="__codelineno-0-2478"></a>            <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2479" name="__codelineno-0-2479"></a>                <span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-2480" name="__codelineno-0-2480"></a>                <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">)],</span>
<a id="__codelineno-0-2481" name="__codelineno-0-2481"></a>            <span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)),</span>
<a id="__codelineno-0-2482" name="__codelineno-0-2482"></a>            <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-2483" name="__codelineno-0-2483"></a>            <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2484" name="__codelineno-0-2484"></a>            <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2485" name="__codelineno-0-2485"></a>            <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
<a id="__codelineno-0-2486" name="__codelineno-0-2486"></a>        <span class="p">)</span>
<a id="__codelineno-0-2487" name="__codelineno-0-2487"></a>
<a id="__codelineno-0-2488" name="__codelineno-0-2488"></a>        <span class="c1"># Final adjustments</span>
<a id="__codelineno-0-2489" name="__codelineno-0-2489"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2490" name="__codelineno-0-2490"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2491" name="__codelineno-0-2491"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2492" name="__codelineno-0-2492"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2493" name="__codelineno-0-2493"></a>
<a id="__codelineno-0-2494" name="__codelineno-0-2494"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2495" name="__codelineno-0-2495"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2496" name="__codelineno-0-2496"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2497" name="__codelineno-0-2497"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2498" name="__codelineno-0-2498"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2499" name="__codelineno-0-2499"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2500" name="__codelineno-0-2500"></a>
<a id="__codelineno-0-2501" name="__codelineno-0-2501"></a>
<a id="__codelineno-0-2502" name="__codelineno-0-2502"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2503" name="__codelineno-0-2503"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2504" name="__codelineno-0-2504"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2505" name="__codelineno-0-2505"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2506" name="__codelineno-0-2506"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2507" name="__codelineno-0-2507"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2508" name="__codelineno-0-2508"></a>
<a id="__codelineno-0-2509" name="__codelineno-0-2509"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2510" name="__codelineno-0-2510"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2511" name="__codelineno-0-2511"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2512" name="__codelineno-0-2512"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2513" name="__codelineno-0-2513"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2514" name="__codelineno-0-2514"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2515" name="__codelineno-0-2515"></a>
<a id="__codelineno-0-2516" name="__codelineno-0-2516"></a>        <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">







<h5 id="src.photonic_crystal.CrystalSlab-functions">Functions<a href="#src.photonic_crystal.CrystalSlab-functions" class="headerlink" title="Anchor link to this section">&para;</a></h5>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.CrystalSlab.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">geometry</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_bands</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="n">interp</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">pickle_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">use_XY</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">k_point_max</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.CrystalSlab.__init__" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Initializes the CrystalSlab object with the given parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice. It can be 'square' or 'triangular'. Default is 'square'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;square&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>material</code>
            </td>
            <td>
                  <code><span title="crystal_materials.Crystal_Materials">Crystal_Materials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The material object for the photonic crystal. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code><span title="crystal_geometries.CrystalSlab_Geometry">CrystalSlab_Geometry</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geometry of the photonic crystal. Default is None. If it is none, the basic geometry is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_bands</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of bands to calculate. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution</code>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution of the simulation. Default is mp.Vector3(32, 32, 16).</p>
              </div>
            </td>
            <td>
                  <code><span title="meep.Vector3">Vector3</span>(32, 32, 16)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interp</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The interpolation factor for k-points. Default is 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to use in some plotting functions. Default is 3.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pickle_id</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID for pickling the simulation. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_XY</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum k-point value. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1915" name="__codelineno-0-1915"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>            <span class="n">lattice_type</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span><span class="p">,</span>
<a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>            <span class="n">material</span><span class="p">:</span> <span class="n">Crystal_Materials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>            <span class="n">geometry</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>            <span class="n">num_bands</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>            <span class="n">resolution</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span><span class="mi">32</span><span class="p">,</span><span class="mi">16</span><span class="p">),</span>
<a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>            <span class="n">interp</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>            <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span><span class="mi">3</span><span class="p">,</span> 
<a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>            <span class="n">pickle_id</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>            <span class="n">use_XY</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>            <span class="n">k_point_max</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">):</span>
<a id="__codelineno-0-1926" name="__codelineno-0-1926"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1927" name="__codelineno-0-1927"></a><span class="sd">    Initializes the CrystalSlab object with the given parameters.</span>
<a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>
<a id="__codelineno-0-1929" name="__codelineno-0-1929"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1930" name="__codelineno-0-1930"></a><span class="sd">        lattice_type (str): The type of lattice. It can be &#39;square&#39; or &#39;triangular&#39;. Default is &#39;square&#39;.</span>
<a id="__codelineno-0-1931" name="__codelineno-0-1931"></a><span class="sd">        material (Crystal_Materials): The material object for the photonic crystal. Default is None.</span>
<a id="__codelineno-0-1932" name="__codelineno-0-1932"></a><span class="sd">        geometry (CrystalSlab_Geometry): The geometry of the photonic crystal. Default is None. If it is none, the basic geometry is used.</span>
<a id="__codelineno-0-1933" name="__codelineno-0-1933"></a><span class="sd">        num_bands (int): The number of bands to calculate. Default is 4.</span>
<a id="__codelineno-0-1934" name="__codelineno-0-1934"></a><span class="sd">        resolution (mp.Vector3): The resolution of the simulation. Default is mp.Vector3(32, 32, 16).</span>
<a id="__codelineno-0-1935" name="__codelineno-0-1935"></a><span class="sd">        interp (int): The interpolation factor for k-points. Default is 2.</span>
<a id="__codelineno-0-1936" name="__codelineno-0-1936"></a><span class="sd">        periods (int): The number of periods to use in some plotting functions. Default is 3.</span>
<a id="__codelineno-0-1937" name="__codelineno-0-1937"></a><span class="sd">        pickle_id (str): The ID for pickling the simulation. Default is None.</span>
<a id="__codelineno-0-1938" name="__codelineno-0-1938"></a><span class="sd">        use_XY (bool): Whether to use the X and Y directions for the x-axis or high symmetry points. Default is True.</span>
<a id="__codelineno-0-1939" name="__codelineno-0-1939"></a><span class="sd">        k_point_max (float): The maximum k-point value. Default is 0.2.</span>
<a id="__codelineno-0-1940" name="__codelineno-0-1940"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>
<a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>
<a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">,</span> <span class="n">material</span><span class="p">,</span><span class="n">geometry</span><span class="p">,</span> <span class="n">num_bands</span><span class="p">,</span> <span class="n">resolution</span><span class="p">,</span> <span class="n">interp</span><span class="p">,</span> <span class="n">periods</span><span class="p">,</span> <span class="n">pickle_id</span><span class="p">,</span> <span class="n">use_XY</span><span class="p">)</span>
<a id="__codelineno-0-1944" name="__codelineno-0-1944"></a>
<a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>
<a id="__codelineno-0-1946" name="__codelineno-0-1946"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">geometry_lattice</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="p">)</span>
<a id="__codelineno-0-1947" name="__codelineno-0-1947"></a>    <span class="k">if</span> <span class="n">use_XY</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span> 
<a id="__codelineno-0-1948" name="__codelineno-0-1948"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-1949" name="__codelineno-0-1949"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>      <span class="c1"># X</span>
<a id="__codelineno-0-1950" name="__codelineno-0-1950"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="p">,</span><span class="mi">0</span> <span class="p">),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-1951" name="__codelineno-0-1951"></a>            <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">k_point_max</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># Y</span>
<a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>        <span class="p">]</span>
<a id="__codelineno-0-1953" name="__codelineno-0-1953"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">geometry</span> <span class="o">=</span> <span class="n">geometry</span> <span class="k">if</span> <span class="n">geometry</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">basic_geometry</span><span class="p">()</span>
<a id="__codelineno-0-1954" name="__codelineno-0-1954"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">k_points_interpolated</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">interp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">k_points</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.CrystalSlab.plot_epsilon" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_epsilon</span><span class="p">(</span><span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;PuBuGn&#39;</span><span class="p">,</span> <span class="n">override_resolution_with</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.CrystalSlab.plot_epsilon" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the epsilon values obtained from the simulation using Plotly.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Plotly figure to add the epsilon plot to. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>opacity</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The opacity of the plot. Default is 0.3.</p>
              </div>
            </td>
            <td>
                  <code>0.3</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale for the plot. Default is 'PuBuGn'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;PuBuGn&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>override_resolution_with</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The resolution to use for plotting. You can change the resolution just for the plot, but the simulation will still use the value set in the <strong>init</strong> method. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to plot. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="plotly.graph_objects.Figure">Figure</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>go.Figure: The Plotly figure object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1956" name="__codelineno-0-1956"></a><span class="k">def</span> <span class="nf">plot_epsilon</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-1957" name="__codelineno-0-1957"></a>                <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> 
<a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>                <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;PuBuGn&#39;</span><span class="p">,</span> 
<a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>                <span class="n">override_resolution_with</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> 
<a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>                <span class="n">periods</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>                <span class="p">)</span><span class="o">-&gt;</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">:</span>
<a id="__codelineno-0-1963" name="__codelineno-0-1963"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1964" name="__codelineno-0-1964"></a><span class="sd">    Plot the epsilon values obtained from the simulation using Plotly.</span>
<a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>
<a id="__codelineno-0-1966" name="__codelineno-0-1966"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-1967" name="__codelineno-0-1967"></a><span class="sd">        fig (go.Figure, optional): The Plotly figure to add the epsilon plot to. Default is None.</span>
<a id="__codelineno-0-1968" name="__codelineno-0-1968"></a><span class="sd">        opacity (float, optional): The opacity of the plot. Default is 0.3.</span>
<a id="__codelineno-0-1969" name="__codelineno-0-1969"></a><span class="sd">        colorscale (str, optional): The colorscale for the plot. Default is &#39;PuBuGn&#39;.</span>
<a id="__codelineno-0-1970" name="__codelineno-0-1970"></a><span class="sd">        override_resolution_with (int, optional): The resolution to use for plotting. You can change the resolution just for the plot, but the simulation will still use the value set in the __init__ method. Default is None.</span>
<a id="__codelineno-0-1971" name="__codelineno-0-1971"></a><span class="sd">        periods (int, optional): The number of periods to plot. Default is 1.</span>
<a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>
<a id="__codelineno-0-1973" name="__codelineno-0-1973"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-1974" name="__codelineno-0-1974"></a><span class="sd">        go.Figure: The Plotly figure object.</span>
<a id="__codelineno-0-1975" name="__codelineno-0-1975"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>
<a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>
<a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>        <span class="k">if</span> <span class="n">override_resolution_with</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>            <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">resolution</span>
<a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>            <span class="n">resolution</span> <span class="o">=</span> <span class="n">override_resolution_with</span>
<a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
<a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>
<a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>
<a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>        <span class="n">converted_eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
<a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>        <span class="n">converted_eps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span>
<a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span>
<a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>    <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>        <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>
<a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>    <span class="n">z_points</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="n">periods</span>
<a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>    <span class="n">z_mid</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">//</span><span class="mi">2</span>
<a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">converted_eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="o">-</span><span class="n">z_points</span><span class="o">//</span><span class="mi">2</span><span class="p">:</span><span class="n">z_mid</span><span class="o">+</span><span class="n">z_points</span><span class="o">//</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
<a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>    <span class="nb">print</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">epsilon</span><span class="p">,(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> 
<a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>
<a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>    <span class="c1"># Create indices for x, y, z axes (meshgrid)</span>
<a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
<a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>                        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
<a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>                        <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">epsilon</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>
<a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>    <span class="c1"># Flatten the arrays for Plotly</span>
<a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>    <span class="n">x_flat</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>    <span class="n">y_flat</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>    <span class="n">z_flat</span> <span class="o">=</span> <span class="n">z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>    <span class="n">epsilon_flat</span> <span class="o">=</span> <span class="n">epsilon</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>
<a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>    <span class="c1"># Get the minimum and maximum values from the epsilon array (ensure they are floats)</span>
<a id="__codelineno-0-2011" name="__codelineno-0-2011"></a>    <span class="n">isomin_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">epsilon_flat</span><span class="p">))</span>
<a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>    <span class="n">isomax_value</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">epsilon_flat</span><span class="p">))</span>
<a id="__codelineno-0-2013" name="__codelineno-0-2013"></a>
<a id="__codelineno-0-2014" name="__codelineno-0-2014"></a>    <span class="c1"># Create the 3D volume plot using Plotly</span>
<a id="__codelineno-0-2015" name="__codelineno-0-2015"></a>    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">go</span><span class="o">.</span><span class="n">Volume</span><span class="p">(</span>
<a id="__codelineno-0-2016" name="__codelineno-0-2016"></a>        <span class="n">x</span><span class="o">=</span><span class="n">x_flat</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_flat</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z_flat</span><span class="p">,</span>
<a id="__codelineno-0-2017" name="__codelineno-0-2017"></a>        <span class="n">value</span><span class="o">=</span><span class="n">epsilon_flat</span><span class="p">,</span>  <span class="c1"># Use the dielectric function values</span>
<a id="__codelineno-0-2018" name="__codelineno-0-2018"></a>        <span class="n">isomin</span><span class="o">=</span><span class="n">isomin_value</span><span class="p">,</span>
<a id="__codelineno-0-2019" name="__codelineno-0-2019"></a>        <span class="n">isomax</span><span class="o">=</span><span class="n">isomax_value</span><span class="p">,</span>
<a id="__codelineno-0-2020" name="__codelineno-0-2020"></a>        <span class="n">opacity</span><span class="o">=</span><span class="n">opacity</span><span class="p">,</span>  <span class="c1"># Adjust opacity to visualize internal structure</span>
<a id="__codelineno-0-2021" name="__codelineno-0-2021"></a>        <span class="n">surface_count</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>  <span class="c1"># Number of surfaces to display</span>
<a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>        <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span>  <span class="c1"># Color scale for the dielectric function</span>
<a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>        <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Dielectric Constant&#39;</span><span class="p">)</span>
<a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>    <span class="p">))</span>
<a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>
<a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>    <span class="c1"># Add layout details</span>
<a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>        <span class="n">title</span><span class="o">=</span><span class="s1">&#39;3D Volume Plot of Dielectric Function&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>        <span class="n">scene</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>        <span class="n">xaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>        <span class="n">yaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>        <span class="n">zaxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>        <span class="p">)</span>
<a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>    <span class="p">)</span>
<a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>
<a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
<a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>
<a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>    <span class="k">return</span> <span class="n">fig</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.CrystalSlab.basic_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_lattice</span><span class="p">(</span><span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.CrystalSlab.basic_lattice" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the basic lattice structure for the photonic crystal.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lattice_type</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The type of lattice. Default is 'square'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;square&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height_supercell</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the supercell. Default is 4.</p>
              </div>
            </td>
            <td>
                  <code>4</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2041" name="__codelineno-0-2041"></a><span class="k">def</span> <span class="nf">basic_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lattice_type</span><span class="o">=</span><span class="s1">&#39;square&#39;</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-2042" name="__codelineno-0-2042"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2043" name="__codelineno-0-2043"></a><span class="sd">    Define the basic lattice structure for the photonic crystal.</span>
<a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>
<a id="__codelineno-0-2045" name="__codelineno-0-2045"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-2046" name="__codelineno-0-2046"></a><span class="sd">        lattice_type (str): The type of lattice. Default is &#39;square&#39;.</span>
<a id="__codelineno-0-2047" name="__codelineno-0-2047"></a><span class="sd">        height_supercell (int): The height of the supercell. Default is 4.</span>
<a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>
<a id="__codelineno-0-2049" name="__codelineno-0-2049"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-2050" name="__codelineno-0-2050"></a><span class="sd">        tuple: A tuple containing the lattice object representing the lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-2051" name="__codelineno-0-2051"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>
<a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>    <span class="k">if</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;square&#39;</span><span class="p">:</span>
<a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">square_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="n">height_supercell</span><span class="p">)</span>
<a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>    <span class="k">elif</span> <span class="n">lattice_type</span> <span class="o">==</span> <span class="s1">&#39;triangular&#39;</span><span class="p">:</span>
<a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangular_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="n">height_supercell</span><span class="p">)</span>
<a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid lattice type. Choose &#39;square&#39; or &#39;triangular&#39;.&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.CrystalSlab.square_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">square_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.CrystalSlab.square_lattice" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the square lattice for the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2061" name="__codelineno-0-2061"></a><span class="k">def</span> <span class="nf">square_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-2062" name="__codelineno-0-2062"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2063" name="__codelineno-0-2063"></a><span class="sd">    Define the square lattice for the photonic crystal.</span>
<a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>
<a id="__codelineno-0-2065" name="__codelineno-0-2065"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-2066" name="__codelineno-0-2066"></a><span class="sd">        tuple: A tuple containing the lattice object representing the square lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-2067" name="__codelineno-0-2067"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>    <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
<a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>                      <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>                      <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>    <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># M</span>
<a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span>       <span class="c1"># X</span>
<a id="__codelineno-0-2075" name="__codelineno-0-2075"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>    <span class="p">]</span>
<a id="__codelineno-0-2077" name="__codelineno-0-2077"></a>    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.CrystalSlab.triangular_lattice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">triangular_lattice</span><span class="p">(</span><span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.CrystalSlab.triangular_lattice" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the triangular lattice for the photonic crystal.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2080" name="__codelineno-0-2080"></a><span class="k">def</span> <span class="nf">triangular_lattice</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">height_supercell</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-2081" name="__codelineno-0-2081"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2082" name="__codelineno-0-2082"></a><span class="sd">    Define the triangular lattice for the photonic crystal.</span>
<a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>
<a id="__codelineno-0-2084" name="__codelineno-0-2084"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-2085" name="__codelineno-0-2085"></a><span class="sd">        tuple: A tuple containing the lattice object representing the triangular lattice and a list of k-points for the simulation.</span>
<a id="__codelineno-0-2086" name="__codelineno-0-2086"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2087" name="__codelineno-0-2087"></a>    <span class="n">lattice</span> <span class="o">=</span> <span class="n">mp</span><span class="o">.</span><span class="n">Lattice</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">height_supercell</span><span class="p">),</span>
<a id="__codelineno-0-2088" name="__codelineno-0-2088"></a>                      <span class="n">basis1</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
<a id="__codelineno-0-2089" name="__codelineno-0-2089"></a>                      <span class="n">basis2</span><span class="o">=</span><span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">))</span>
<a id="__codelineno-0-2090" name="__codelineno-0-2090"></a>    <span class="n">k_points</span> <span class="o">=</span> <span class="p">[</span>
<a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.5</span><span class="p">),</span>          <span class="c1"># K</span>
<a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(</span><span class="o">-</span><span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">,</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span>    <span class="c1"># M</span>
<a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>        <span class="n">mp</span><span class="o">.</span><span class="n">Vector3</span><span class="p">(),</span>               <span class="c1"># Gamma</span>
<a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>    <span class="p">]</span>
<a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>    <span class="k">return</span> <span class="n">lattice</span><span class="p">,</span> <span class="n">k_points</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.CrystalSlab.basic_geometry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">basic_geometry</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">material</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#src.photonic_crystal.CrystalSlab.basic_geometry" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Define the basic geometry for the photonic crystal slab.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>radius</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The radius of the cylinder. Default is 0.2.</p>
              </div>
            </td>
            <td>
                  <code>0.2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>material</code>
            </td>
            <td>
                  <code><span title="crystal_materials.Crystal_Materials">Crystal_Materials</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The material object for the photonic crystal. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>CrystalSlab_Geometry</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geometry object representing the photonic crystal slab.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2098" name="__codelineno-0-2098"></a><span class="nd">@staticmethod</span> 
<a id="__codelineno-0-2099" name="__codelineno-0-2099"></a><span class="k">def</span> <span class="nf">basic_geometry</span><span class="p">(</span>
<a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>    <span class="n">radius</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span>
<a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>    <span class="n">material</span><span class="p">:</span> <span class="n">Crystal_Materials</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2102" name="__codelineno-0-2102"></a><span class="p">):</span>
<a id="__codelineno-0-2103" name="__codelineno-0-2103"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2104" name="__codelineno-0-2104"></a><span class="sd">    Define the basic geometry for the photonic crystal slab.</span>
<a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>
<a id="__codelineno-0-2106" name="__codelineno-0-2106"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-2107" name="__codelineno-0-2107"></a><span class="sd">        radius (float): The radius of the cylinder. Default is 0.2.</span>
<a id="__codelineno-0-2108" name="__codelineno-0-2108"></a><span class="sd">        material (Crystal_Materials): The material object for the photonic crystal. Default is None.</span>
<a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>
<a id="__codelineno-0-2110" name="__codelineno-0-2110"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-2111" name="__codelineno-0-2111"></a><span class="sd">        CrystalSlab_Geometry: The geometry object representing the photonic crystal slab.</span>
<a id="__codelineno-0-2112" name="__codelineno-0-2112"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>
<a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>    <span class="k">if</span> <span class="n">material</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>        <span class="n">material</span> <span class="o">=</span> <span class="n">PhotonicCrystal</span><span class="o">.</span><span class="n">basic_material</span><span class="p">()</span>
<a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>    <span class="n">geometry</span> <span class="o">=</span> <span class="n">CrystalSlab_Geometry</span><span class="p">(</span><span class="n">material</span> <span class="o">=</span> <span class="n">material</span><span class="p">,</span> <span class="n">geometry_type</span><span class="o">=</span><span class="s1">&#39;cylinder&#39;</span><span class="p">,</span> <span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span><span class="p">)</span>
<a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>    <span class="k">return</span> <span class="n">geometry</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.CrystalSlab.plot_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.CrystalSlab.plot_field" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the field for a specific mode based on the given parameters.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_frequency</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>component</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The component of the field to plot (0 for x, 1 for y, 2 for z). Default is 2.</p>
              </div>
            </td>
            <td>
                  <code>2</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantity</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The quantity to plot ('real', 'imag', or 'abs'). Default is 'real'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;real&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bloch_phase</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the Bloch phase. Default is True.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale to use for the plot. Default is 'RdBu'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the electric field figure and the magnetic field figure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2122" name="__codelineno-0-2122"></a><span class="k">def</span> <span class="nf">plot_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> 
<a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>        <span class="n">target_polarization</span><span class="p">,</span> 
<a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>        <span class="n">target_k_point</span><span class="p">,</span> 
<a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>        <span class="n">target_frequency</span><span class="p">,</span> 
<a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>        <span class="n">frequency_tolerance</span> <span class="o">=</span> <span class="mf">0.01</span><span class="p">,</span> 
<a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>        <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>        <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> 
<a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>        <span class="n">component</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span> 
<a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>        <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>        <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span> 
<a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>        <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>                  
<a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>        <span class="p">):</span>
<a id="__codelineno-0-2134" name="__codelineno-0-2134"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2135" name="__codelineno-0-2135"></a><span class="sd">    Plot the field for a specific mode based on the given parameters.</span>
<a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>
<a id="__codelineno-0-2137" name="__codelineno-0-2137"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-2138" name="__codelineno-0-2138"></a><span class="sd">        target_polarization (str): The polarization of the target mode.</span>
<a id="__codelineno-0-2139" name="__codelineno-0-2139"></a><span class="sd">        target_k_point (tuple): The k-point of the target mode.</span>
<a id="__codelineno-0-2140" name="__codelineno-0-2140"></a><span class="sd">        target_frequency (float): The frequency of the target mode.</span>
<a id="__codelineno-0-2141" name="__codelineno-0-2141"></a><span class="sd">        frequency_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-2142" name="__codelineno-0-2142"></a><span class="sd">        periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-2143" name="__codelineno-0-2143"></a><span class="sd">        component (int): The component of the field to plot (0 for x, 1 for y, 2 for z). Default is 2.</span>
<a id="__codelineno-0-2144" name="__codelineno-0-2144"></a><span class="sd">        quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<a id="__codelineno-0-2145" name="__codelineno-0-2145"></a><span class="sd">        bloch_phase (bool): Whether to include the Bloch phase. Default is True.</span>
<a id="__codelineno-0-2146" name="__codelineno-0-2146"></a><span class="sd">        colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>
<a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>
<a id="__codelineno-0-2148" name="__codelineno-0-2148"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-2149" name="__codelineno-0-2149"></a><span class="sd">        tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<a id="__codelineno-0-2150" name="__codelineno-0-2150"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2151" name="__codelineno-0-2151"></a>    <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">freq_tolerance</span> <span class="o">=</span> <span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span> <span class="o">=</span> <span class="n">k_point_max_distance</span><span class="p">)</span>
<a id="__codelineno-0-2152" name="__codelineno-0-2152"></a>    <span class="c1">#print(len(target_modes))</span>
<a id="__codelineno-0-2153" name="__codelineno-0-2153"></a>
<a id="__codelineno-0-2154" name="__codelineno-0-2154"></a>    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2155" name="__codelineno-0-2155"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-2156" name="__codelineno-0-2156"></a>        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-2157" name="__codelineno-0-2157"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span> 
<a id="__codelineno-0-2158" name="__codelineno-0-2158"></a>
<a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>    <span class="n">z_points</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">periods</span>
<a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>    <span class="n">z_mid</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>
<a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>    <span class="c1"># Now take only epsilon in the center of the slab</span>
<a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>    <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="p">]</span>
<a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>    <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
<a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>    <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>    <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>
<a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>
<a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>    <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>    <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2172" name="__codelineno-0-2172"></a>
<a id="__codelineno-0-2173" name="__codelineno-0-2173"></a>    <span class="n">num_plots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span>
<a id="__codelineno-0-2174" name="__codelineno-0-2174"></a>
<a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-2176" name="__codelineno-0-2176"></a>        <span class="c1"># Initialize visibility status: False for all traces</span>
<a id="__codelineno-0-2177" name="__codelineno-0-2177"></a>        <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>  <span class="c1"># Each mode adds two traces</span>
<a id="__codelineno-0-2178" name="__codelineno-0-2178"></a>        <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">num_plots</span><span class="p">)</span>
<a id="__codelineno-0-2179" name="__codelineno-0-2179"></a>
<a id="__codelineno-0-2180" name="__codelineno-0-2180"></a>        <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the contour plot visible</span>
<a id="__codelineno-0-2181" name="__codelineno-0-2181"></a>        <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>        <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
<a id="__codelineno-0-2183" name="__codelineno-0-2183"></a>        <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Set the heatmap visible</span>
<a id="__codelineno-0-2184" name="__codelineno-0-2184"></a>
<a id="__codelineno-0-2185" name="__codelineno-0-2185"></a>        <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2186" name="__codelineno-0-2186"></a>        <span class="n">freq</span>    <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2187" name="__codelineno-0-2187"></a>        <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2188" name="__codelineno-0-2188"></a>
<a id="__codelineno-0-2189" name="__codelineno-0-2189"></a>        <span class="c1"># Take the specified component of the fields in the center of the slab</span>
<a id="__codelineno-0-2190" name="__codelineno-0-2190"></a>        <span class="k">if</span> <span class="n">bloch_phase</span><span class="p">:</span>
<a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span> <span class="p">)</span>
<a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span>  <span class="n">kpoint</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>        <span class="n">e_field</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
<a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>        <span class="n">h_field</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="n">component</span><span class="p">]</span>
<a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span> 
<a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>
<a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>
<a id="__codelineno-0-2214" name="__codelineno-0-2214"></a>        <span class="c1"># Add the contour plot for permittivity (eps) at the midpoint</span>
<a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>        <span class="n">contour_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span>
<a id="__codelineno-0-2216" name="__codelineno-0-2216"></a>                            <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2217" name="__codelineno-0-2217"></a>                                <span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>  <span class="c1"># Start and end at the midpoint to ensure a single level</span>
<a id="__codelineno-0-2218" name="__codelineno-0-2218"></a>                                <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span>
<a id="__codelineno-0-2219" name="__codelineno-0-2219"></a>                                <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>  <span class="c1"># A small size to keep it as a single contour</span>
<a id="__codelineno-0-2220" name="__codelineno-0-2220"></a>                                <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span>  <span class="c1"># No filling</span>
<a id="__codelineno-0-2221" name="__codelineno-0-2221"></a>                            <span class="p">),</span>
<a id="__codelineno-0-2222" name="__codelineno-0-2222"></a>                            <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span>
<a id="__codelineno-0-2223" name="__codelineno-0-2223"></a>                            <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2224" name="__codelineno-0-2224"></a>                            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
<a id="__codelineno-0-2225" name="__codelineno-0-2225"></a>                            <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span>  <span class="mi">0</span>  <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>  <span class="c1"># Only the first mode is visible</span>
<a id="__codelineno-0-2226" name="__codelineno-0-2226"></a>        <span class="n">contour_h</span> <span class="o">=</span> <span class="n">contour_e</span>  <span class="c1"># Same contour for H-field figure</span>
<a id="__codelineno-0-2227" name="__codelineno-0-2227"></a>
<a id="__codelineno-0-2228" name="__codelineno-0-2228"></a>        <span class="c1"># Add the contour trace</span>
<a id="__codelineno-0-2229" name="__codelineno-0-2229"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_e</span><span class="p">)</span>
<a id="__codelineno-0-2230" name="__codelineno-0-2230"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">contour_h</span><span class="p">)</span>
<a id="__codelineno-0-2231" name="__codelineno-0-2231"></a>
<a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>        <span class="c1"># Add the heatmap for the electric field</span>
<a id="__codelineno-0-2233" name="__codelineno-0-2233"></a>        <span class="n">heatmap_e</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">e_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-2234" name="__codelineno-0-2234"></a>                                <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2235" name="__codelineno-0-2235"></a>        <span class="c1"># Add the heatmap for the magnetic field</span>
<a id="__codelineno-0-2236" name="__codelineno-0-2236"></a>        <span class="n">heatmap_h</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">h_field</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-0-2237" name="__codelineno-0-2237"></a>                                <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2238" name="__codelineno-0-2238"></a>
<a id="__codelineno-0-2239" name="__codelineno-0-2239"></a>        <span class="c1"># Add the heatmap trace</span>
<a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_e</span><span class="p">)</span>
<a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">heatmap_h</span><span class="p">)</span>
<a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>
<a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>
<a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>
<a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>        <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>        <span class="k">if</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
<a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;x-component&quot;</span>
<a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>        <span class="k">elif</span> <span class="n">component</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;y-component&quot;</span>
<a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>            <span class="n">component_str</span> <span class="o">=</span> <span class="s2">&quot;z-component&quot;</span>
<a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>        <span class="n">subtitle_e</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>        <span class="n">subtitle_h</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;H-field, </span><span class="si">{</span><span class="n">component_str</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>        <span class="c1"># Create a button for each field dataset for the dropdown</span>
<a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>        <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>                                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>                                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
<a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>                                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>                                    <span class="p">]))</span>
<a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>        <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>                                    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>                                    <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>  <span class="c1"># Update visibility for both eps and field</span>
<a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>                                        <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
<a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>                                    <span class="p">]))</span>
<a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>
<a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>    <span class="c1"># print(len(target_modes))</span>
<a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>    <span class="n">k_point</span> <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>    <span class="n">freq</span>    <span class="o">=</span> <span class="n">target_modes</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>    <span class="n">data_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="mi">0</span><span class="si">}</span><span class="s2"> &lt;br&gt; k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>
<a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>                        <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">,</span>
<a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>                        <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
<a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>                        <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
<a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>
<a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>    <span class="p">)</span>
<a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>
<a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">active</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>                        <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">,</span>
<a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>                        <span class="n">x</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.15</span><span class="p">,</span>
<a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>                        <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">yanchor</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">)],</span>
<a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">data_str</span><span class="si">}</span><span class="s2">:&lt;br&gt; </span><span class="si">{</span><span class="n">subtitle_h</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>        <span class="n">xaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_visible</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>        <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span>
<a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>        <span class="n">xaxis_title</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>        <span class="n">yaxis_title</span><span class="o">=</span><span class="s2">&quot;Y&quot;</span>
<a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>    <span class="p">)</span>
<a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>
<a id="__codelineno-0-2302" name="__codelineno-0-2302"></a>    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h6 id="src.photonic_crystal.CrystalSlab.plot_field_components" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_field_components</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span> <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">quantity</span><span class="o">=</span><span class="s1">&#39;real&#39;</span><span class="p">,</span> <span class="n">bloch_phase</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="s1">&#39;RdBu&#39;</span><span class="p">)</span></code>

<a href="#src.photonic_crystal.CrystalSlab.plot_field_components" class="headerlink" title="Anchor link to this section">&para;</a></h6>


    <div class="doc doc-contents ">

        <p>Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>target_polarization</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The polarization of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_k_point</code>
            </td>
            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The k-point of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_frequency</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The frequency of the target mode.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>frequency_tolerance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tolerance for frequency similarity.</p>
              </div>
            </td>
            <td>
                  <code>0.01</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>k_point_max_distance</code>
            </td>
            <td>
                  <code>float</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum distance for k-point similarity. Default is None.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>periods</code>
            </td>
            <td>
                  <code>int</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of periods to extract. Default is 1.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>quantity</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The quantity to plot ('real', 'imag', or 'abs'). Default is 'real'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;real&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bloch_phase</code>
            </td>
            <td>
                  <code>bool</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to include the Bloch</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colorscale</code>
            </td>
            <td>
                  <code>str</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The colorscale to use for the plot. Default is 'RdBu'.</p>
              </div>
            </td>
            <td>
                  <code>&#39;RdBu&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tuple</code></td>            <td>
                  <code>tuple</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A tuple containing the electric field figure and the magnetic field figure.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>

            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span>
<span class="normal"><a href="#__codelineno-0-2337">2337</a></span>
<span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span>
<span class="normal"><a href="#__codelineno-0-2369">2369</a></span>
<span class="normal"><a href="#__codelineno-0-2370">2370</a></span>
<span class="normal"><a href="#__codelineno-0-2371">2371</a></span>
<span class="normal"><a href="#__codelineno-0-2372">2372</a></span>
<span class="normal"><a href="#__codelineno-0-2373">2373</a></span>
<span class="normal"><a href="#__codelineno-0-2374">2374</a></span>
<span class="normal"><a href="#__codelineno-0-2375">2375</a></span>
<span class="normal"><a href="#__codelineno-0-2376">2376</a></span>
<span class="normal"><a href="#__codelineno-0-2377">2377</a></span>
<span class="normal"><a href="#__codelineno-0-2378">2378</a></span>
<span class="normal"><a href="#__codelineno-0-2379">2379</a></span>
<span class="normal"><a href="#__codelineno-0-2380">2380</a></span>
<span class="normal"><a href="#__codelineno-0-2381">2381</a></span>
<span class="normal"><a href="#__codelineno-0-2382">2382</a></span>
<span class="normal"><a href="#__codelineno-0-2383">2383</a></span>
<span class="normal"><a href="#__codelineno-0-2384">2384</a></span>
<span class="normal"><a href="#__codelineno-0-2385">2385</a></span>
<span class="normal"><a href="#__codelineno-0-2386">2386</a></span>
<span class="normal"><a href="#__codelineno-0-2387">2387</a></span>
<span class="normal"><a href="#__codelineno-0-2388">2388</a></span>
<span class="normal"><a href="#__codelineno-0-2389">2389</a></span>
<span class="normal"><a href="#__codelineno-0-2390">2390</a></span>
<span class="normal"><a href="#__codelineno-0-2391">2391</a></span>
<span class="normal"><a href="#__codelineno-0-2392">2392</a></span>
<span class="normal"><a href="#__codelineno-0-2393">2393</a></span>
<span class="normal"><a href="#__codelineno-0-2394">2394</a></span>
<span class="normal"><a href="#__codelineno-0-2395">2395</a></span>
<span class="normal"><a href="#__codelineno-0-2396">2396</a></span>
<span class="normal"><a href="#__codelineno-0-2397">2397</a></span>
<span class="normal"><a href="#__codelineno-0-2398">2398</a></span>
<span class="normal"><a href="#__codelineno-0-2399">2399</a></span>
<span class="normal"><a href="#__codelineno-0-2400">2400</a></span>
<span class="normal"><a href="#__codelineno-0-2401">2401</a></span>
<span class="normal"><a href="#__codelineno-0-2402">2402</a></span>
<span class="normal"><a href="#__codelineno-0-2403">2403</a></span>
<span class="normal"><a href="#__codelineno-0-2404">2404</a></span>
<span class="normal"><a href="#__codelineno-0-2405">2405</a></span>
<span class="normal"><a href="#__codelineno-0-2406">2406</a></span>
<span class="normal"><a href="#__codelineno-0-2407">2407</a></span>
<span class="normal"><a href="#__codelineno-0-2408">2408</a></span>
<span class="normal"><a href="#__codelineno-0-2409">2409</a></span>
<span class="normal"><a href="#__codelineno-0-2410">2410</a></span>
<span class="normal"><a href="#__codelineno-0-2411">2411</a></span>
<span class="normal"><a href="#__codelineno-0-2412">2412</a></span>
<span class="normal"><a href="#__codelineno-0-2413">2413</a></span>
<span class="normal"><a href="#__codelineno-0-2414">2414</a></span>
<span class="normal"><a href="#__codelineno-0-2415">2415</a></span>
<span class="normal"><a href="#__codelineno-0-2416">2416</a></span>
<span class="normal"><a href="#__codelineno-0-2417">2417</a></span>
<span class="normal"><a href="#__codelineno-0-2418">2418</a></span>
<span class="normal"><a href="#__codelineno-0-2419">2419</a></span>
<span class="normal"><a href="#__codelineno-0-2420">2420</a></span>
<span class="normal"><a href="#__codelineno-0-2421">2421</a></span>
<span class="normal"><a href="#__codelineno-0-2422">2422</a></span>
<span class="normal"><a href="#__codelineno-0-2423">2423</a></span>
<span class="normal"><a href="#__codelineno-0-2424">2424</a></span>
<span class="normal"><a href="#__codelineno-0-2425">2425</a></span>
<span class="normal"><a href="#__codelineno-0-2426">2426</a></span>
<span class="normal"><a href="#__codelineno-0-2427">2427</a></span>
<span class="normal"><a href="#__codelineno-0-2428">2428</a></span>
<span class="normal"><a href="#__codelineno-0-2429">2429</a></span>
<span class="normal"><a href="#__codelineno-0-2430">2430</a></span>
<span class="normal"><a href="#__codelineno-0-2431">2431</a></span>
<span class="normal"><a href="#__codelineno-0-2432">2432</a></span>
<span class="normal"><a href="#__codelineno-0-2433">2433</a></span>
<span class="normal"><a href="#__codelineno-0-2434">2434</a></span>
<span class="normal"><a href="#__codelineno-0-2435">2435</a></span>
<span class="normal"><a href="#__codelineno-0-2436">2436</a></span>
<span class="normal"><a href="#__codelineno-0-2437">2437</a></span>
<span class="normal"><a href="#__codelineno-0-2438">2438</a></span>
<span class="normal"><a href="#__codelineno-0-2439">2439</a></span>
<span class="normal"><a href="#__codelineno-0-2440">2440</a></span>
<span class="normal"><a href="#__codelineno-0-2441">2441</a></span>
<span class="normal"><a href="#__codelineno-0-2442">2442</a></span>
<span class="normal"><a href="#__codelineno-0-2443">2443</a></span>
<span class="normal"><a href="#__codelineno-0-2444">2444</a></span>
<span class="normal"><a href="#__codelineno-0-2445">2445</a></span>
<span class="normal"><a href="#__codelineno-0-2446">2446</a></span>
<span class="normal"><a href="#__codelineno-0-2447">2447</a></span>
<span class="normal"><a href="#__codelineno-0-2448">2448</a></span>
<span class="normal"><a href="#__codelineno-0-2449">2449</a></span>
<span class="normal"><a href="#__codelineno-0-2450">2450</a></span>
<span class="normal"><a href="#__codelineno-0-2451">2451</a></span>
<span class="normal"><a href="#__codelineno-0-2452">2452</a></span>
<span class="normal"><a href="#__codelineno-0-2453">2453</a></span>
<span class="normal"><a href="#__codelineno-0-2454">2454</a></span>
<span class="normal"><a href="#__codelineno-0-2455">2455</a></span>
<span class="normal"><a href="#__codelineno-0-2456">2456</a></span>
<span class="normal"><a href="#__codelineno-0-2457">2457</a></span>
<span class="normal"><a href="#__codelineno-0-2458">2458</a></span>
<span class="normal"><a href="#__codelineno-0-2459">2459</a></span>
<span class="normal"><a href="#__codelineno-0-2460">2460</a></span>
<span class="normal"><a href="#__codelineno-0-2461">2461</a></span>
<span class="normal"><a href="#__codelineno-0-2462">2462</a></span>
<span class="normal"><a href="#__codelineno-0-2463">2463</a></span>
<span class="normal"><a href="#__codelineno-0-2464">2464</a></span>
<span class="normal"><a href="#__codelineno-0-2465">2465</a></span>
<span class="normal"><a href="#__codelineno-0-2466">2466</a></span>
<span class="normal"><a href="#__codelineno-0-2467">2467</a></span>
<span class="normal"><a href="#__codelineno-0-2468">2468</a></span>
<span class="normal"><a href="#__codelineno-0-2469">2469</a></span>
<span class="normal"><a href="#__codelineno-0-2470">2470</a></span>
<span class="normal"><a href="#__codelineno-0-2471">2471</a></span>
<span class="normal"><a href="#__codelineno-0-2472">2472</a></span>
<span class="normal"><a href="#__codelineno-0-2473">2473</a></span>
<span class="normal"><a href="#__codelineno-0-2474">2474</a></span>
<span class="normal"><a href="#__codelineno-0-2475">2475</a></span>
<span class="normal"><a href="#__codelineno-0-2476">2476</a></span>
<span class="normal"><a href="#__codelineno-0-2477">2477</a></span>
<span class="normal"><a href="#__codelineno-0-2478">2478</a></span>
<span class="normal"><a href="#__codelineno-0-2479">2479</a></span>
<span class="normal"><a href="#__codelineno-0-2480">2480</a></span>
<span class="normal"><a href="#__codelineno-0-2481">2481</a></span>
<span class="normal"><a href="#__codelineno-0-2482">2482</a></span>
<span class="normal"><a href="#__codelineno-0-2483">2483</a></span>
<span class="normal"><a href="#__codelineno-0-2484">2484</a></span>
<span class="normal"><a href="#__codelineno-0-2485">2485</a></span>
<span class="normal"><a href="#__codelineno-0-2486">2486</a></span>
<span class="normal"><a href="#__codelineno-0-2487">2487</a></span>
<span class="normal"><a href="#__codelineno-0-2488">2488</a></span>
<span class="normal"><a href="#__codelineno-0-2489">2489</a></span>
<span class="normal"><a href="#__codelineno-0-2490">2490</a></span>
<span class="normal"><a href="#__codelineno-0-2491">2491</a></span>
<span class="normal"><a href="#__codelineno-0-2492">2492</a></span>
<span class="normal"><a href="#__codelineno-0-2493">2493</a></span>
<span class="normal"><a href="#__codelineno-0-2494">2494</a></span>
<span class="normal"><a href="#__codelineno-0-2495">2495</a></span>
<span class="normal"><a href="#__codelineno-0-2496">2496</a></span>
<span class="normal"><a href="#__codelineno-0-2497">2497</a></span>
<span class="normal"><a href="#__codelineno-0-2498">2498</a></span>
<span class="normal"><a href="#__codelineno-0-2499">2499</a></span>
<span class="normal"><a href="#__codelineno-0-2500">2500</a></span>
<span class="normal"><a href="#__codelineno-0-2501">2501</a></span>
<span class="normal"><a href="#__codelineno-0-2502">2502</a></span>
<span class="normal"><a href="#__codelineno-0-2503">2503</a></span>
<span class="normal"><a href="#__codelineno-0-2504">2504</a></span>
<span class="normal"><a href="#__codelineno-0-2505">2505</a></span>
<span class="normal"><a href="#__codelineno-0-2506">2506</a></span>
<span class="normal"><a href="#__codelineno-0-2507">2507</a></span>
<span class="normal"><a href="#__codelineno-0-2508">2508</a></span>
<span class="normal"><a href="#__codelineno-0-2509">2509</a></span>
<span class="normal"><a href="#__codelineno-0-2510">2510</a></span>
<span class="normal"><a href="#__codelineno-0-2511">2511</a></span>
<span class="normal"><a href="#__codelineno-0-2512">2512</a></span>
<span class="normal"><a href="#__codelineno-0-2513">2513</a></span>
<span class="normal"><a href="#__codelineno-0-2514">2514</a></span>
<span class="normal"><a href="#__codelineno-0-2515">2515</a></span>
<span class="normal"><a href="#__codelineno-0-2516">2516</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-2306" name="__codelineno-0-2306"></a><span class="k">def</span> <span class="nf">plot_field_components</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-2307" name="__codelineno-0-2307"></a>                        <span class="n">target_polarization</span><span class="p">,</span>
<a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>                        <span class="n">target_k_point</span><span class="p">,</span>
<a id="__codelineno-0-2309" name="__codelineno-0-2309"></a>                        <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>                        <span class="n">frequency_tolerance</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
<a id="__codelineno-0-2311" name="__codelineno-0-2311"></a>                        <span class="n">k_point_max_distance</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-2312" name="__codelineno-0-2312"></a>                        <span class="n">periods</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-2313" name="__codelineno-0-2313"></a>                        <span class="n">quantity</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;real&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2314" name="__codelineno-0-2314"></a>                        <span class="n">bloch_phase</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-2315" name="__codelineno-0-2315"></a>                        <span class="n">colorscale</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;RdBu&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2316" name="__codelineno-0-2316"></a>                        <span class="p">)</span><span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">:</span>
<a id="__codelineno-0-2317" name="__codelineno-0-2317"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-2318" name="__codelineno-0-2318"></a><span class="sd">    Plot the field components (Ex, Ey, Ez) and (Hx, Hy, Hz) for specific modes with consistent color scales.</span>
<a id="__codelineno-0-2319" name="__codelineno-0-2319"></a>
<a id="__codelineno-0-2320" name="__codelineno-0-2320"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-2321" name="__codelineno-0-2321"></a><span class="sd">        target_polarization (str): The polarization of the target mode.</span>
<a id="__codelineno-0-2322" name="__codelineno-0-2322"></a><span class="sd">        target_k_point (tuple): The k-point of the target mode.</span>
<a id="__codelineno-0-2323" name="__codelineno-0-2323"></a><span class="sd">        target_frequency (float): The frequency of the target mode.</span>
<a id="__codelineno-0-2324" name="__codelineno-0-2324"></a><span class="sd">        frequency_tolerance (float): The tolerance for frequency similarity.</span>
<a id="__codelineno-0-2325" name="__codelineno-0-2325"></a><span class="sd">        k_point_max_distance (float, optional): The maximum distance for k-point similarity. Default is None.</span>
<a id="__codelineno-0-2326" name="__codelineno-0-2326"></a><span class="sd">        periods (int): The number of periods to extract. Default is 1.</span>
<a id="__codelineno-0-2327" name="__codelineno-0-2327"></a><span class="sd">        quantity (str): The quantity to plot (&#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;). Default is &#39;real&#39;.</span>
<a id="__codelineno-0-2328" name="__codelineno-0-2328"></a><span class="sd">        bloch_phase (bool): Whether to include the Bloch</span>
<a id="__codelineno-0-2329" name="__codelineno-0-2329"></a><span class="sd">        colorscale (str): The colorscale to use for the plot. Default is &#39;RdBu&#39;.</span>
<a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>
<a id="__codelineno-0-2331" name="__codelineno-0-2331"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-2332" name="__codelineno-0-2332"></a><span class="sd">        tuple: A tuple containing the electric field figure and the magnetic field figure.</span>
<a id="__codelineno-0-2333" name="__codelineno-0-2333"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>
<a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>    <span class="n">target_modes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">look_for_mode</span><span class="p">(</span><span class="n">target_polarization</span><span class="p">,</span> <span class="n">target_k_point</span><span class="p">,</span> <span class="n">target_frequency</span><span class="p">,</span>
<a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>                                    <span class="n">freq_tolerance</span><span class="o">=</span><span class="n">frequency_tolerance</span><span class="p">,</span> <span class="n">k_point_max_distance</span><span class="o">=</span><span class="n">k_point_max_distance</span><span class="p">)</span>
<a id="__codelineno-0-2337" name="__codelineno-0-2337"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of target modes found: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2338" name="__codelineno-0-2338"></a>
<a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>    <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2340" name="__codelineno-0-2340"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">run_dumb_simulation</span><span class="p">()</span>
<a id="__codelineno-0-2341" name="__codelineno-0-2341"></a>        <span class="n">md</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBData</span><span class="p">(</span><span class="n">rectify</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="n">periods</span><span class="p">,</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">())</span>
<a id="__codelineno-0-2342" name="__codelineno-0-2342"></a>        <span class="n">eps</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_epsilon</span><span class="p">())</span>
<a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>
<a id="__codelineno-0-2344" name="__codelineno-0-2344"></a>    <span class="n">z_points</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="n">periods</span>
<a id="__codelineno-0-2345" name="__codelineno-0-2345"></a>    <span class="n">z_mid</span> <span class="o">=</span> <span class="n">eps</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">//</span> <span class="mi">2</span>
<a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>
<a id="__codelineno-0-2347" name="__codelineno-0-2347"></a>    <span class="c1"># Now take only epsilon in the center of the slab</span>
<a id="__codelineno-0-2348" name="__codelineno-0-2348"></a>    <span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_mid</span><span class="p">]</span>
<a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>    <span class="c1"># Calculate the midpoint between min and max of the permittivity (eps)</span>
<a id="__codelineno-0-2350" name="__codelineno-0-2350"></a>    <span class="n">min_eps</span><span class="p">,</span> <span class="n">max_eps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">eps</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span>
<a id="__codelineno-0-2351" name="__codelineno-0-2351"></a>    <span class="n">midpoint</span> <span class="o">=</span> <span class="p">(</span><span class="n">min_eps</span> <span class="o">+</span> <span class="n">max_eps</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># The level to be plotted</span>
<a id="__codelineno-0-2352" name="__codelineno-0-2352"></a>
<a id="__codelineno-0-2353" name="__codelineno-0-2353"></a>    <span class="n">fig_e</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Ex&quot;</span><span class="p">,</span> <span class="s2">&quot;Ey&quot;</span><span class="p">,</span> <span class="s2">&quot;Ez&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2354" name="__codelineno-0-2354"></a>    <span class="n">fig_h</span> <span class="o">=</span> <span class="n">make_subplots</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">cols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">subplot_titles</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;Hx&quot;</span><span class="p">,</span> <span class="s2">&quot;Hy&quot;</span><span class="p">,</span> <span class="s2">&quot;Hz&quot;</span><span class="p">))</span>
<a id="__codelineno-0-2355" name="__codelineno-0-2355"></a>    <span class="n">dropdown_buttons_e</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>    <span class="n">dropdown_buttons_h</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>
<a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>    <span class="c1"># For each mode, calculate separate min and max values for Ex, Ey, Ez (and similarly Hx, Hy, Hz)</span>
<a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">mode</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">target_modes</span><span class="p">):</span>
<a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>        <span class="c1"># Get field arrays for this mode</span>
<a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>        <span class="k">if</span> <span class="n">bloch_phase</span><span class="p">:</span>
<a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>            <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>            <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>            <span class="n">e_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;e_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>            <span class="n">h_field_array</span> <span class="o">=</span> <span class="n">mpb</span><span class="o">.</span><span class="n">MPBArray</span><span class="p">(</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;h_field_periodic&quot;</span><span class="p">],</span> <span class="n">lattice</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ms</span><span class="o">.</span><span class="n">get_lattice</span><span class="p">(),</span> <span class="n">kpoint</span><span class="o">=</span><span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">])</span>
<a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>
<a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>        <span class="c1"># Extract field components in the center of the slab</span>
<a id="__codelineno-0-2369" name="__codelineno-0-2369"></a>        <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2370" name="__codelineno-0-2370"></a>        <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2371" name="__codelineno-0-2371"></a>        <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">e_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2372" name="__codelineno-0-2372"></a>        <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2373" name="__codelineno-0-2373"></a>        <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2374" name="__codelineno-0-2374"></a>        <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">h_field_array</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">z_points</span> <span class="o">//</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>  <span class="c1"># Shape (Nx, Ny)</span>
<a id="__codelineno-0-2375" name="__codelineno-0-2375"></a>
<a id="__codelineno-0-2376" name="__codelineno-0-2376"></a>        <span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2377" name="__codelineno-0-2377"></a>            <span class="n">e_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_x</span><span class="p">)</span>
<a id="__codelineno-0-2378" name="__codelineno-0-2378"></a>            <span class="n">e_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_y</span><span class="p">)</span>
<a id="__codelineno-0-2379" name="__codelineno-0-2379"></a>            <span class="n">e_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">e_field_z</span><span class="p">)</span>
<a id="__codelineno-0-2380" name="__codelineno-0-2380"></a>            <span class="n">h_field_x</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_x</span><span class="p">)</span>
<a id="__codelineno-0-2381" name="__codelineno-0-2381"></a>            <span class="n">h_field_y</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_y</span><span class="p">)</span>
<a id="__codelineno-0-2382" name="__codelineno-0-2382"></a>            <span class="n">h_field_z</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="n">h_field_z</span><span class="p">)</span>
<a id="__codelineno-0-2383" name="__codelineno-0-2383"></a>
<a id="__codelineno-0-2384" name="__codelineno-0-2384"></a>        <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">e_field_x</span><span class="p">,</span> <span class="n">e_field_y</span><span class="p">,</span> <span class="n">e_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2385" name="__codelineno-0-2385"></a>        <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">h_field_x</span><span class="p">,</span> <span class="n">h_field_y</span><span class="p">,</span> <span class="n">h_field_z</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>                                    
<a id="__codelineno-0-2386" name="__codelineno-0-2386"></a>
<a id="__codelineno-0-2387" name="__codelineno-0-2387"></a>        <span class="c1"># Select quantity to display (real, imag, abs)</span>
<a id="__codelineno-0-2388" name="__codelineno-0-2388"></a>        <span class="k">if</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;real&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2389" name="__codelineno-0-2389"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2390" name="__codelineno-0-2390"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2391" name="__codelineno-0-2391"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;imag&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2392" name="__codelineno-0-2392"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2393" name="__codelineno-0-2393"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2394" name="__codelineno-0-2394"></a>        <span class="k">elif</span> <span class="n">quantity</span> <span class="o">==</span> <span class="s2">&quot;abs&quot;</span><span class="p">:</span>
<a id="__codelineno-0-2395" name="__codelineno-0-2395"></a>            <span class="n">e_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2396" name="__codelineno-0-2396"></a>            <span class="n">h_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2397" name="__codelineno-0-2397"></a>        <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-2398" name="__codelineno-0-2398"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid quantity. Choose &#39;real&#39;, &#39;imag&#39;, or &#39;abs&#39;.&quot;</span><span class="p">)</span>
<a id="__codelineno-0-2399" name="__codelineno-0-2399"></a>
<a id="__codelineno-0-2400" name="__codelineno-0-2400"></a>        <span class="c1"># Calculate the component-specific min/max for E and H fields of this mode</span>
<a id="__codelineno-0-2401" name="__codelineno-0-2401"></a>        <span class="n">e_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2402" name="__codelineno-0-2402"></a>        <span class="n">e_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">e_field</span><span class="p">)</span>
<a id="__codelineno-0-2403" name="__codelineno-0-2403"></a>        <span class="n">h_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2404" name="__codelineno-0-2404"></a>        <span class="n">h_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">h_field</span><span class="p">)</span>
<a id="__codelineno-0-2405" name="__codelineno-0-2405"></a>
<a id="__codelineno-0-2406" name="__codelineno-0-2406"></a>        <span class="c1"># Components of the E and H fields</span>
<a id="__codelineno-0-2407" name="__codelineno-0-2407"></a>        <span class="n">Ex</span><span class="p">,</span> <span class="n">Ey</span><span class="p">,</span> <span class="n">Ez</span> <span class="o">=</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">e_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2408" name="__codelineno-0-2408"></a>        <span class="n">Hx</span><span class="p">,</span> <span class="n">Hy</span><span class="p">,</span> <span class="n">Hz</span> <span class="o">=</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">h_field</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<a id="__codelineno-0-2409" name="__codelineno-0-2409"></a>
<a id="__codelineno-0-2410" name="__codelineno-0-2410"></a>        <span class="c1"># Define visibility settings per mode, including contours as always visible</span>
<a id="__codelineno-0-2411" name="__codelineno-0-2411"></a>        <span class="n">visible_status_e</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>  <span class="c1"># 3 components per mode, with contour for each</span>
<a id="__codelineno-0-2412" name="__codelineno-0-2412"></a>        <span class="n">visible_status_h</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">6</span><span class="p">)</span>
<a id="__codelineno-0-2413" name="__codelineno-0-2413"></a>        <span class="c1"># Make the contour visible by default</span>
<a id="__codelineno-0-2414" name="__codelineno-0-2414"></a>
<a id="__codelineno-0-2415" name="__codelineno-0-2415"></a>
<a id="__codelineno-0-2416" name="__codelineno-0-2416"></a>
<a id="__codelineno-0-2417" name="__codelineno-0-2417"></a>
<a id="__codelineno-0-2418" name="__codelineno-0-2418"></a>        <span class="c1"># Make this mode&#39;s components and the corresponding contour visible in the initial layout </span>
<a id="__codelineno-0-2419" name="__codelineno-0-2419"></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">):</span>
<a id="__codelineno-0-2420" name="__codelineno-0-2420"></a>            <span class="n">visible_status_e</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2421" name="__codelineno-0-2421"></a>            <span class="n">visible_status_h</span><span class="p">[</span><span class="mi">6</span><span class="o">*</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<a id="__codelineno-0-2422" name="__codelineno-0-2422"></a>
<a id="__codelineno-0-2423" name="__codelineno-0-2423"></a>
<a id="__codelineno-0-2424" name="__codelineno-0-2424"></a>        <span class="c1"># Add contour traces for permittivity to each subplot of fig_e and fig_h for this mode</span>
<a id="__codelineno-0-2425" name="__codelineno-0-2425"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2426" name="__codelineno-0-2426"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2427" name="__codelineno-0-2427"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2428" name="__codelineno-0-2428"></a>
<a id="__codelineno-0-2429" name="__codelineno-0-2429"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2430" name="__codelineno-0-2430"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2431" name="__codelineno-0-2431"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Contour</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">eps</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">contours</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="n">midpoint</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">coloring</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">),</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">),</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">showlegend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2432" name="__codelineno-0-2432"></a>
<a id="__codelineno-0-2433" name="__codelineno-0-2433"></a>        <span class="c1"># Add Ex, Ey, Ez with shared colorbar limits for the E field of this mode</span>
<a id="__codelineno-0-2434" name="__codelineno-0-2434"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ex</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2435" name="__codelineno-0-2435"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ey</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2436" name="__codelineno-0-2436"></a>        <span class="n">fig_e</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Ez</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;E-field&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">zmin</span><span class="o">=</span><span class="n">e_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">e_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2437" name="__codelineno-0-2437"></a>
<a id="__codelineno-0-2438" name="__codelineno-0-2438"></a>        <span class="c1"># Add Hx, Hy, Hz with shared colorbar limits for the H field of this mode</span>
<a id="__codelineno-0-2439" name="__codelineno-0-2439"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2440" name="__codelineno-0-2440"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hy</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2441" name="__codelineno-0-2441"></a>        <span class="n">fig_h</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Heatmap</span><span class="p">(</span><span class="n">z</span><span class="o">=</span><span class="n">Hz</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;H-field&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">thickness</span><span class="o">=</span><span class="mi">15</span><span class="p">),</span> <span class="n">zmin</span><span class="o">=</span><span class="n">h_min</span><span class="p">,</span> <span class="n">zmax</span><span class="o">=</span><span class="n">h_max</span><span class="p">,</span> <span class="n">visible</span><span class="o">=</span><span class="kc">True</span> <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="k">else</span> <span class="kc">False</span><span class="p">,</span> <span class="n">zsmooth</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">),</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2442" name="__codelineno-0-2442"></a>
<a id="__codelineno-0-2443" name="__codelineno-0-2443"></a>
<a id="__codelineno-0-2444" name="__codelineno-0-2444"></a>
<a id="__codelineno-0-2445" name="__codelineno-0-2445"></a>        <span class="c1"># Dropdown data for E-field</span>
<a id="__codelineno-0-2446" name="__codelineno-0-2446"></a>        <span class="n">k_point</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;k_point&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2447" name="__codelineno-0-2447"></a>        <span class="n">freq</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;freq&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2448" name="__codelineno-0-2448"></a>        <span class="n">polarization</span> <span class="o">=</span> <span class="n">mode</span><span class="p">[</span><span class="s2">&quot;polarization&quot;</span><span class="p">]</span>
<a id="__codelineno-0-2449" name="__codelineno-0-2449"></a>        <span class="n">mode_description</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&lt;br&gt;k = [</span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">k_point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">0.2f</span><span class="si">}</span><span class="s2">], freq=</span><span class="si">{</span><span class="n">freq</span><span class="si">:</span><span class="s2">0.3f</span><span class="si">}</span><span class="s2">, polarization=</span><span class="si">{</span><span class="n">polarization</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-2450" name="__codelineno-0-2450"></a>
<a id="__codelineno-0-2451" name="__codelineno-0-2451"></a>        <span class="n">dropdown_buttons_e</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-2452" name="__codelineno-0-2452"></a>            <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2453" name="__codelineno-0-2453"></a>                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2454" name="__codelineno-0-2454"></a>                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_e</span><span class="p">},</span>
<a id="__codelineno-0-2455" name="__codelineno-0-2455"></a>                    <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components&quot;</span><span class="p">}]))</span>
<a id="__codelineno-0-2456" name="__codelineno-0-2456"></a>
<a id="__codelineno-0-2457" name="__codelineno-0-2457"></a>        <span class="n">dropdown_buttons_h</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
<a id="__codelineno-0-2458" name="__codelineno-0-2458"></a>            <span class="nb">dict</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Mode </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2459" name="__codelineno-0-2459"></a>                <span class="n">method</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">,</span>
<a id="__codelineno-0-2460" name="__codelineno-0-2460"></a>                <span class="n">args</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;visible&#39;</span><span class="p">:</span> <span class="n">visible_status_h</span><span class="p">},</span>
<a id="__codelineno-0-2461" name="__codelineno-0-2461"></a>                    <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components&quot;</span><span class="p">}]))</span>
<a id="__codelineno-0-2462" name="__codelineno-0-2462"></a>
<a id="__codelineno-0-2463" name="__codelineno-0-2463"></a>    <span class="c1"># Layout and color settings</span>
<a id="__codelineno-0-2464" name="__codelineno-0-2464"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2465" name="__codelineno-0-2465"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of E-field components&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2466" name="__codelineno-0-2466"></a>        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2467" name="__codelineno-0-2467"></a>            <span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-2468" name="__codelineno-0-2468"></a>            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_e</span><span class="p">)],</span>
<a id="__codelineno-0-2469" name="__codelineno-0-2469"></a>        <span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)),</span>
<a id="__codelineno-0-2470" name="__codelineno-0-2470"></a>        <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-2471" name="__codelineno-0-2471"></a>        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2472" name="__codelineno-0-2472"></a>        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2473" name="__codelineno-0-2473"></a>        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
<a id="__codelineno-0-2474" name="__codelineno-0-2474"></a>    <span class="p">)</span>
<a id="__codelineno-0-2475" name="__codelineno-0-2475"></a>
<a id="__codelineno-0-2476" name="__codelineno-0-2476"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
<a id="__codelineno-0-2477" name="__codelineno-0-2477"></a>        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mode_description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">quantity</span><span class="si">}</span><span class="s2"> of H-field components&quot;</span><span class="p">,</span>
<a id="__codelineno-0-2478" name="__codelineno-0-2478"></a>        <span class="n">updatemenus</span><span class="o">=</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span>
<a id="__codelineno-0-2479" name="__codelineno-0-2479"></a>            <span class="n">active</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">target_modes</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-2480" name="__codelineno-0-2480"></a>            <span class="n">buttons</span><span class="o">=</span><span class="n">dropdown_buttons_h</span><span class="p">)],</span>
<a id="__codelineno-0-2481" name="__codelineno-0-2481"></a>        <span class="n">coloraxis</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">colorbar</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">len</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)),</span>
<a id="__codelineno-0-2482" name="__codelineno-0-2482"></a>        <span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
<a id="__codelineno-0-2483" name="__codelineno-0-2483"></a>        <span class="n">xaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_showgrid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2484" name="__codelineno-0-2484"></a>        <span class="n">xaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">yaxis_zeroline</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-2485" name="__codelineno-0-2485"></a>        <span class="n">hovermode</span><span class="o">=</span><span class="s2">&quot;closest&quot;</span>
<a id="__codelineno-0-2486" name="__codelineno-0-2486"></a>    <span class="p">)</span>
<a id="__codelineno-0-2487" name="__codelineno-0-2487"></a>
<a id="__codelineno-0-2488" name="__codelineno-0-2488"></a>    <span class="c1"># Final adjustments</span>
<a id="__codelineno-0-2489" name="__codelineno-0-2489"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2490" name="__codelineno-0-2490"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2491" name="__codelineno-0-2491"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2492" name="__codelineno-0-2492"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">showticklabels</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<a id="__codelineno-0-2493" name="__codelineno-0-2493"></a>
<a id="__codelineno-0-2494" name="__codelineno-0-2494"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2495" name="__codelineno-0-2495"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">yaxis_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2496" name="__codelineno-0-2496"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2497" name="__codelineno-0-2497"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis2_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="n">yaxis2_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2498" name="__codelineno-0-2498"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2499" name="__codelineno-0-2499"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">yaxis3_scaleanchor</span><span class="o">=</span><span class="s2">&quot;x3&quot;</span><span class="p">,</span> <span class="n">yaxis3_scaleratio</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2500" name="__codelineno-0-2500"></a>
<a id="__codelineno-0-2501" name="__codelineno-0-2501"></a>
<a id="__codelineno-0-2502" name="__codelineno-0-2502"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2503" name="__codelineno-0-2503"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2504" name="__codelineno-0-2504"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2505" name="__codelineno-0-2505"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2506" name="__codelineno-0-2506"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2507" name="__codelineno-0-2507"></a>    <span class="n">fig_e</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2508" name="__codelineno-0-2508"></a>
<a id="__codelineno-0-2509" name="__codelineno-0-2509"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2510" name="__codelineno-0-2510"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-2511" name="__codelineno-0-2511"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2512" name="__codelineno-0-2512"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<a id="__codelineno-0-2513" name="__codelineno-0-2513"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;X-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2514" name="__codelineno-0-2514"></a>    <span class="n">fig_h</span><span class="o">.</span><span class="n">update_yaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="s2">&quot;Y-axis&quot;</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<a id="__codelineno-0-2515" name="__codelineno-0-2515"></a>
<a id="__codelineno-0-2516" name="__codelineno-0-2516"></a>    <span class="k">return</span> <span class="n">fig_e</span><span class="p">,</span> <span class="n">fig_h</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>
<h3 id="src.photonic_crystal-functions">Functions<a href="#src.photonic_crystal-functions" class="headerlink" title="Anchor link to this section">&para;</a></h3>

<div class="doc doc-object doc-function">


<h4 id="src.photonic_crystal.suppress_output" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">suppress_output</span><span class="p">()</span></code>

<a href="#src.photonic_crystal.suppress_output" class="headerlink" title="Anchor link to this section">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Context manager to suppress stdout and stderr.</p>
<p>This context manager redirects the standard output (stdout) and standard error (stderr)
to os.devnull, effectively suppressing any output within its context.</p>


    <p><span class="doc-section-title">Yields:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>This context manager does not return any value.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">with</span> <span class="n">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a>    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This will not be printed&quot;</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;This error will not be shown&quot;</span><span class="p">)</span>
</code></pre></div>
</details>
            <details class="quote">
              <summary>Source code in <code>src/photonic_crystal.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1069" name="__codelineno-0-1069"></a><span class="nd">@contextlib</span><span class="o">.</span><span class="n">contextmanager</span>
<a id="__codelineno-0-1070" name="__codelineno-0-1070"></a><span class="k">def</span> <span class="nf">suppress_output</span><span class="p">():</span>
<a id="__codelineno-0-1071" name="__codelineno-0-1071"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-1072" name="__codelineno-0-1072"></a><span class="sd">    Context manager to suppress stdout and stderr.</span>
<a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>
<a id="__codelineno-0-1074" name="__codelineno-0-1074"></a><span class="sd">    This context manager redirects the standard output (stdout) and standard error (stderr)</span>
<a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="sd">    to os.devnull, effectively suppressing any output within its context.</span>
<a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>
<a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="sd">    Yields:</span>
<a id="__codelineno-0-1078" name="__codelineno-0-1078"></a><span class="sd">        None: This context manager does not return any value.</span>
<a id="__codelineno-0-1079" name="__codelineno-0-1079"></a>
<a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">        ```python</span>
<a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">        with suppress_output():</span>
<a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">            print(&quot;This will not be printed&quot;)</span>
<a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">            raise ValueError(&quot;This error will not be shown&quot;)</span>
<a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">        ```</span>
<a id="__codelineno-0-1086" name="__codelineno-0-1086"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">devnull</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">devnull</span><span class="p">:</span>
<a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>        <span class="n">old_stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span>
<a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>        <span class="n">old_stderr</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span>
<a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">devnull</span>
<a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>        <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">devnull</span>
<a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>            <span class="k">yield</span>
<a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>        <span class="k">finally</span><span class="p">:</span>
<a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">old_stdout</span>
<a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="n">old_stderr</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div><p>options:
  heading_level: 2
  show_root_heading: true
  show_root_full_path: true
  group_by_category: true
  show_category_heading: true</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/enricovallar/nzi-lithium-niobate" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8M97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "navigation.sticky", "navigation.instant.preview", "navigation.instant", "navigation.expand", "search.suggest", "search.highlight", "content.code.copy", "content.nav.top"], "search": "../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.83f73b43.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>